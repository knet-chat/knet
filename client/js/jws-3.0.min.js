"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWS=function(){function b(l,k){return utf8tob64u(l)+"."+utf8tob64u(k)}function c(l){var m=l.alg,k="";if("RS256"!=m&&"RS512"!=m&&"PS256"!=m&&"PS512"!=m)throw"JWS signature algorithm not supported: "+m;return"256"==m.substr(2)&&(k="sha256"),"512"==m.substr(2)&&(k="sha512"),k}function e(k){return c(jsonParse(k))}function j(k,p,s,m,q,r){var n=new RSAKey;n.setPrivate(m,q,r);var l=e(k),o=n.signString(s,l);return o}function i(q,p,o,n,m){var k=null;k="undefined"==typeof m?e(q):c(m);var l="PS"==m.alg.substr(0,2);return n.hashAndSign?b64tob64u(n.hashAndSign(k,o,"binary","base64",l)):l?hextob64u(n.signStringPSS(o,k)):hextob64u(n.signString(o,k))}function d(q,p,o,l){var n=new RSAKey;n.readPrivateKeyFromPEMString(l);var k=e(q),m=n.signString(o,k);return m}this.parseJWS=function(n,p){if(void 0===this.parsedJWS||!p&&void 0===this.parsedJWS.sigvalH){if(null==n.match(/^([^.]+)\.([^.]+)\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var q=RegExp.$1,l=RegExp.$2,r=RegExp.$3,t=q+"."+l;if(this.parsedJWS={},this.parsedJWS.headB64U=q,this.parsedJWS.payloadB64U=l,this.parsedJWS.sigvalB64U=r,this.parsedJWS.si=t,!p){var o=b64utohex(r),m=parseBigInt(o,16);this.parsedJWS.sigvalH=o,this.parsedJWS.sigvalBI=m}var k=b64utoutf8(q),s=b64utoutf8(l);if(this.parsedJWS.headS=k,this.parsedJWS.payloadS=s,!this.isSafeJSONString(k,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+k}},this.verifyJWSByNE=function(m,l,k){return this.parseJWS(m),_rsasign_verifySignatureWithArgs(this.parsedJWS.si,this.parsedJWS.sigvalBI,l,k)},this.verifyJWSByKey=function(n,m){this.parseJWS(n);var k=c(this.parsedJWS.headP),l="PS"==this.parsedJWS.headP.alg.substr(0,2);return m.hashAndVerify?m.hashAndVerify(k,new Buffer(this.parsedJWS.si,"utf8").toString("base64"),b64utob64(this.parsedJWS.sigvalB64U),"base64",l):l?m.verifyStringPSS(this.parsedJWS.si,this.parsedJWS.sigvalH,k):m.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.verifyJWSByPemX509Cert=function(m,k){this.parseJWS(m);var l=new X509;return l.readCertPEM(k),l.subjectPublicKeyRSA.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.generateJWSByNED=function(r,n,q,m,p){if(!this.isSafeJSONString(r))throw"JWS Head is not safe JSON string: "+r;var l=b(r,n),o=j(r,n,l,q,m,p),k=hextob64u(o);return this.parsedJWS={},this.parsedJWS.headB64U=l.split(".")[0],this.parsedJWS.payloadB64U=l.split(".")[1],this.parsedJWS.sigvalB64U=k,l+"."+k},this.generateJWSByKey=function(p,n,k){var o={};if(!this.isSafeJSONString(p,o,"headP"))throw"JWS Head is not safe JSON string: "+p;var m=b(p,n),l=i(p,n,m,k,o.headP);return this.parsedJWS={},this.parsedJWS.headB64U=m.split(".")[0],this.parsedJWS.payloadB64U=m.split(".")[1],this.parsedJWS.sigvalB64U=l,m+"."+l},this.generateJWSByP1PrvKey=function(p,n,k){if(!this.isSafeJSONString(p))throw"JWS Head is not safe JSON string: "+p;var m=b(p,n),o=d(p,n,m,k),l=hextob64u(o);return this.parsedJWS={},this.parsedJWS.headB64U=m.split(".")[0],this.parsedJWS.payloadB64U=m.split(".")[1],this.parsedJWS.sigvalB64U=l,m+"."+l}},KJUR.jws.JWS.sign=function(b,p,i,l,k){var j=KJUR.jws.JWS;if(!j.isSafeJSONString(p))throw"JWS Head is not safe JSON string: "+sHead;var e=j.readSafeJSONString(p);""!=b&&null!=b||void 0===e.alg||(b=e.alg),""!=b&&null!=b&&void 0===e.alg&&(e.alg=b,p=JSON.stringify(e));var d=null;if(void 0===j.jwsalg2sigalg[b])throw"unsupported alg name: "+b;d=j.jwsalg2sigalg[b];var c=utf8tob64u(p),g=utf8tob64u(i),n=c+"."+g,m="";if("Hmac"==d.substr(0,4)){if(void 0===l)throw"hexadecimal key shall be specified for HMAC";var h=new KJUR.crypto.Mac({alg:d,pass:hextorstr(l)});h.updateString(n),m=h.doFinal()}else if(d.indexOf("withECDSA")!=-1){var o=new KJUR.crypto.Signature({alg:d});o.init(l,k),o.updateString(n),hASN1Sig=o.sign(),m=KJUR.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig)}else if("none"!=d){var o=new KJUR.crypto.Signature({alg:d});o.init(l,k),o.updateString(n),m=o.sign()}var f=hextob64u(m);return n+"."+f},KJUR.jws.JWS.verify=function(d,m){var k=KJUR.jws.JWS,l=d.split("."),c=l[0],h=l[1],o=c+"."+h,n=b64utohex(l[2]),f=k.readSafeJSONString(b64utoutf8(l[0])),b=null;if(void 0===f.alg)throw"algorithm not specified in header";b=f.alg;var e=null;if(void 0===k.jwsalg2sigalg[f.alg])throw"unsupported alg name: "+b;if(e=k.jwsalg2sigalg[b],"none"==e)return!0;if("Hmac"==e.substr(0,4)){if(void 0===m)throw"hexadecimal key shall be specified for HMAC";var j=new KJUR.crypto.Mac({alg:e,pass:hextorstr(m)});return j.updateString(o),hSig2=j.doFinal(),n==hSig2}if(e.indexOf("withECDSA")!=-1){var g=null;try{g=KJUR.crypto.ECDSA.concatSigToASN1Sig(n)}catch(i){return!1}var p=new KJUR.crypto.Signature({alg:e});return p.init(m),p.updateString(o),p.verify(g)}var p=new KJUR.crypto.Signature({alg:e});return p.init(m),p.updateString(o),p.verify(n)},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(d,c,e){var f=null;try{return f=jsonParse(d),"object"!=typeof f?0:f.constructor===Array?0:(c&&(c[e]=f),1)}catch(b){return 0}},KJUR.jws.JWS.readSafeJSONString=function(c){var d=null;try{return d=jsonParse(c),"object"!=typeof d?null:d.constructor===Array?null:d}catch(b){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(b){if(null==b.match(/^[^.]+\.[^.]+\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return RegExp.$1},KJUR.jws.IntDate=function(){},KJUR.jws.IntDate.get=function(b){if("now"==b)return KJUR.jws.IntDate.getNow();if("now + 1hour"==b)return KJUR.jws.IntDate.getNow()+3600;if("now + 1day"==b)return KJUR.jws.IntDate.getNow()+86400;if("now + 1month"==b)return KJUR.jws.IntDate.getNow()+2592e3;if("now + 1year"==b)return KJUR.jws.IntDate.getNow()+31536e3;if(b.match(/Z$/))return KJUR.jws.IntDate.getZulu(b);if(b.match(/^[0-9]+$/))return parseInt(b);throw"unsupported format: "+b},KJUR.jws.IntDate.getZulu=function(h){if(a=h.match(/(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z/)){var g=parseInt(RegExp.$1),i=parseInt(RegExp.$2)-1,c=parseInt(RegExp.$3),b=parseInt(RegExp.$4),e=parseInt(RegExp.$5),f=parseInt(RegExp.$6),j=new Date(Date.UTC(g,i,c,b,e,f));return~~(j/1e3)}throw"unsupported format: "+h},KJUR.jws.IntDate.getNow=function(){var b=~~(new Date/1e3);return b},KJUR.jws.IntDate.intDate2UTCString=function(b){var c=new Date(1e3*b);return c.toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(f){var j=new Date(1e3*f),i=("0000"+j.getUTCFullYear()).slice(-4),h=("00"+(j.getUTCMonth()+1)).slice(-2),c=("00"+j.getUTCDate()).slice(-2),b=("00"+j.getUTCHours()).slice(-2),e=("00"+j.getUTCMinutes()).slice(-2),g=("00"+j.getUTCSeconds()).slice(-2);return i+h+c+b+e+g+"Z"};
//# sourceMappingURL=sourcemap.map