function UserSettings(myUser){this.index="undefined"==typeof myUser.index?0:myUser.index,this.publicClientID="undefined"==typeof myUser.publicClientID?null:myUser.publicClientID,this.myCurrentNick="undefined"==typeof myUser.myCurrentNick?"":myUser.myCurrentNick,this.myCommentary="undefined"==typeof myUser.myCommentary?"":myUser.myCommentary,this.myPhotoPath="undefined"==typeof myUser.myPhotoPath?"":myUser.myPhotoPath,this.myArrayOfKeys="undefined"==typeof myUser.myArrayOfKeys?null:myUser.myArrayOfKeys,this.lastProfileUpdate="undefined"==typeof myUser.lastProfileUpdate?null:parseInt(myUser.lastProfileUpdate),this.handshakeToken="undefined"==typeof myUser.handshakeToken?null:myUser.handshakeToken,this.myTelephone="undefined"==typeof myUser.myTelephone?"":myUser.myTelephone,this.myEmail="undefined"==typeof myUser.myEmail?"":myUser.myEmail,this.visibility="undefined"==typeof myUser.visibility?"on":myUser.visibility,this.keys="undefined"==typeof myUser.keys?{}:myUser.keys}function Message(input){this.to=input.to,this.from=input.from,this.msgID=input.msgID?input.msgID:this.assignId(),this.messageBody=input.messageBody,this.size=input.size?input.size:this.calculateSize(),this.timestamp=input.timestamp?parseInt(input.timestamp):(new Date).getTime(),this.markedAsRead="undefined"!=typeof input.markedAsRead&&input.markedAsRead,this.chatWith=input.chatWith?input.chatWith:this.to,this.ACKfromServer="undefined"!=typeof input.ACKfromServer&&input.ACKfromServer,this.ACKfromAddressee="undefined"!=typeof input.ACKfromAddressee&&input.ACKfromAddressee}function Postman(){}function GUI(){this.listOfImages4Gallery=[],this.indexOfImages4Gallery=0,this.inAppBrowser=null,this.photoGallery=null,this.photoGalleryClosed=!0,this.groupOnMenu=null,this.formatter=function(){},this.searchMap=null,this.listOfPlans=null,this.isPlanDisplayed=!1,this.timeoutPickupRTC=null}function MailBox(){}function Application(){this.currentChatWith=null,this.myPosition={coords:{latitude:"",longitude:""}},this.symetricKey2use=null,this.profileIsChanged=!1,this.map=null,this.connecting=!1,this.inBackground=!1,this.initialized=!1,this.tokenSigned=null,this.devicePlatform="",this.indexedDBHandler=null,this.deviceVersion="",this.events={},this.events.documentReady=new $.Deferred,this.events.contactsLoaded=new $.Deferred,this.events.userSettingsLoaded=new $.Deferred,this.events.deviceReady=new $.Deferred,this.isMobile=!0,this.msg2forward=null,this.authSocket=null,this.keys={},this.easyrtcid=null,this.otherEasyrtcid=null}function AbstractHandler(){}function ContactOnKnet(c){this.publicClientID=c.publicClientID,this.imgsrc="undefined"==typeof c.imgsrc||""==c.imgsrc||null==c.imgsrc?"./res/logo_300x300.jpg":c.imgsrc,this.nickName=c.nickName?c.nickName:dictionary.Literals.label_23,this.location=c.location?c.location:{lat:"",lon:""},this.commentary="undefined"==typeof c.commentary||""==c.commentary?dictionary.Literals.label_12:c.commentary,this.lastProfileUpdate=c.lastProfileUpdate?parseInt(c.lastProfileUpdate):config.TIME_UNIX_2015,this.counterOfUnreadSMS=c.counterOfUnreadSMS?c.counterOfUnreadSMS:0,this.timeLastSMS=c.timeLastSMS?parseInt(c.timeLastSMS):0,this.telephone=c.telephone?c.telephone:"",this.email=c.email?c.email:"",this.pubKeyPEM=c.pubKeyPEM?c.pubKeyPEM:null,this.encryptionKeys=c.encryptionKeys?c.encryptionKeys:null,this.decryptionKeys=c.decryptionKeys?c.decryptionKeys:null,this.isAccepted=!!c.isAccepted&&c.isAccepted,this.isBlocked=!!c.isBlocked&&c.isBlocked,this.lastMsgTruncated="undefined"==typeof c.lastMsgTruncated||null==c.lastMsgTruncated?"":c.lastMsgTruncated}function ContactsHandler(){this.listOfContacts=[]}function Group(g){this.publicClientID=g.publicClientID?g.publicClientID:this.assignId(),this.imgsrc="undefined"==typeof g.imgsrc||""==g.imgsrc||null==g.imgsrc?"./res/group_black_195x195.png":g.imgsrc,this.nickName=g.nickName?g.nickName:dictionary.Literals.label_23,this.commentary="undefined"==typeof g.commentary||""==g.commentary?dictionary.Literals.label_12:g.commentary,this.lastProfileUpdate=g.lastProfileUpdate?parseInt(g.lastProfileUpdate):config.TIME_UNIX_2015,this.location=g.location?g.location:{lat:"",lon:""},this.counterOfUnreadSMS=g.counterOfUnreadSMS?g.counterOfUnreadSMS:0,this.timeLastSMS=g.timeLastSMS?parseInt(g.timeLastSMS):0,this.telephone=g.telephone?g.telephone:"",this.email=g.email?g.email:"",this.listOfMembers=g.listOfMembers instanceof Array?g.listOfMembers:[],this.isAccepted=!!g.isAccepted&&g.isAccepted,this.isBlocked=!!g.isBlocked&&g.isBlocked,this.lastMsgTruncated="undefined"==typeof g.lastMsgTruncated||null==g.lastMsgTruncated?"":g.lastMsgTruncated}function GroupsHandler(){this.list=[]}function Dictionary(){var _this=this;this.Literals_en={label_1:"Profile",label_2:"Groups",label_3:"Search",label_4:"Account",label_5:"my nick Name:",label_6:"coming soon",label_7:"send",label_8:"who can see me...",label_9:"Anybody",label_10:"should you switch this off, then only your contacts would see you online, is not that boring?",label_11:"Here you are",label_12:"is still thinking on a nice commentary",label_13:"I'm new on Visible!",label_14:"drag & drop",label_15:"new contact saved ! <br> ;-) ",label_16:"new message from:",label_17:"My commentary:",label_18:"Do you really want to exit?",label_19:"Exit",label_20:"No,Yes",label_23:"Name...",label_24:"Commentary...",label_25:"Telephone...",label_26:"e-mail",label_27:"User account Activation",label_28:"License valid for a year",label_29:"License valid for 4 years",label_30:"Back-up functionality",label_31:"Donation for associated NGOs",label_32:"Donation for our Open Source Initiative",label_33:"Total: ",label_34:"Buy",label_35:"Welcome ! we're generating your security channel, this process could take a few minutes, please be patience",label_36:"new Group",label_37:"My Groups",label_38:"create",label_39:"modify",label_40:"Group: ",label_41:"load earlier messages",label_42:"please enable your internet connection",label_43:"block",label_44:"report abuse",label_45:"add contact ",label_46:"yes",label_47:"no",label_48:"report abuse",label_49:"Consent",label_50:"unblock contact?",label_51:"Do you want to block this person?",label_52:"Blocked people",label_58:"reported",label_59:"agree",label_60:"Privacy policy",label_61:"typing",label_62:"Group Info",label_63:"Contact Info",label_64:"around this area",label_65:"create a new plan",label_66:"search people or join a plan",label_67:"today",label_68:"clear",label_69:"close",label_72:"plan",label_75:"join",label_76:"Ask the organizer?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{en:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"en"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"}},"stand-alone":{abbreviated:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"}}},days:{format:{abbreviated:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},narrow:{sun:"S",mon:"M",tue:"T",wed:"W",thu:"T",fri:"F",sat:"S"},short:{sun:"Su",mon:"Mo",tue:"Tu",wed:"We",thu:"Th",fri:"Fr",sat:"Sa"},wide:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"}},"stand-alone":{abbreviated:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},narrow:{sun:"S",mon:"M",tue:"T",wed:"W",thu:"T",fri:"F",sat:"S"},short:{sun:"Su",mon:"Mo",tue:"Tu",wed:"We",thu:"Th",fri:"Fr",sat:"Sa"},wide:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"âˆž",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"â€°",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{en:"en-GB"},"plurals-type-cardinal":{en:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, â€¦ @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, â€¦"}}}}},this.Literals_de={label_1:"Profil",label_2:"Gruppen",label_3:"Suchen",label_4:"Konto",label_5:"Mein Spitzname:",label_6:"kommt bald",label_7:"Senden",label_8:"Sie sind sichtbar ...",label_9:"Alle",label_10:"sollten Sie dies abschalten, dann werden nur Ihre Kontakte Sie online sehen, ist das nicht langweilig?",label_11:"Hier sind Sie",label_12:"Denkt immer noch an einen schönen Kommentar",label_13:"Ich bin neu auf Visible!",label_14:"Drag & Drop",label_15:"Neuer Kontakt gespeichert! <br> ;-)",label_16:"neue Nachrichten von:",label_17:"Mein Kommentar:",label_18:"Wollen Sie wirklich beenden?",label_19:"Verlassen",label_20:"Abbrechen,Ok",label_23:"Name...",label_24:"Kommentar...",label_25:"Telefon...",label_26:"e-mail",label_27:"Benutzerkonto-Aktivierung",label_28:"Lizenz g&uuml;ltig f&uuml;r ein Jahr",label_29:"Lizenz g&uuml;ltig f&uuml;r 4 Jahre",label_30:"Back-up-Funktionalit&auml;t",label_31:"Spende f&uuml;r assoziierten NGOs",label_32:"Spende f&uuml;r unsere Open Source Initiative",label_33:"Gesamtsumme: ",label_34:"Kaufen",label_35:"Willkommen! Wir machen Ihrer Sicherheitsprotokoll, Dieser Prozess könnte ein paar Minuten dauern, bitte et was Geduld",label_36:"neue Gruppe",label_37:"meine Gruppen",label_38:"kreieren",label_39:"modifizieren",label_40:"Gruppe: ",label_41:"laden fr&uuml;here Nachrichten",label_42:"Bitte aktivieren Sie Ihre Internetverbindung",label_43:"blockieren",label_44:"missbrauch melden",label_45:"Kontakt hinzuf&uuml;gen ",label_46:"ja",label_47:"nein",label_48:"missbrauch melden",label_49:"Zustimmung",label_50:"entsperren Kontakt?",label_51:"Wollen Sie diesen Benutzer blockieren?",label_52:"Blockierte Personen",label_58:"berichtet",label_59:"zustimmen",label_60:"Datenschutzerkl&auml;rung",label_61:"schreiben",label_62:"Gruppeninformationen",label_63:"Kontaktinfos",label_64:"um dieses Gebiet",label_65:"einen neuen Plan erstellen",label_66:"Leute suchen oder einen Plan beitreten",label_67:"heute",label_68:"r&uuml;cksetzen",label_69:"schlie&szlig;en",label_72:"plan",label_75:"teilnehmen",label_76:"Fragen Sie den Veranstalter?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{de:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"de"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"Jan.",2:"Feb.",3:"März",4:"Apr.",5:"Mai",6:"Juni",7:"Juli",8:"Aug.",9:"Sep.",10:"Okt.",11:"Nov.",12:"Dez."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}},"stand-alone":{abbreviated:{1:"Jan",2:"Feb",3:"Mär",4:"Apr",5:"Mai",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Okt",11:"Nov",12:"Dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}}},days:{format:{abbreviated:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}},"stand-alone":{abbreviated:{sun:"So",mon:"Mo",tue:"Di",wed:"Mi",thu:"Do",fri:"Fr",sat:"Sa"},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"âˆž",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"â€°",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{de:"de-DE"},"plurals-type-cardinal":{de:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, â€¦ @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, â€¦"}}}}},this.Literals_it={label_1:"Profilo",label_2:"Gruppi",label_3:"Ricerca",label_4:"Account",label_5:"il mio nick name:",label_6:"in arrivo",label_7:"invia",label_8:"Ti visibile per ...",label_9:"Chiunque",label_10:"si dovrebbe passare questa via, allora solo i contatti avrebbero visto voi on-line, non &egrave; che noioso?",label_11:"Ecco a voi",label_12:"È ancora pensando a un bel commento",label_13:"Sono nuovo su Visible!",label_14:"trascinare l'immagine",label_15:"novo contacto guardado! <br>;-)",label_16:"nuovo messaggio:",label_17:"Il mio commento:",label_18:"Sei sicuro di voler uscire?",label_19:"Uscire",label_20:"Annulla,Ok",label_23:"Nome...",label_24:"Commento...",label_25:"Telefono...",label_26:"e-mail",label_27:"Conto di attivazione per l'utente",label_28:"Licenza valida per un anno",label_29:"Licenza valida per 4 anni",label_30:"Funzionalit&agrave; di back-up",label_31:"Donazione per le ONG associate",label_32:"Donazione per la nostra iniziativa Open Source",label_33:"Totale: ",label_34:"Acquistare",label_35:"Benvenuto! generando il vostro protocollo di sicurezza, questo processo potrebbe richiedere alcuni minuti, si prega di essere pazienti",label_36:"nuovo gruppo",label_37:"I miei gruppi",label_38:"creare",label_39:"modificare",label_40:"Gruppi: ",label_41:"caricare i messaggi precedenti",label_42:"si prega di abilitare la connessione a internet",label_43:"bloccare",label_44:"notifica di abuso",label_45:"Aggiungi contatto ",label_46:"certo",label_47:"no",label_48:"notifica di abuso",label_49:"Consenso",label_50:"sbloccare i contatti?",label_51:"Vuoi bloccare questa persona?",label_52:"persone bloccate",label_58:"segnalati",label_59:"concordare",label_60:"Politica sulla riservatezza",label_61:"digitando",label_62:"Info di gruppo",label_63:"Info di contatto",label_64:"intorno a questa zona",label_65:"creare un nuovo piano",label_66:"ricerca gente o aderire a un piano",label_67:"oggi",label_68:"reset",label_69:"chiudere",label_72:"piano",label_75:"partecipare",label_76:"Chiedi l'organizzatore?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{it:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"it"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"Jan.",2:"Feb.",3:"März",4:"Apr.",5:"Mai",6:"Juni",7:"Juli",8:"Aug.",9:"Sep.",10:"Okt.",11:"Nov.",12:"Dez."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}},"stand-alone":{abbreviated:{1:"Jan",2:"Feb",3:"Mär",4:"Apr",5:"Mai",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Okt",11:"Nov",12:"Dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}}},days:{format:{abbreviated:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}},"stand-alone":{abbreviated:{sun:"So",mon:"Mo",tue:"Di",wed:"Mi",thu:"Do",fri:"Fr",sat:"Sa"},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"âˆž",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"â€°",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{it:"it-IT"},"plurals-type-cardinal":{de:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, â€¦ @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, â€¦"}}}}},this.Literals_es={label_1:"Perfil",label_2:"Grupos",label_3:"Buscar",label_4:"Cuenta",label_5:"mi apodo / nick:",label_6:"pr&oacute;ximamente",label_7:"enviar",label_8:"eres visible para...",label_9:"todo el mundo",label_10:"si desactivas esto, entonces solo tus contactos te ver&aacute;n conectado, no te parece aburrido?",label_11:"Aqu&iacute; estas",label_12:"sigue aun pensando en un comentario bonito ;-)",label_13:"soy nuevo en Visible!",label_14:"arrastra una imagen",label_15:"nuevo contacto guardado! <br>;-)",label_16:"mensaje de:",label_17:"Mi comentario:",label_18:"De verdad quieres salir?",label_19:"Salir",label_20:"Cancelar,Ok",label_23:"Nombre...",label_24:"Comentario...",label_25:"Teléfono...",label_26:"e-mail",label_27:"Activaci&oacute;n de cuenta de usuario",label_28:"Licencia v&aacute;lida por un a&ntilde;o",label_29:"Licencia v&aacute;lida por 4 a&ntilde;os",label_30:"Funcionalidad de back-up",label_31:"Donaci&oacute;n para las ONG asociadas",label_32:"Donaci&oacute;n para nuestra Iniciativa Open Source",label_33:"Total: ",label_34:"Comprar",label_35:"¡Bienvenido! generando su canal de seguridad, este proceso podrÃ­a tardar unos minutos, por favor sea paciente",label_36:"nuevo grupo",label_37:"mis Grupos",label_38:"crear",label_39:"modificar",label_40:"Grupo: ",label_41:"cargar mensajes anteriores",label_42:"Habilite la conexión a Internet por favor",label_43:"bloquear",label_44:"Denunciar abuso",label_45:"guardar contacto ",label_46:"si",label_47:"no",label_48:"Denunciar abuso",label_49:"Consentimiento",label_50:"¿desbloquear contacto?",label_51:"¿Quieres bloquear a esta persona?",label_52:"personas bloqueadas",label_58:"reportado",label_59:"de acuerdo",label_60:"Pol&iacute;tica de privacidad",label_61:"escribiendo",label_62:"Info de grupo",label_63:"Info de contacto",label_64:"en esta zona",label_65:"crear un plan nuevo",label_66:"buscar gente o unirse a un plan",label_67:"hoy",label_68:"reiniciar",label_69:"cerrar",label_72:"plan",label_75:"unirse",label_76:"Preguntar al organizador?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{es:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"es"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"ene.",2:"feb.",3:"mar.",4:"abr.",5:"may.",6:"jun.",7:"jul.",8:"ago.",9:"sept.",10:"oct.",11:"nov.",12:"dic."},wide:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"}},"stand-alone":{abbreviated:{1:"ene.",2:"feb.",3:"mar.",4:"abr.",5:"may.",6:"jun.",7:"jul.",8:"ago.",9:"sept.",10:"oct.",11:"nov.",12:"dic."},wide:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"}}},days:{format:{abbreviated:{sun:"dom.",mon:"lun.",tue:"mar.",wed:"mié.",thu:"jue.",fri:"vie.",sat:"sáb."},short:{sun:"DO",mon:"LU",tue:"MA",wed:"MI",thu:"JU",fri:"VI",sat:"SA"},wide:{sun:"domingo",mon:"lunes",tue:"martes",wed:"miércoles",thu:"jueves",fri:"viernes",sat:"sábado"}},"stand-alone":{abbreviated:{sun:"dom.",mon:"lun.",tue:"mar.",wed:"mié.",thu:"jue.",fri:"vie.",sat:"sáb."},narrow:{sun:"D",mon:"L",tue:"M",wed:"X",thu:"J",fri:"V",sat:"S"},short:{sun:"DO",mon:"LU",tue:"MA",wed:"MI",thu:"JU",fri:"VI",sat:"SA"},wide:{sun:"domingo",mon:"lunes",tue:"martes",wed:"miércoles",thu:"jueves",fri:"viernes",sat:"sábado"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"âˆž",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"â€°",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{es:"es-ES"},"plurals-type-cardinal":{es:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, â€¦ @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, â€¦"}}}}},this.Literals_fr={label_1:"Profil",label_2:"Groupes",label_3:"Recherche",label_4:"Compte",label_5:"mon surnom:",label_6:"&agrave; venir",label_7:"envoyer",label_8:"vous visible ...",label_9:"Tout le monde",label_10:"vous devez d&eacute;sactiver cette fonctionnalit&eacute;, seuls vos contacts verriez-vous en ligne, est pas ennuyeux?",label_11:"Ici, vous &ecirc;tes",label_12:"pensée sur une belle commentaires",label_13:"Je suis nouveau sur Visible!",label_14:"glissez-d&eacute;posez",label_15:"nouveau contact sauvegard&eacute;! <br>;-)",label_16:"nouveau message de:",label_17:"Mon commentaire:",label_18:"Voulez-vous vraiment quitter?",label_19:"Quitter",label_20:"Annuler,Ok",label_23:"Nom...",label_24:"Commentaire...",label_25:"Téléphone...",label_26:"e-mail",label_27:"Activation du compte de l'utilisateur",label_28:"licence valide pour un an",label_29:"licence valide pour 4 ans",label_30:"fonctionnalit&eacute; de back-up",label_31:"Don pour les ONG associ&eacute;es",label_32:"Don pour notre Open Source Initiative",label_33:"Total: ",label_34:"Acheter",label_35:"Bienvenue! g&eacute;n&eacute;ration de votre protocole de s&eacute;curit&eacute;, ce processus peut prendre quelques minutes, soyez patient svp",label_36:"nouveau groupe",label_37:"mes Groupes",label_38:"créer",label_39:"modifier",label_40:"Groupe: ",label_41:"charger les messages pr&eacute;c&eacute;dents",label_42:"s'il vous plait activez votre connexion Internet",label_43:"bloquer",label_44:"signaler un abus",label_45:"ajouter le contact ",label_46:"Oui",label_47:"non",label_48:"signaler un abus",label_49:"Consentement",label_50:"d&eacute;bloquer le contact?",label_51:"Voulez-vous bloquer cette personne?",label_52:"personnes bloqu&eacute;es",label_58:"signalé",label_59:"d'accord",label_60:"Politique de confidentialit&eacute;",label_61:"&eacute;crit maintenant",label_62:"Info du groupe",label_63:"Info de contact",label_64:"autour de cette zone",label_65:"cr&eacute;er un nouveau plan",label_66:"recherche de personnes ou de se joindre &agrave; un plan",label_67:"aujourd'hui",label_68:"r&eacute;initialiser",label_69:"fermer",label_72:"plan",label_75:"joindre",label_76:"Demandez &agrave; l'organisateur?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{fr:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"fr"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"janv.",2:"févr.",3:"mars",4:"avr.",5:"mai",6:"juin",7:"juil.",8:"août",9:"sept.",10:"oct.",11:"nov.",12:"déc."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janvier",2:"février",3:"mars",4:"avril",5:"mai",6:"juin",7:"juillet",8:"août",9:"septembre",10:"octobre",11:"novembre",12:"décembre"}},"stand-alone":{abbreviated:{1:"janv.",2:"févr.",3:"mars",4:"avr.",5:"mai",6:"juin",7:"juil.",8:"août",9:"sept.",10:"oct.",11:"nov.",12:"déc."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janvier",2:"février",3:"mars",4:"avril",5:"mai",6:"juin",7:"juillet",8:"août",9:"septembre",10:"octobre",11:"novembre",12:"décembre"}}},days:{format:{abbreviated:{sun:"dim.",mon:"lun.",tue:"mar.",wed:"mer.",thu:"jeu.",fri:"ven.",sat:"sam."},narrow:{sun:"D",mon:"L",tue:"M",wed:"M",thu:"J",fri:"V",sat:"S"},short:{sun:"di",mon:"lu",tue:"ma",wed:"me",thu:"je",fri:"ve",sat:"sa"},wide:{sun:"dimanche",mon:"lundi",tue:"mardi",wed:"mercredi",thu:"jeudi",fri:"vendredi",sat:"samedi"}},"stand-alone":{abbreviated:{sun:"dim.",mon:"lun.",tue:"mar.",wed:"mer.",thu:"jeu.",fri:"ven.",sat:"sam."},narrow:{sun:"D",mon:"L",tue:"M",wed:"M",thu:"J",fri:"V",sat:"S"},short:{sun:"di",mon:"lu",tue:"ma",wed:"me",thu:"je",fri:"ve",sat:"sa"},wide:{sun:"dimanche",mon:"lundi",tue:"mardi",wed:"mercredi",thu:"jeudi",fri:"vendredi",sat:"samedi"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"âˆž",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"â€°",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{fr:"fr-FR"},"plurals-type-cardinal":{fr:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, â€¦ @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, â€¦"}}}}},this.Literals_pt={label_1:"Perfil",label_2:"Grupos",label_3:"Pesquisa",label_4:"Conta",label_5:"meu nick name:",label_6:"em breve",label_7:"enviar",label_8:"voc&ecirc; vis&iacute;vel para ...",label_9:"Qualquer um",label_10:"voc&ecirc; deve desligar esta op&ccedil;&atilde;o, ent&atilde;o apenas seus contatos iria v&ecirc;-lo on-line, n&atilde;o &eacute; t&atilde;o chato?",label_11:"Aqui est&aacute;",label_12:"ainda est&aacute; pensando em um coment&aacute;rio agrad&aacute;vel",label_13:"Eu sou novo no Visible!",label_14:"arrastar e solta",label_15:"novo contacto guardado! <br>;-)",label_16:"mensagens novas de: ",label_17:"Meu coment&aacute;rio:",label_18:"Voce realmente deseja sair?",label_19:"Sair",label_20:"Cancelar,Ok",label_23:"Nome ...",label_24:"Comentario...",label_25:"Telefone...",label_26:"e-mail",label_27:"Ativa&ccedil;&atilde;o de Conta de Usu&aacute;rio",label_28:"Licen&ccedil;a v&aacute;lida por um ano",label_29:"licen&ccedil;a v&aacute;lida por 4 anos",label_30:"back-up funcionalidade",label_31:"Doa&ccedil;&atilde;o para as ONGs associadas",label_32:"Doa&ccedil;&atilde;o para o nosso Iniciativa Open Source",label_33:"Total: ",label_34:"Comprar",label_35:"Bem-vindo! gerando seu protocolo de seguranÃ§a, esse processo pode levar alguns minutos, por favor, seja paciente",label_36:"novo grupo",label_37:"meus Grupos",label_38:"criar",label_39:"modificar",label_40:"Grupo: ",label_41:"carregar mensagens anteriores",label_42:"Por favor, ative sua conexão de internet",label_43:"bloquear",label_44:"Denunciar abuso",label_45:"adicionar contato ",label_46:"sim",label_47:"n&atilde;o",label_48:"Denunciar abuso",
label_49:"Consentimento",label_50:"desbloquear o contato?",label_51:"Voc&ecirc; deseja bloquear esta pessoa?",label_52:"pessoas bloqueadas",label_58:"relatado",label_59:"concordar",label_60:"Pol&iacute;tica de Privacidade",label_61:"digitando",label_62:"Info do grupo",label_63:"Info de contato",label_64:"em torno desta &aacute;rea",label_65:"criar um novo plano",label_66:"busca de pessoas ou aderir a um plano",label_67:"hoje",label_68:"restabelecer",label_69:"fechar",label_72:"plan",label_75:"juntar-se",label_76:"Pe&ccedil;a o organizador?",label_77:"Do you want to add this member into your group?",CLDR:{main:{pt:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"pt"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"jan",2:"fev",3:"mar",4:"abr",5:"mai",6:"jun",7:"jul",8:"ago",9:"set",10:"out",11:"nov",12:"dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janeiro",2:"fevereiro",3:"março",4:"abril",5:"maio",6:"junho",7:"julho",8:"agosto",9:"setembro",10:"outubro",11:"novembro",12:"dezembro"}},"stand-alone":{abbreviated:{1:"jan",2:"fev",3:"mar",4:"abr",5:"mai",6:"jun",7:"jul",8:"ago",9:"set",10:"out",11:"nov",12:"dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janeiro",2:"fevereiro",3:"março",4:"abril",5:"maio",6:"junho",7:"julho",8:"agosto",9:"setembro",10:"outubro",11:"novembro",12:"dezembro"}}},days:{format:{abbreviated:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"sáb"},narrow:{sun:"D",mon:"S",tue:"T",wed:"Q",thu:"Q",fri:"S",sat:"S"},short:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"sáb"},wide:{sun:"domingo",mon:"segunda-feira",tue:"terça-feira",wed:"quarta-feira",thu:"quinta-feira",fri:"sexta-feira",sat:"sábado"}},"stand-alone":{abbreviated:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"sáb"},narrow:{sun:"D",mon:"S",tue:"T",wed:"Q",thu:"Q",fri:"S",sat:"S"},short:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"sáb"},wide:{sun:"domingo",mon:"segunda-feira",tue:"terça-feira",wed:"quarta-feira",thu:"quinta-feira",fri:"sexta-feira",sat:"sábado"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"âˆž",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"â€°",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{pt:"pt-PT"},"plurals-type-cardinal":{pt:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, â€¦ @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, â€¦"}}}}},this.AvailableLiterals={en:{value:_this.Literals_en},de:{value:_this.Literals_de},it:{value:_this.Literals_it},es:{value:_this.Literals_es},fr:{value:_this.Literals_fr},pt:{value:_this.Literals_pt}},this.Literals=this.AvailableLiterals.en.value}UserSettings.prototype.updateUserSettings=function(){var transaction=db.transaction(["usersettings"],"readwrite"),store=transaction.objectStore("usersettings");store.put(user)},Message.prototype.assignId=function(){for(var s=[],hexDigits="0123456789abcdef",i=0;i<36;i++)s[i]=hexDigits.substr(Math.floor(16*Math.random()),1);return s[14]="4",s[19]=hexDigits.substr(3&s[19]|8,1),s[8]=s[13]=s[18]=s[23]="-",s.join("")},Message.prototype.calculateSize=function(){var size=0;return"text"==this.messageBody.messageType?size=this.messageBody.text.length:"multimedia"==this.messageBody.messageType&&(size=this.messageBody.src.length),size},Message.prototype.convertToUTF=function(){this.messageBody.text=encodeURI(this.messageBody.text)},Message.prototype.getMsgID=function(){return this.msgID},Message.prototype.getTruncatedMsg=function(){var truncated="";return"multimedia"==this.messageBody.messageType?truncated="&#x1f4f7;":"text"==this.messageBody.messageType&&(truncated=decodeURI(gui._sanitize(this.messageBody.text)).substring(0,config.MAX_LENGTH_TRUNCATED_SMS)),truncated},Message.prototype.setChatWith=function(publicClientID){this.chatWith=publicClientID},Message.prototype.setACKfromServer=function(bool){this.ACKfromServer=bool},Message.prototype.setACKfromAddressee=function(bool){this.ACKfromAddressee=bool},Postman.prototype._isUUID=function(uuid){return"string"==typeof uuid&&/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(uuid)},Postman.prototype.createCertificate=function(keys){var cn="client",cert=forge.pki.createCertificate();cert.serialNumber="01",cert.validity.notBefore=new Date,cert.validity.notBefore.setFullYear(cert.validity.notBefore.getFullYear()-1),cert.validity.notAfter=new Date,cert.validity.notAfter.setFullYear(cert.validity.notAfter.getFullYear()+1);var attrs=[{name:"commonName",value:cn},{name:"countryName",value:"ES"},{shortName:"ST",value:"Madrid"},{name:"localityName",value:"Madrid"},{name:"organizationName",value:"instaltic"},{shortName:"OU",value:"instaltic"}];return cert.setSubject(attrs),cert.setIssuer(attrs),cert.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"subjectAltName",altNames:[{type:7,ip:"217.127.199.47"}]}]),cert.publicKey=keys.publicKey,cert.sign(keys.privateKey),log.debug('createcertificate created for "'+cn+'": \n'+forge.pki.certificateToPem(cert)),cert},Postman.prototype.generateKeyPair=function(){var deferred=$.Deferred(),options={};if(options.bits=2048,options.e=65537,$.browser.chrome){var base_url=window.location.href.replace(/\\/g,"/").replace(/\/[^\/]*$/,""),array=['var base_url = "'+base_url+'";importScripts(base_url + "/js/prime.worker.forChrome.js");'],blob=new Blob(array,{type:"text/javascript"});options.workerScript=window.URL.createObjectURL(blob),log.debug("$.browser.chrome true")}else log.debug("$.browser.chrome false"),options.workerScript="js/prime.worker.js";if("undefined"!=typeof Worker)forge.pki.rsa.generateKeyPair(options,function(err,keyPair){deferred.resolve(keyPair)});else{var keyPair=forge.pki.rsa.generateKeyPair(options);deferred.resolve(keyPair)}return deferred.promise()},Postman.prototype.createTLSConnection=function(options){var clientTLS=forge.tls.createConnection({server:!1,caStore:[options.serversPEMcertificate],sessionCache:{},cipherSuites:[forge.tls.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA,forge.tls.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA],virtualHost:"authknetserver",verify:function(c,verified,depth,certs){return log.debug('TLS Client verifying certificate w/CN: "'+certs[0].subject.getField("CN").value+'", verified: '+verified+"..."),verified},connected:function(c){log.info("TLS Client connected..."),setTimeout(function(){c.prepareHeartbeatRequest("heartbeat")},1),options.onConnected()},getCertificate:function(c,hint){return log.info("TLS Client getting certificate ..."),app.keys.certificate},getPrivateKey:function(c,cert){return forge.pki.privateKeyToPem(app.keys.privateKey)},tlsDataReady:function(c){try{var data2send=c.tlsData.getBytes();app.authSocket.emit("data2Server",forge.util.encode64(data2send))}catch(e){log.debug("TLS Client data2Server ::: exception"+e)}},dataReady:function(c){var data2receive=c.data.getBytes();log.info("TLS Client received",data2receive),options.onTLSmsg(data2receive)},heartbeatReceived:function(c,payload){log.debug("TLS Client received heartbeat: "+payload.getBytes())},closed:function(c){log.debug("TLS Client connection closed."),options.onClosed()},error:function(c,error){log.error("TLS Client error: "+error.message),options.onError()}});return clientTLS},Postman.prototype.encrypt=function(message){try{var cipher=forge.cipher.createCipher("AES-CBC",app.symetricKey2use),iv=Math.floor(7*Math.random()+0);cipher.start({iv:user.myArrayOfKeys[iv]}),cipher.update(forge.util.createBuffer(JSON.stringify(message))),cipher.finish();var envelope=iv+cipher.output.data;return envelope}catch(ex){return log.debug("Postman.prototype.encrypt",ex),null}},Postman.prototype.encryptHandshake=function(message){try{var cipher=forge.cipher.createCipher("AES-CBC",app.symetricKey2use);cipher.start({iv:app.symetricKey2use}),cipher.update(forge.util.createBuffer(JSON.stringify(message))),cipher.finish();var envelope=cipher.output.data;return envelope}catch(ex){return log.debug("Postman.prototype.encryptHandshake",ex),null}},Postman.prototype.encryptMsgBody=function(message){try{var toContact=contactsHandler.getContactById(message.to);null==toContact.encryptionKeys&&contactsHandler.setEncryptionKeys(toContact);var index4Key=Math.floor(7*Math.random()+0),index4iv=Math.floor(7*Math.random()+0),symetricKey2use=toContact.encryptionKeys[index4Key],iv2use=toContact.encryptionKeys[index4iv],cipher=forge.cipher.createCipher("AES-CBC",symetricKey2use);cipher.start({iv:iv2use}),cipher.update(forge.util.createBuffer(JSON.stringify(message.messageBody))),cipher.finish();var messageBody={index4Key:index4Key,index4iv:index4iv,encryptedMsg:cipher.output.data};return messageBody}catch(ex){return log.debug("Postman.prototype.encryptMsgBody",ex),null}},Postman.prototype.decrypt=function(encrypted){try{var decipher=forge.cipher.createDecipher("AES-CBC",app.symetricKey2use),iv=parseInt(encrypted.substring(0,1));return decipher.start({iv:user.myArrayOfKeys[iv]}),decipher.update(forge.util.createBuffer(encrypted.substring(1))),decipher.finish(),KJUR.jws.JWS.readSafeJSONString(decipher.output.data)}catch(ex){return log.debug("Postman.prototype.decrypt",ex),null}},Postman.prototype.decryptHandshake=function(encrypted){try{var decipher=forge.cipher.createDecipher("AES-CBC",app.symetricKey2use),iv=app.symetricKey2use;return decipher.start({iv:iv}),decipher.update(forge.util.createBuffer(encrypted)),decipher.finish(),KJUR.jws.JWS.readSafeJSONString(decipher.output.data)}catch(ex){return log.debug("Postman.prototype.decryptHandshake",ex),null}},Postman.prototype.decryptMsgBody=function(message){try{var fromContact=contactsHandler.getContactById(message.from);if("undefined"==typeof fromContact||null==fromContact.decryptionKeys)return postman.send("KeysRequest",{from:user.publicClientID,to:fromContact.publicClientID}),mailBox.storeMessage(message),null;var iv=fromContact.decryptionKeys[parseInt(message.messageBody.index4iv)],symetricKey2use=fromContact.decryptionKeys[parseInt(message.messageBody.index4Key)],decipher=forge.cipher.createDecipher("AES-CBC",symetricKey2use);return decipher.start({iv:iv}),decipher.update(forge.util.createBuffer(message.messageBody.encryptedMsg)),decipher.finish(),KJUR.jws.JWS.readSafeJSONString(decipher.output.data)}catch(ex){return log.debug("Postman.prototype.decryptMsgBody",ex),null}},Postman.prototype.getParameterByName=function(name,href){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(href);return null==results?"":decodeURIComponent(results[1].replace(/\+/g," "))},Postman.prototype.getListOfHeaders=function(encryptedList){try{var listOfHeaders=Postman.prototype.decrypt(encryptedList).list;if(0==Array.isArray(listOfHeaders))return null;for(var i=0;i<listOfHeaders.length;i++)if("string"!=typeof listOfHeaders[i].msgID||"number"!=typeof listOfHeaders[i].size||2!=Object.keys(listOfHeaders[i]).length)return null;return listOfHeaders}catch(ex){return null}},Postman.prototype.getPlanImgFromServer=function(input){try{var parameters=Postman.prototype.decrypt(input);return null==parameters||0==Postman.prototype._isUUID(parameters.planId)||"string"!=typeof parameters.imgsrc||2!=Object.keys(parameters).length?(log.debug("getPlanImgFromServer - type check",parameters),null):parameters}catch(ex){return log.debug("getPlanImgFromServer - type check",ex),null}},Postman.prototype.getPlansAround=function(encryptedList){try{var listOfPlans=Postman.prototype.decrypt(encryptedList).list;if(0==Array.isArray(listOfPlans))return null;for(var i=0;i<listOfPlans.length;i++)if(0==Postman.prototype._isUUID(listOfPlans[i].planId)||0==Postman.prototype._isUUID(listOfPlans[i].organizer)||"string"!=typeof listOfPlans[i].nickName||"string"!=typeof listOfPlans[i].commentary||"string"!=typeof listOfPlans[i].location.lat||"string"!=typeof listOfPlans[i].location.lon||2!=Object.keys(listOfPlans[i].location).length||"string"!=typeof listOfPlans[i].meetingInitDate||"string"!=typeof listOfPlans[i].meetingInitTime.hour||"string"!=typeof listOfPlans[i].meetingInitTime.mins||2!=Object.keys(listOfPlans[i].meetingInitTime).length)return log.debug(listOfPlans[i]),null;return listOfPlans}catch(ex){return null}},Postman.prototype.getProcessNewContacts=function(encryptedList){try{var listOfNewContacts=Postman.prototype.decrypt(encryptedList).list;if(0==Array.isArray(listOfNewContacts))return log.debug("Postman.prototype.getProcessNewContacts - type check 1",listOfNewContacts),null;for(var i=0;i<listOfNewContacts.length;i++)if("string"!=typeof listOfNewContacts[i].publicClientID||"string"!=typeof listOfNewContacts[i].nickName&&null!=listOfNewContacts[i].nickName||"string"!=typeof listOfNewContacts[i].commentary&&null!=listOfNewContacts[i].commentary||"object"!=typeof listOfNewContacts[i].location||"string"!=typeof listOfNewContacts[i].pubKeyPEM||5!=Object.keys(listOfNewContacts[i]).length)return log.debug("Postman.prototype.getProcessNewContacts - type check 2",listOfNewContacts),null;return listOfNewContacts}catch(ex){return log.debug("Postman.prototype.getProcessNewContacts - type check 3",listOfNewContacts),null}},Postman.prototype.getDeliveryReceipt=function(inputDeliveryReceipt){try{var deliveryReceipt=Postman.prototype.decrypt(inputDeliveryReceipt);return null==deliveryReceipt||"string"!=typeof deliveryReceipt.msgID||"string"!=typeof deliveryReceipt.typeOfACK||"string"!=typeof deliveryReceipt.to||3!=Object.keys(deliveryReceipt).length?null:deliveryReceipt}catch(ex){return log.debug("Postman.prototype.getDeliveryReceipt",ex),null}},Postman.prototype.getProfileRequest=function(input){try{var parameters=Postman.prototype.decrypt(input);return null==parameters||"number"!=typeof parameters.lastProfileUpdate||1!=Object.keys(parameters).length?(log.debug("Postman.prototype.getProfileRequest - type check",parameters),null):parameters}catch(ex){return log.debug("Postman.prototype.getProfileRequest - type check",ex),null}},Postman.prototype.getProfileFromServer=function(input){try{var parameters=Postman.prototype.decrypt(input);return null==parameters||"string"!=typeof parameters.publicClientID||null==parameters.publicClientID||"string"!=typeof parameters.nickName||null==parameters.nickName||"string"!=typeof parameters.commentary||null==parameters.commentary||"string"!=typeof parameters.imgsrc||null==parameters.imgsrc||"string"!=typeof parameters.telephone||null==parameters.telephone||"string"!=typeof parameters.email||null==parameters.email?(log.debug("Postman.prototype.getProfileFromServer - type check",parameters),null):parameters}catch(ex){return log.debug("Postman.prototype.getProfileFromServer - type check",ex),null}},Postman.prototype.getLocationFromServer=function(input){try{var position=Postman.prototype.decrypt(input);return null==position||"object"!=typeof position||"object"!=typeof position.coords?(log.debug("Postman.prototype.getLocationFromServer - type check",position),null):position}catch(ex){return log.debug("Postman.prototype.getLocationFromServer - type check",ex),null}},Postman.prototype.getKeysDelivery=function(encrypted){try{var input=Postman.prototype.decrypt(encrypted);return null==input||0==Postman.prototype._isUUID(input.to)||0==Postman.prototype._isUUID(input.from)||"object"!=typeof input.setOfKeys||3!=Object.keys(input).length?(log.debug("Postman.prototype.getKeysDelivery - type check",input),null):input}catch(ex){return log.debug("Postman.prototype.getKeysDelivery - type check",ex),null}},Postman.prototype.getKeysRequest=function(encrypted){try{var input=Postman.prototype.decrypt(encrypted);return null==input||0==Postman.prototype._isUUID(input.to)||0==Postman.prototype._isUUID(input.from)||2!=Object.keys(input).length?(log.debug("Postman.prototype.getKeysRequest - type check",input),null):input}catch(ex){return log.debug("Postman.prototype.getKeysRequest - type check",ex),null}},Postman.prototype.getMessageFromClient=function(input){try{if(input.messageBody=Postman.prototype.decryptMsgBody(input),null==input.messageBody||0==Postman.prototype._isUUID(input.to)||0==Postman.prototype._isUUID(input.from)||0==Postman.prototype._isUUID(input.msgID))return log.error("Postman.prototype.getMessageFromClient - type check",input),null;var message=new Message(input);return message.setACKfromServer(!0),message.setACKfromAddressee(!0),message}catch(ex){return log.error("Postman.prototype.getMessageFromClient - type check",ex),null}},Postman.prototype.getWhoIsOnline=function(encrypted){try{var input=Postman.prototype.decrypt(encrypted);return null==input||0==Postman.prototype._isUUID(input.idWhoIsOnline)||1!=Object.keys(input).length?(log.debug("Postman.prototype.getWhoIsOnline - type check",input),null):input}catch(ex){return log.debug("Postman.prototype.getWhoIsOnline - type check",ex),null}},Postman.prototype.getWhoIsWriting=function(encrypted){try{var input=Postman.prototype.decrypt(encrypted);return null==input||0==Postman.prototype._isUUID(input.idWhoIsWriting)||0==Postman.prototype._isUUID(input.toWhoIsWriting)||2!=Object.keys(input).length?(log.debug("Postman.prototype.getWhoIsWriting - type check",input),null):input}catch(ex){return log.debug("Postman.prototype.getWhoIsWriting - type check",ex),null}},Postman.prototype.onMsgFromClient=function(input){var msg=postman.getMessageFromClient(input);if(null!=msg){var messageACK={to:msg.to,from:msg.from,msgID:msg.msgID,typeOfACK:"ACKfromAddressee"};if(postman.send("MessageDeliveryACK",messageACK),"multimedia"==msg.messageBody.messageType||"text"==msg.messageBody.messageType||"inclusionRequest"==msg.messageBody.messageType){var publicClientID;publicClientID=msg.to!=msg.chatWith?msg.chatWith:msg.from;var obj=abstractHandler.getObjById(publicClientID);if("undefined"==typeof obj)return;if(obj.isBlocked)return;msg.setChatWith(publicClientID),mailBox.storeMessage(msg),app.currentChatWith==publicClientID?gui.showMsgInConversation(msg,{isReverse:!1,withFX:!0}):(obj.counterOfUnreadSMS++,gui.refreshCounterOfChat(obj)),obj.timeLastSMS=msg.timestamp,obj.lastMsgTruncated=msg.getTruncatedMsg(),gui.setTimeLastSMS(obj),abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj),gui.showEntryOnMainPage(obj,!1),gui.showLocalNotification(msg),gui.showLastMsgTruncated(obj)}else if("groupUpdate"==msg.messageBody.messageType){var group=new Group(msg.messageBody.group);groupsHandler.setGroupOnList(group),groupsHandler.setGroupOnDB(group),gui.showGroupsOnGroupMenu(),gui.showEntryOnMainPage(group,!1),group.listOfMembers.map(function(publicClientID){if(user.publicClientID!=publicClientID){var contact=contactsHandler.getContactById(publicClientID);"undefined"!=typeof contact&&null!=contact||(contact=new ContactOnKnet({publicClientID:publicClientID}),contactsHandler.setContactOnList(contact),contactsHandler.setContactOnDB(contact),contactsHandler.sendProfileRequest(contact))}})}else if("req4call"==msg.messageBody.messageType){if(easyrtc._isAmissedCall(msg))return;app.currentChatWith=msg.from;var callbackAccept=function(){easyrtc._proccessCall(msg)},callbackReject=function(){easyrtc._sendRejection2peer(msg)};gui.showConferencePage(callbackAccept,callbackReject),$("#callAcceptButton").show()}else if("res4call"==msg.messageBody.messageType){if(easyrtc._isAmissedCall(msg))return;if(null==msg.messageBody.easyRTCid)return void easyrtc._releaseResources()}}},Postman.prototype.send=function(event2trigger,data){if("string"!=typeof event2trigger||"object"!=typeof data||null==data)return log.debug("Postman.prototype.send - type check",data),null;try{"undefined"!=typeof socket&&1==socket.connected&&socket.emit(event2trigger,Postman.prototype.encrypt(data))}catch(e){log.debug("Postman.prototype.send - type check",e)}},Postman.prototype.sendMsg=function(msg){try{if(null==msg.messageBody)return log.debug("Postman.prototype.sendMsg ::: type check failed"),void mailBox.removeMessage(msg);var obj=abstractHandler.getObjById(msg.chatWith);obj.timeLastSMS=msg.timestamp,obj.lastMsgTruncated=msg.getTruncatedMsg(),gui.setTimeLastSMS(obj),abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj),gui.showEntryOnMainPage(obj,!1),gui.showLastMsgTruncated(obj);var listOfMsg2send=[],membersOfGroup=groupsHandler.getMembersOfGroup(msg.chatWith);membersOfGroup.length>0?membersOfGroup.map(function(memberPublicId){if(user.publicClientID!=memberPublicId){var copyOfMsg=new Message(msg);copyOfMsg.to=memberPublicId,listOfMsg2send.push(copyOfMsg)}}):listOfMsg2send.push(msg),listOfMsg2send.map(function(m){m.messageBody=postman.encryptMsgBody(m),"undefined"!=typeof socket&&1==socket.connected&&socket.emit("message2client",m)})}catch(e){log.debug("Postman.prototype.sendMsg",e)}},Postman.prototype.signToken=function(message){try{var stringMessage=JSON.stringify(message),pHeader={alg:"HS512",typ:"JWT"},sHeader=JSON.stringify(pHeader),stringJWS="";return stringJWS=KJUR.jws.JWS.sign("HS512",sHeader,stringMessage,app.symetricKey2use)}catch(ex){return null}},GUI.prototype._parseLinks=function(htmlOfContent){var result={};result.mediaLinks=[];var urlRegEx=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/g;return result.htmlOfContent=htmlOfContent.replace(urlRegEx,function(match){var link2media=gui._testUrlForMedia(match);return link2media?result.mediaLinks.push(link2media):"http"!=match.substring(1,4)&&(match="http://"+match),"<a href='"+match+"'>"+match+"</a>"}),result},GUI.prototype._sanitize=function(html){var oldHtml,tagBody="(?:[^\"'>]|\"[^\"]*\"|'[^']*')*",tagOrComment=new RegExp("<(?:!--(?:(?:-*[^->])*--+|-?)|script\\b"+tagBody+">[\\s\\S]*?</script\\s*|style\\b"+tagBody+">[\\s\\S]*?</style\\s*|/?[a-z]"+tagBody+")>","gi");do oldHtml=html,html=html.replace(tagOrComment,"");while(html!==oldHtml);return html.replace(/</g,"&lt;")},GUI.prototype._sortChats=function(){var ul=$("ul#listOfContactsInMainPage"),li=ul.children("li");li.detach().sort(function(a,b){return parseInt($(a).data("sortby"))<parseInt($(b).data("sortby"))}),ul.empty(),ul.append(li),$("#listOfContactsInMainPage").listview().listview("refresh")},GUI.prototype._testUrlForMedia=function(url){var success=!1,media={},youtube_Reg=/https?:\/\/(?:www\.)?(?:(?:youtu\.be\/)|(?:(?:(?:youtube-nocookie\.com\/|youtube\.com\/|youtu\.be\/).*)(?:(?:v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))))([^#\&\?]*).*/,match=url.match(youtube_Reg);if(match)media.type="youtube",media.id=match[1].split(" ")[0],media.url=url,success=!0;else{var vimeo_Reg=/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/,match=url.match(vimeo_Reg);match&&(media.type="vimeo",media.id=match[3],media.url=url,success=!0)}return!!success&&media},GUI.prototype.bindButtonsOnMainPage=function(){(app.isMobile&&app.devicePlatform.indexOf("iOS")>-1||$.browser.ipad||$.browser.iphone||$.browser.ipod||app.isMobile&&("WinCE"==app.devicePlatform||"Win32NT"==app.devicePlatform))&&($("#link2activateAccount").remove().trigger("updatelayout"),$("#mypanel-list").listview().listview("refresh"),$("#mypanel").trigger("updatelayout")),$("#link2panel").on("click",function(){$("#mypanel").panel("open")}),$(".button2mainPage").on("click",function(){$("body").pagecontainer("change","#MainPage",{transition:"none"})}),$("#mapButtonInMainPage").on("click",function(){""!=app.myPosition.coords.latitude&&$("body").pagecontainer("change","#map-page",{transition:"none"})})},GUI.prototype.bindDOMevents=function(){function disableBack(){window.history.forward()}window.onload=disableBack(),window.onpageshow=function(evt){evt.persisted&&disableBack()},$("body").on("pagecontainertransition",function(event,ui){if("#MainPage"==ui.options.target?($("#chat-page-content").empty(),$("#ProfileOfContact-page").empty(),app.currentChatWith=null,gui.listOfImages4Gallery=null,gui.listOfImages4Gallery=[],gui.indexOfImages4Gallery=0,gui.onProfileUpdate(),$.mobile.silentScroll(0),"WinCE"==app.devicePlatform||"Win32NT"==app.devicePlatform?document.removeEventListener("backbutton",gui.onBackButton,!1):document.addEventListener("backbutton",gui.onBackButton,!1)):document.addEventListener("backbutton",gui.onBackButton,!1),"#map-page"==ui.options.target&&gui.loadMaps(),"#ProfileOfContact-page"==ui.options.target,"#chat-page"==ui.options.target&&$("#ProfileOfContact-page").remove(),"#profile"==ui.options.target&&gui.loadProfile(),"#createGroup"==ui.options.target&&gui.loadGroupMenu(),"#forwardMenu"==ui.options.target&&gui.loadTargetsOnForwardMenu(),"#searchPage"==ui.options.target&&gui.loadMapSearch(),"#searchResultsPage"==ui.options.target){$("#listInResultsPage").empty();var previousMaker=gui.searchMap.currentMarker,latlng=previousMaker.getLatLng();app.sendRequest4Neighbours(latlng),app.sendRequest4Plans(latlng),gui.loadMapPlanPage("mapResultPage")}"#createPlanPage"==ui.options.target&&(gui.loadGroupInPlanPage(),gui.loadImgPkrInPlanPage(),gui.loadMapPlanPage("mapPlanPage"),gui.loadDatePkrInPlanPage()),gui.hideLoadingSpinner()}),$(document).on("pageshow","#emoticons",function(event){$("#chat-input").emojiPicker("toggle")}),$(document).on("pageshow","#chat-page",function(event,ui){$.mobile.silentScroll($(document).height()),$("#chat-input").emojiPicker("hide"),"emoticons"==ui.prevPage.attr("id")&&$("#chat-input").focus()}),$(document).on("pageshow","#profile",function(event){""==user.myCurrentNick?$("#nickNameInProfile").html(user.publicClientID):$("#nickNameInProfile").html(user.myCurrentNick),$("#profileNameField").val(user.myCurrentNick),$("#commentaryInProfile").html(user.myCommentary),$("#profileCommentary").val(user.myCommentary),$("#profileTelephone").val(user.myTelephone),$("#profileEmail").val(user.myEmail),$("#flip-visible").val(user.visibility).slider("refresh"),$("#label_id_profile").html("&#x1F511; "+user.publicClientID)}),$("#chat-input").css({width:.7*$(window).width(),height:54}).emojiPicker({width:$(window).width(),height:$(window).height(),button:!1}).on("input",function(){var textMessage=$("#chat-input").val();""==textMessage?($("#chat-multimedia-image").attr("src","res/multimedia.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showImagePic)):($("#chat-multimedia-image").attr("src","js/36x36/1f600.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showEmojis))}).keyup(function(event){13==event.keyCode&&gui.onChatInput();var currentTime=(new Date).getTime(),lastkeyup=parseInt($(event.target).data("lastkeyup"));if(currentTime-5*config.TIME_FADE_WRITING>lastkeyup){$(event.target).data("lastkeyup",currentTime);var list=[],membersOfGroup=groupsHandler.getMembersOfGroup(app.currentChatWith);membersOfGroup.length>0?membersOfGroup.map(function(memberPublicId){user.publicClientID!=memberPublicId&&list.push(memberPublicId)}):list.push(app.currentChatWith);var ping={idWhoIsWriting:user.publicClientID,toWhoIsWriting:app.currentChatWith,listOfReceivers:list};postman.send("WhoIsWriting",ping)}}).focus(function(){$("#chat-multimedia-image").attr("src","js/36x36/1f600.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showEmojis)}).click(function(){$("#chat-multimedia-image").attr("src","js/36x36/1f600.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showEmojis)}),$("#chat-multimedia-button").bind("click",gui.showImagePic),$(".backButton").on("click",function(){gui.onBackButton()}),$("#nickNameInProfile").on("click",function(){$("#profileNameField").focus()}),$("#profileNameField").on("input",function(){user.myCurrentNick=$("#profileNameField").val(),$("#nickNameInProfile").text(user.myCurrentNick),app.profileIsChanged=!0}).on("focus",function(){user.myCurrentNick==user.publicClientID&&($("#nickNameInProfile").html(""),$("#profileNameField").val(""))}),$("#commentaryInProfile").on("click",function(){$("#profileCommentary").focus()}),$("#profileCommentary").on("input",function(){user.myCommentary=$("#profileCommentary").val(),$("#commentaryInProfile").text(user.myCommentary),app.profileIsChanged=!0}),$("#nickNameGroup").on("click",function(){$("#nickNameGroupField").focus()}),$("#nickNameGroupField").on("input",function(){gui.groupOnMenu.nickName=$("#nickNameGroupField").val(),$("#nickNameGroup").text(gui.groupOnMenu.nickName)}).on("focus",function(){dictionary.Literals.label_23==$("#nickNameGroupField").val()&&($("#nickNameGroup").html(""),$("#nickNameGroupField").val(""))}),$("#commentaryGroup").on("click",function(){$("#commentaryGroupField").focus()}),$("#commentaryGroupField").on("input",function(){gui.groupOnMenu.commentary=$("#commentaryGroupField").val(),$("#commentaryGroup").text(gui.groupOnMenu.commentary)}).on("focus",function(){dictionary.Literals.label_12==$("#commentaryGroupField").val()&&($("#commentaryGroup").html(""),$("#commentaryGroupField").val(""))}),$("#nickNamePlan").on("click",function(){$("#nickNamePlanField").focus()}),$("#nickNamePlanField").on("input",function(){gui.groupOnMenu.nickName=$("#nickNamePlanField").val(),$("#nickNamePlan").text(gui.groupOnMenu.nickName)}).on("focus",function(){dictionary.Literals.label_23==$("#nickNamePlanField").val()&&($("#nickNamePlan").html(""),$("#nickNamePlanField").val(""))}),$("#commentaryPlan").on("click",function(){$("#commentaryPlanField").focus()}),$("#commentaryPlanField").on("input",function(){gui.groupOnMenu.commentary=$("#commentaryPlanField").val(),$("#commentaryPlan").text(gui.groupOnMenu.commentary)}).on("focus",function(){dictionary.Literals.label_12==$("#commentaryPlanField").val()&&($("#commentaryPlan").html(""),$("#commentaryPlanField").val(""))}),$("#profileTelephone").on("input",function(){user.myTelephone=$("#profileTelephone").val(),app.profileIsChanged=!0}),$("#profileEmail").on("input",function(){user.myEmail=$("#profileEmail").val(),app.profileIsChanged=!0}),$("#flip-visible").on("change",function(){user.visibility=$("#flip-visible").val(),app.profileIsChanged=!0}),$("#mapButtonInChatPage").on("click",function(){""!=app.myPosition.coords.latitude&&gui.photoGalleryClosed&&$("body").pagecontainer("change","#map-page",{transition:"none"})}),$("#buyButton").on("click",app.onProcessPayment),$("input[name='license-choice']").on("change",gui.refreshPurchasePrice),$("#NGOdonation").on("change",gui.refreshPurchasePrice),$("#FSIdonation").on("change",gui.refreshPurchasePrice),$("#groupsButton").on("click",gui.onGroupsButton).text(dictionary.Literals.label_38).data("action","create"),$(window).on("debouncedresize",function(event){$("#chat-input").css({width:.7*$(window).width(),height:54}).emojiPicker("reset")}),$("#link2profileOfContact").bind("click",function(){
gui.showProfile()}),app.events.documentReady.resolve(),$("input, textarea").off("touchstart mousedown").on("touchstart mousedown",function(e){e.stopPropagation()}),$("#label_60").on("click",function(){gui.showTermsAndConditions()}),$("#label_65").unbind("click").bind("click",function(){$("body").pagecontainer("change","#createPlanPage",{transition:"none"})}),$("#label_66").unbind("click").bind("click",function(){$("body").pagecontainer("change","#searchResultsPage",{transition:"none"})}),$("#planSubmitButton").on("click",gui.onPlanSubmit).text(dictionary.Literals.label_38).data("action","create"),history.pushState(null,null,null),window.addEventListener("popstate",function(event){history.pushState(null,null,null)}),$("#performCall").on("click",function(){easyrtc._peerRequest4aCall()}),$(".searchBtn").click(function(){""!=app.myPosition.coords.latitude&&$("body").pagecontainer("change","#searchPage",{transition:"none"})})},GUI.prototype.bindPagination=function(newerDate){var str='<button id="paginationButton">'+dictionary.Literals.label_41+"</button>";$("#chat-page-content").prepend(str).trigger("create"),$("#paginationButton").unbind("click").bind("click",function(){gui.showLoadingSpinner(),$("#paginationButton").remove(),mailBox.retrieveMessages(app.currentChatWith,newerDate).done(function(list){list.map(function(message){gui.showMsgInConversation(message,{isReverse:!0,withFX:!1})}),gui.hideLoadingSpinner();var size=list.length;size==config.MAX_SMS_RETRIEVAL&&gui.bindPagination(list[size-1].timestamp)}),gui.hideLoadingSpinner()})},GUI.prototype.forwardMsg=function(contact){mailBox.getMessageByID(app.msg2forward).done(function(msg){return"undefined"==typeof msg||null==msg?void logger.debug("GUI.prototype.forwardMsg - ",msg):void app.forwardMsg(msg,contact)}),$("body").pagecontainer("change","#chat-page",{transition:"none"})},GUI.prototype.getPurchaseDetails=function(){var purchase={};return purchase.licenseDurationChoosen=$("input[name='license-choice']:checked").val(),purchase.isNGOdonationChecked=$("#NGOdonation").is(":checked"),purchase.isFSIdonationChecked=$("#FSIdonation").is(":checked"),purchase},GUI.prototype.hideLoadingSpinner=function(){$(".mask-color").fadeOut("fast")},GUI.prototype.hideLocalNotifications=function(){app.isMobile&&"Android"==app.devicePlatform&&cordova.plugins.notification.local.clearAll(function(){log.info("GUI.prototype.hideLocalNotifications - notification cleared")},this)},GUI.prototype.loadAsideMenuMainPage=function(){var strVar="";strVar+='<div data-role="panel" id="mypanel" data-display="overlay">',strVar+='  <ul id="mypanel-list" data-role="listview" data-inset="true" data-divider-theme="b">',strVar+='\t\t<li id="link2profile" data-icon="false">',strVar+="\t\t\t<a>",strVar+='\t\t\t\t<img src="res/profile_black_195x195.png" >',strVar+='\t\t\t\t<h2 id="label_1">Profile</h2>',strVar+="\t\t\t</a>",strVar+="\t\t</li>",strVar+='\t\t<li id="link2createGroup" data-icon="false">',strVar+="\t\t\t<a>",strVar+='\t\t\t\t<img src="res/group_black_195x195.png" >',strVar+='\t\t\t\t<h2 id="label_2" >Groups</h2>',strVar+="\t\t\t</a>",strVar+="\t\t</li>",strVar+='\t\t<li id="link2searchPage" data-icon="false">',strVar+="\t\t\t<a>",strVar+='\t\t\t\t<img src="res/visibles_black_195x195.png" >',strVar+='\t\t\t\t<h2 id="label_3">Search</h2>',strVar+="\t\t\t</a>",strVar+="\t\t</li>",strVar+='\t\t<li id="link2activateAccount" data-icon="false">',strVar+="\t\t\t<a>",strVar+='\t\t\t\t<img src="res/account_black_195x195.png" >',strVar+='\t\t\t\t<h2 id="label_4">Account</h2>',strVar+="\t\t\t</a>",strVar+="\t\t</li>",strVar+="  </ul>",strVar+="</div><!-- /panel -->",$("#MainPage").append(strVar),$("#link2profile").click(function(){$("body").pagecontainer("change","#profile",{transition:"none"})}),$("#link2createGroup").click(function(){$("body").pagecontainer("change","#createGroup",{transition:"none"})}),$("#link2searchPage").click(function(){""!=app.myPosition.coords.latitude&&$("body").pagecontainer("change","#searchPage",{transition:"none"})}),$("#link2activateAccount").click(function(){$("body").pagecontainer("change","#activateAccount",{transition:"none"})}),$("#MainPage").trigger("create")},GUI.prototype.loadBody=function(){var strVar="";strVar+=' \t<div data-role="page" data-theme="a" id="searchPage">',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t    \t\t</a>",strVar+="\t    \t\t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t    <div class="ui-block-d"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div role="main" id="searchMap" >',strVar+="\t\t        \t<!-- map loads here...  -->",strVar+="\t\t  \t</div>",strVar+='\t\t\t<div data-role="content" data-theme="a">',strVar+=' \t\t\t<a id="label_65" class="ui-btn ui-corner-all ui-shadow ui-btn-b" > create a plan</a>',strVar+=' \t\t\t<a id="label_66" class="ui-btn ui-corner-all ui-shadow ui-btn-b" > find people or join a plan </a>',strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page searchPage-->",strVar+=' \t<div data-role="page" data-theme="a" id="createPlanPage">',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t    \t\t</a>",strVar+="\t\t    \t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t    <div class="ui-block-d"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div data-role="content" data-theme="a"> ',strVar+='\t\t\t\t<div class="container" id="main">',strVar+='\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="sidebar">',strVar+='\t\t\t\t\t\t\t\t<div class="user">',strVar+='\t\t\t\t\t\t\t\t\t<div id="imagePlanContainer" class="text-center" data-role="none" >',strVar+='\t\t\t\t\t\t\t\t\t\t<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="image4Plan" class="picedit_box">',strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t<div class="user-head">',strVar+='\t\t\t\t\t\t\t\t\t\t<h1  id="nickNamePlan" ></h1>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',strVar+='\t\t\t\t\t\t\t\t\t\t<h5 id="commentaryPlan" ></h5>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="content">',strVar+='\t\t\t\t\t\t\t\t<div class="main-content">',strVar+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',strVar+='\t\t\t\t\t\t\t\t\t\t<h1 id="label_72"> Plan </h1>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-left"></div>',strVar+="\t\t\t\t\t\t\t\t\t\t<p></p>",strVar+='\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="nickNamePlanField" class="form-control input-lg" placeholder="Name..."> ',strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<textarea id="commentaryPlanField" class="form-control input-lg" placeholder="Description..."> </textarea>',strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t          \t\t\t\t<div id="mapPlanPage" class="mapPlanPage">',strVar+="\t\t\t\t\t          \t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t\t\t\t<p></p>",strVar+="\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_70" data-role="none"  class="myDatePicker form-control input-lg " placeholder=""> ',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_71" data-role="none"  class="form-control input-lg myTimePicker" placeholder=""> ',strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t<button id="planSubmitButton">create</button>',strVar+="\t\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t</div>",strVar+="\t\t\t\t</div>",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page createPlanPage-->",strVar+=' \t<div data-role="page" data-theme="a" id="searchResultsPage">',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t    \t\t</a>",strVar+="\t\t    \t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t    <div class="ui-block-d"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div data-role="content" data-theme="a"> ',strVar+='\t\t\t\t<div class="container" id="main">',strVar+='\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="sidebar">',strVar+='\t\t\t\t\t\t\t\t<div class="user">',strVar+='\t\t\t\t\t          \t\t<div id="mapResultPage" class="mapPlanPage">',strVar+="\t\t\t\t\t          \t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="content">',strVar+='\t\t\t\t\t\t\t\t<div class="main-content">',strVar+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',strVar+='\t\t\t\t\t\t\t\t\t\t<ul id="listInResultsPage" data-role="listview" data-inset="true" data-divider-theme="b">',strVar+="\t\t\t\t\t\t\t\t\t\t</ul>",strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t</div>",strVar+="\t\t\t\t</div>",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page searchResultsPage-->",strVar+='\t\t<div data-role="page" data-theme="a" id="createGroup">',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t    \t\t</a>",strVar+="\t\t    \t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t    <div class="ui-block-d"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div data-role="content" data-theme="a"> ',strVar+='\t\t\t\t<div class="container" id="main">',strVar+='\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="sidebar">',strVar+='\t\t\t\t\t\t\t\t<div class="user">',strVar+='\t\t\t\t\t\t\t\t\t<div id="imageGroupContainer" class="text-center" data-role="none" >',strVar+='\t\t\t\t\t\t\t\t\t\t<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="imageGroup" class="picedit_box">',strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t<div class="user-head">',strVar+='\t\t\t\t\t\t\t\t\t\t<h1  id="nickNameGroup" ></h1>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',strVar+='\t\t\t\t\t\t\t\t\t\t<h5 id="commentaryGroup" ></h5>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="content">',strVar+='\t\t\t\t\t\t\t\t<div class="main-content">',strVar+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',strVar+='\t\t\t\t\t\t\t\t\t\t<h1 id="label_21">New Group</h1>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-left"></div>',strVar+="\t\t\t\t\t\t\t\t\t\t<p></p>",strVar+='\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="nickNameGroupField" class="form-control input-lg" placeholder="Name..."> ',strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="commentaryGroupField" class="form-control input-lg" placeholder="Commentary...">',strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<button id="groupsButton">create</button>',strVar+="\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t<ul id="contacts4Group" data-role="listview" data-inset="true" data-divider-theme="a"></ul>',strVar+='\t\t\t\t\t\t\t\t\t\t\t<h1 id="label_37">My Groups</h1>',strVar+='\t\t\t\t\t\t\t\t\t\t\t<ul id="listOfGroups" data-role="listview" data-inset="true" data-divider-theme="a"></ul>',strVar+='\t\t\t\t\t\t\t\t\t\t\t<h1 id="label_52">Blocked people</h1>',strVar+='\t\t\t\t\t\t\t\t\t\t\t<ul id="listOfBlocked" data-role="listview" data-inset="true" data-divider-theme="a"></ul>',strVar+="\t\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t</div>",strVar+="\t\t\t\t</div>",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page createGroup-->",strVar+='\t\t<div data-role="page" data-theme="a" id="profile">',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t    \t\t</a>",strVar+="\t    \t\t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>';strVar+='\t\t\t    <div class="ui-block-c"></div>';strVar+='\t\t\t    <div class="ui-block-d"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div data-role="content" data-theme="a">',strVar+='\t\t\t\t<div class="container" id="main">',strVar+='\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="sidebar">',strVar+='\t\t\t\t\t\t\t\t<div class="user">',strVar+='\t\t\t\t\t\t\t\t\t<div class="text-center" data-role="none" >',strVar+='\t\t\t\t\t\t\t\t\t\t<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="imageProfile" class="picedit_box">',strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t<div class="user-head">',strVar+='\t\t\t\t\t\t\t\t\t\t<h1  id="nickNameInProfile" ></h1>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',strVar+='\t\t\t\t\t\t\t\t\t\t<h5 id="commentaryInProfile" ></h5>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="content">',strVar+='\t\t\t\t\t\t\t\t<div class="main-content">',strVar+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',strVar+='\t\t\t\t\t\t\t\t\t\t<h1 id="label_22">Profile</h1>',strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-left"></div>',strVar+="\t\t\t\t\t\t\t\t\t\t<p></p>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileNameField" class="form-control input-lg" placeholder="Name..."> ',strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileCommentary" class="form-control input-lg" placeholder="Commentary...">',strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileTelephone" class="form-control input-lg" placeholder="telephone...">',strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileEmail" class="form-control input-lg" placeholder="e-mail...">',strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<h2 id="label_8"> you visible for...</h2>',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<h3 id="label_9">Anybody</h3>',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<p id="label_10">should you switch this off, then only your contacts would see you online, is not that boring?</p>\t',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<select name="flip-visible" id="flip-visible" data-role="slider" >',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="on">on</option>',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="off">off</option>',strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</select>",strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<a><h2 id="label_60"> Privacy Policy</h2></a>',strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t          \t\t\t<div class="col-md-12">',strVar+='\t\t\t\t\t    \t      \t\t\t\t<abbr title="id" id="label_id_profile">  </abbr> ',strVar+="\t\t\t\t\t        \t  \t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t</div>",strVar+="\t\t\t\t</div>",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page profile-->",strVar+='\t\t<div data-role="page" data-cache="false" id="map-page" data-url="map-page">',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t    \t\t</a> ",strVar+="\t    \t\t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t    <div class="ui-block-e"><a data-role="button" class="ui-nodisc-icon icon-list"><img src="res/bubble_36x36.png" class="button2mainPage button ui-li-icon ui-corner-none "></a></div>',strVar+='\t\t\t    <div class="ui-block-e"><a id="mapButtonInmap-page" data-role="button" class="ui-nodisc-icon icon-list"><img src="res/mundo_36x36.png" class="ui-li-icon ui-corner-none "></a></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div role="main" id="map-canvas" >',strVar+="\t\t        \t<!-- map loads here...  -->",strVar+="\t\t  \t</div>",strVar+='\t\t\t<div data-role="content" data-theme="a">',strVar+='\t\t\t\t<ul id="listOfContactsInMapPage" data-role="listview" data-inset="true" data-divider-theme="b">',strVar+="\t\t\t\t</ul>",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page map-page-->",strVar+='\t\t<div data-role="page" id="chat-page" data-url="chat-page" >',strVar+='\t\t\t<div id="chat-page-header" data-role="header" data-position="fixed">',strVar+='\t\t\t\t<div class="ui-grid-d">',strVar+='\t\t\t\t\t<div class="ui-block-a"><a data-role="button" class="backButton ui-nodisc-icon icon-list"><img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none "></a></div>',strVar+='\t\t\t\t    <div class="ui-block-b">',strVar+='\t\t\t\t\t   \t<a id="link2profileOfContact" data-role="button" class="imgOfChat-page" data-inline="false">',strVar+='\t\t\t\t       \t\t<img id="imgOfChat-page-header" src="" class="imgOfChat-page-header">',strVar+="\t\t\t\t   \t\t</a>",strVar+="\t\t\t       \t</div>",strVar+='\t\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t\t    <div id="performCall" class="ui-block-d"><a data-role="button" class="ui-nodisc-icon icon-list"><img src="res/conference.png" alt="lists" class="button ui-li-icon ui-corner-none max-nav-button"></a></div>',strVar+='\t\t\t\t    <div class="ui-block-e"><a id="mapButtonInChatPage" data-role="button" class="ui-nodisc-icon icon-list"><img src="res/mundo_36x36.png" alt="lists" class="ui-li-icon ui-corner-none "></a></div>',strVar+="\t\t\t  \t</div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div id="chat-page-content" role="main" class="ui-content">',strVar+="\t\t\t</div><!-- /content -->",strVar+='\t\t\t<div data-role="footer" data-position="fixed">\t\t\t\t',strVar+='\t\t\t\t<div id="chat-multimedia-button" class="ui-block-20percent" >\t\t\t\t\t',strVar+='\t\t\t\t\t<a data-role="button" ><img id="chat-multimedia-image" src="res/multimedia.png" class="chat-multimedia-image"> </a>',strVar+="\t\t\t\t </div>",strVar+='\t\t\t\t<div class="ui-block-80percent">\t\t\t\t\t\t\t',strVar+='\t\t\t\t\t<textarea data-role="none" id="chat-input" data-lastkeyup="0" class="textarea-chat ui-input-text ui-body-inherit ui-textinput-autogrow"> </textarea> \t\t\t\t   \t\t\t\t\t\t\t\t',strVar+="\t\t\t\t</div>",strVar+="\t\t\t</div><!-- /footer -->",strVar+="\t\t</div><!-- /page chat-page-->\t\t",strVar+='\t\t<div data-role="page" id="activateAccount" data-url="activateAccount" >',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t\t<div class="ui-grid-d">',strVar+='\t\t\t\t\t<div class="ui-block-a"><a data-role="button" class="backButton ui-nodisc-icon icon-list"><img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none "></a></div>',strVar+='\t\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t\t    <div class="ui-block-d"></div>',strVar+='\t\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  \t</div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div id="activateAccount-content" role="main" class="ui-content">',strVar+='\t\t\t\t<h1 id="label_27" class="darkink"> User account Activation  </h1>          ',strVar+='\t\t\t\t<div class="ui-field-contain">',strVar+='    \t\t\t\t<fieldset data-role="controlgroup">',strVar+='        \t\t\t\t<input type="radio" name="license-choice" id="radio-choice-v-1a" value="oneYear" checked="checked">',strVar+='        \t\t\t\t<label id="label_28" for="radio-choice-v-1a">License valid for a year</label>',strVar+='        \t\t\t\t<input type="radio" name="license-choice" id="radio-choice-v-1b" value="fourYears">',strVar+='        \t\t\t\t<label id="label_29" for="radio-choice-v-1b">License valid for 4 years</label>',strVar+='        \t\t\t\t<input type="checkbox" name="NGOdonation" id="NGOdonation">',strVar+='        \t\t\t\t<label id="label_31" for="NGOdonation">Donation for associated NGOs</label>',strVar+='        \t\t\t\t<input type="checkbox" name="FSIdonation" id="FSIdonation">',strVar+='        \t\t\t\t<label id="label_32" for="FSIdonation">Donation for our Open Source Initiative</label>',strVar+="    \t\t\t\t</fieldset>",strVar+="\t\t\t\t</div>",strVar+='\t\t\t\t<h3 class="darkink"> <spam id="label_33"> Total :</spam> <spam id="price"> 1 &euro;</spam></h3>',strVar+='\t\t\t\t<button id="buyButton">Buy</button>',strVar+='\t\t\t\t<div class="paypalButton"><img id="paypal" src="res/AM_mc_vs_dc_ae.jpg" ></div>',strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /activateAccount page-->",strVar+='\t\t<div data-role="page" data-theme="a" id="emoticons">',strVar+='\t\t\t<div role="main" class="ui-content">',strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page emoticons-->",strVar+='\t\t<div data-role="page" data-theme="a" id="multimedia">',strVar+='\t\t\t<div id="multimedia-content" role="main" class="ui-content">',strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page emoticons-->",strVar+='\t\t<div data-role="page" data-theme="a" id="forwardMenu">',strVar+='\t\t\t<div data-role="header" data-position="fixed">',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t    \t\t</a>",strVar+="\t    \t\t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t    <div class="ui-block-d"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header --> \t",strVar+='\t\t\t<div data-role="content" data-theme="a">',strVar+='\t\t\t\t<div class="container" id="forwardMenuContainer">',strVar+="\t\t\t\t</div><!-- /container-->",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page forwardMenu-->",strVar+='\t\t<div data-role="page" data-theme="a" id="conference-page" > ',strVar+='\t\t\t<div  data-theme="a"  class="ui-height-100percent">',strVar+='\t\t\t\t<div class="ui-height-70percent">',strVar+='\t\t\t\t\t<video id="conferenceTag" class="video-center"></video>',strVar+="\t\t\t\t </div>",strVar+='\t\t\t\t<div class="conferenceCallBox">',strVar+='\t\t\t    \t<a id="callAcceptButton" data-role="button" class="ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/conference_play.png" alt="lists" class="button ui-li-icon ui-corner-none max-nav-button">',strVar+="\t\t    \t\t</a>",strVar+='\t\t\t    \t<a id="callRejectButton" data-role="button" class="ui-nodisc-icon icon-list">',strVar+='\t\t\t    \t\t<img src="res/conference_stop.png" alt="lists" class="button ui-li-icon ui-corner-none max-nav-button">',strVar+="\t\t    \t\t</a>",strVar+="\t\t\t\t</div>",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- /page forwardMenu-->",$("body").append(strVar)},GUI.prototype.loadContactsOnMapPage=function(){IDBKeyRange.only("publicClientID");db.transaction(["contacts"],"readonly").objectStore("contacts").openCursor(null,"nextunique").onsuccess=function(e){var cursor=e.target.result;cursor&&(gui.showContactOnMapPage(cursor.value),cursor.continue())}},GUI.prototype.loadDatePkrInPlanPage=function(){var countryKey=Object.keys(dictionary.Literals.CLDR.main)[0],monthsWide=dictionary.Literals.CLDR.main[countryKey].dates.calendars.gregorian.months.format.wide,monthsShort=dictionary.Literals.CLDR.main[countryKey].dates.calendars.gregorian.months.format.abbreviated,weekWide=dictionary.Literals.CLDR.main[countryKey].dates.calendars.gregorian.days.format.wide,weekShort=dictionary.Literals.CLDR.main[countryKey].dates.calendars.gregorian.days.format.abbreviated,pickDataSettings={monthsFull:[monthsWide[1],monthsWide[2],monthsWide[3],monthsWide[4],monthsWide[5],monthsWide[6],monthsWide[7],monthsWide[8],monthsWide[9],monthsWide[10],monthsWide[11],monthsWide[12]],monthsShort:[monthsShort[1],monthsShort[2],monthsShort[3],monthsShort[4],monthsShort[5],monthsShort[6],monthsShort[7],monthsShort[8],monthsShort[9],monthsShort[10],monthsShort[11],monthsShort[12]],weekdaysFull:[weekWide.sun,weekWide.mon,weekWide.tue,weekWide.wed,weekWide.thu,weekWide.fri,weekWide.sat],weekdaysShort:[weekShort.sun,weekShort.mon,weekShort.tue,weekShort.wed,weekShort.thu,weekShort.fri,weekShort.sat],today:dictionary.Literals.label_67,clear:dictionary.Literals.label_68,close:dictionary.Literals.label_69,firstDay:1,formatSubmit:"yyyy/mm/dd",onOpen:function(){$("#imagePlanContainer").css("visibility","hidden"),$("#planSubmitButton").css("visibility","hidden")},onClose:function(){$("#imagePlanContainer").css("visibility","visible"),$("#planSubmitButton").css("visibility","visible")}},$dateInput=$(".myDatePicker").pickadate(pickDataSettings),picker=$dateInput.pickadate("picker");picker.set("select",new Date);var $dateInput2=$("#label_71").pickatime({clear:dictionary.Literals.label_68,onOpen:function(){$("#imagePlanContainer").css("visibility","hidden"),$("#planSubmitButton").css("visibility","hidden")},onClose:function(){$("#imagePlanContainer").css("visibility","visible"),$("#planSubmitButton").css("visibility","visible")}}),picker=$dateInput2.pickatime("picker");picker.set("select",new Date)},GUI.prototype.loadGalleryInDOM=function(){if("WinCE"!=app.devicePlatform&&"Win32NT"!=app.devicePlatform){$("#gallery").remove();var strVar="";strVar+='<div id="gallery" data-role="none" class="pswp" tabindex="-1" role="dialog" hidden>',strVar+='\t\t<div  data-role="none" class="pswp__bg"></div>',strVar+='\t\t<div data-role="none" class="pswp__scroll-wrap">',strVar+='\t\t\t<div data-role="none" class="pswp__container">',strVar+='\t\t\t\t<div data-role="none" class="pswp__item"></div>',strVar+='\t\t\t\t<div data-role="none" class="pswp__item"></div>',strVar+='\t\t\t\t<div data-role="none" class="pswp__item"></div>',strVar+="          </div>",strVar+='          <div data-role="none" class="pswp__ui pswp__ui--hidden">',strVar+='\t\t\t\t<div data-role="none" class="pswp__top-bar">',strVar+='\t\t\t\t\t<div data-role="none" class="pswp__counter"></div>',strVar+='\t\t\t\t<button data-role="none" class="pswp__button pswp__button--close" title="Close (Esc)"></button>',strVar+='\t\t\t\t<button data-role="none" class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>',strVar+='\t\t\t\t<button data-role="none" class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>',strVar+='\t\t\t\t<div class="pswp__preloader">',strVar+='\t\t\t\t\t<div class="pswp__preloader__icn">',strVar+='\t\t\t\t\t  <div class="pswp__preloader__cut">',strVar+='\t\t\t\t\t    <div class="pswp__preloader__donut"></div>',strVar+="\t\t\t\t\t  </div>",strVar+="\t\t\t\t\t</div>",strVar+="\t\t\t\t</div>",strVar+='            </div>\t<div class="pswp__loading-indicator"><div class="pswp__loading-indicator__line"></div></div> ',strVar+="\t        </div>",strVar+='            <button data-role="none" class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>',strVar+='            <button data-role="none" class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>',strVar+='            <div class="pswp__caption">',strVar+='              <div class="pswp__caption__center">',strVar+="              </div>",strVar+="            </div>",strVar+="          </div>",strVar+="        </div>",strVar+="    </div>";var activePage=$.mobile.activePage.attr("id");$("#"+activePage).append(strVar)}},GUI.prototype.loadGroupInPlanPage=function(){null==gui.groupOnMenu&&(gui.groupOnMenu=new Group({}),
gui.groupOnMenu.addMember(user));var previousMaker=gui.searchMap.currentMarker,latlng=previousMaker.getLatLng();gui.groupOnMenu.location.lat=latlng.lat.toString(),gui.groupOnMenu.location.lon=latlng.lng.toString(),$("#commentaryPlanField").val(gui.groupOnMenu.commentary),$("#commentaryPlan").text(gui.groupOnMenu.commentary),$("#nickNamePlanField").val(gui.groupOnMenu.nickName),$("#nickNamePlan").text(gui.groupOnMenu.nickName),$("#planSubmitButton").on("click",gui.onPlanSubmit).text(dictionary.Literals.label_38).data("action","create")},GUI.prototype.loadImgPkrInPlanPage=function(){var html='<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="image4Plan" class="picedit_box">';$("#imagePlanContainer").empty().append(html),$("#image4Plan").picEdit({maxWidth:config.MAX_WIDTH_IMG_PROFILE,maxHeight:config.MAX_HEIGHT_IMG_PROFILE,minWidth:config.MIN_WIDTH_IMG_PROFILE,minHeight:config.MIN_HEIGHT_IMG_PROFILE,navToolsEnabled:!0,isMobile:app.isMobile,defaultImage:gui.groupOnMenu.imgsrc,imageUpdated:function(img){gui.groupOnMenu.imgsrc=img.src},onNativeCameraInit:app.onNativeCameraInit})},GUI.prototype.loadProfile=function(){var defaultImage=user.myPhotoPath;$("#imageProfile").picEdit({maxWidth:config.MAX_WIDTH_IMG_PROFILE,maxHeight:config.MAX_HEIGHT_IMG_PROFILE,minWidth:config.MIN_WIDTH_IMG_PROFILE,minHeight:config.MIN_HEIGHT_IMG_PROFILE,navToolsEnabled:!0,defaultImage:defaultImage,isMobile:app.isMobile,imageUpdated:function(img){user.myPhotoPath=img.src,user.lastProfileUpdate=(new Date).getTime(),app.profileIsChanged=!0},onNativeCameraInit:app.onNativeCameraInit})},GUI.prototype.loadGroupMenu=function(group){group?(gui.groupOnMenu=group,$("#groupsButton").text(dictionary.Literals.label_39).data("action","modify"),$("#label_21").text(dictionary.Literals.label_40)):(gui.groupOnMenu=new Group({}),gui.groupOnMenu.addMember(user),$("#label_21").text(dictionary.Literals.label_36),$("#groupsButton").text(dictionary.Literals.label_38).data("action","create")),$("#commentaryGroupField").val(gui.groupOnMenu.commentary),$("#commentaryGroup").text(gui.groupOnMenu.commentary),$("#nickNameGroupField").val(gui.groupOnMenu.nickName),$("#nickNameGroup").text(gui.groupOnMenu.nickName),gui.showContactsOnGroupMenu(),gui.showGroupsOnGroupMenu(),gui.showListOfBlocked();var html='<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="imageGroup" class="picedit_box">';$("#imageGroupContainer").empty().append(html),$("#imageGroup").picEdit({maxWidth:config.MAX_WIDTH_IMG_PROFILE,maxHeight:config.MAX_HEIGHT_IMG_PROFILE,minWidth:config.MIN_WIDTH_IMG_PROFILE,minHeight:config.MIN_HEIGHT_IMG_PROFILE,navToolsEnabled:!0,isMobile:app.isMobile,defaultImage:gui.groupOnMenu.imgsrc,imageUpdated:function(img){gui.groupOnMenu.imgsrc=img.src},onNativeCameraInit:app.onNativeCameraInit})},GUI.prototype.loadLoadingSpinner=function(){var html="";html+='<div class="mask-color">',html+='    <div id="preview-area">',html+='    <div class="spinner">',html+='      <div class="dot1"></div>',html+='      <div class="dot2"></div>',html+="    </div>",html+="</div>",html+="</div>",$("body").prepend(html),$(".mask-color").fadeOut("fast")},GUI.prototype.loadMaps=function(){null!=app.map&&(app.map.remove(),$("#listOfContactsInMapPage").empty()),app.map=L.map("map-canvas"),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(app.map),app.map.setView([app.myPosition.coords.latitude.toString(),app.myPosition.coords.longitude.toString()],14);var latlng=L.latLng(app.myPosition.coords.latitude,app.myPosition.coords.longitude);L.marker(latlng).addTo(app.map).bindPopup(dictionary.Literals.label_11).openPopup(),L.circle(latlng,200).addTo(app.map),app.map.addEventListener("load",gui.loadContactsOnMapPage())},GUI.prototype.loadMapOnProfile=function(input){var obj;if(obj=input?input:contactsHandler.getContactById(app.currentChatWith),"undefined"==typeof obj)return void $("#mapProfile").remove();gui.mapOfContact=null,gui.mapOfContact=L.map("mapProfile"),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(gui.mapOfContact),gui.mapOfContact.setView([obj.location.lat,obj.location.lon],14);var latlng=L.latLng(obj.location.lat,obj.location.lon);L.marker(latlng).addTo(gui.mapOfContact).bindPopup(obj.nickName),L.circle(latlng,200).addTo(gui.mapOfContact)},GUI.prototype.loadMapPlanPage=function(tagId){var previousMaker=gui.searchMap.currentMarker,latlng=previousMaker.getLatLng();null!=gui.searchMap&&gui.searchMap.remove(),gui.searchMap=null,gui.searchMap=L.map(tagId),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(gui.searchMap),gui.searchMap.setView(latlng,14),gui.searchMap.currentMarker=new L.marker(latlng).addTo(gui.searchMap).bindPopup(dictionary.Literals.label_64).openPopup(),gui.searchMap.currentCircle=new L.circle(latlng,1e3).addTo(gui.searchMap)},GUI.prototype.loadMapSearch=function(){null!=gui.searchMap&&gui.searchMap.remove(),gui.searchMap=null,gui.searchMap=L.map("searchMap"),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(gui.searchMap),gui.searchMap.setView([app.myPosition.coords.latitude.toString(),app.myPosition.coords.longitude.toString()],11);var latlng=L.latLng(app.myPosition.coords.latitude,app.myPosition.coords.longitude);gui.searchMap.currentMarker=new L.marker(latlng).addTo(gui.searchMap).bindPopup(dictionary.Literals.label_64).openPopup(),gui.searchMap.currentCircle=new L.circle(latlng,5e3).addTo(gui.searchMap),gui.searchMap.on("click",function(e){gui.searchMap.removeLayer(gui.searchMap.currentMarker),gui.searchMap.removeLayer(gui.searchMap.currentCircle),gui.searchMap.currentMarker=new L.marker(e.latlng).addTo(gui.searchMap).bindPopup(dictionary.Literals.label_64).openPopup(),gui.searchMap.currentCircle=new L.circle(e.latlng,5e3).addTo(gui.searchMap)})},GUI.prototype.loadTargetsOnForwardMenu=function(){$("#forwardMenuContainer").empty();var html='<ul id="listOfContactsInForwardMenu" data-role="listview" data-inset="true" data-divider-theme="a"> </ul>';$("#forwardMenuContainer").append(html),$("#forwardMenuContainer").trigger("create");IDBKeyRange.only("publicClientID");db.transaction(["contacts"],"readonly").objectStore("contacts").openCursor(null,"nextunique").onsuccess=function(e){var cursor=e.target.result;cursor&&(gui.showTargetOnForwardMenu(cursor.value),cursor.continue())};IDBKeyRange.only("publicClientID");db.transaction(["groups"],"readonly").objectStore("groups").openCursor(null,"nextunique").onsuccess=function(e){var cursor=e.target.result;if(cursor){var group=new Group(cursor.value);gui.showTargetOnForwardMenu(group),cursor.continue()}}},GUI.prototype.onAddContact2Group=function(contact){gui.showAddContact2Group(contact),gui.groupOnMenu.addMember(contact)},GUI.prototype.onAppBrowserLoad=function(event){log.info("GUI.prototype.onAppBrowserLoad - begin"),null!==event.url.match("successPayment")&&(gui.inAppBrowser.removeEventListener("exit",gui.onAppBrowserExit),gui.inAppBrowser.removeEventListener("loadstop",gui.onAppBrowserLoad),app.transactionID=decodeURI(postman.getParameterByName("transactionID",event.url)),app.licenseDurationChoosen=decodeURI(postman.getParameterByName("licenseDurationChoosen",event.url)),app.isNGOdonationChecked=decodeURI(postman.getParameterByName("isNGOdonationChecked",event.url)),app.isFSIdonationChecked=decodeURI(postman.getParameterByName("isFSIdonationChecked",event.url)),setTimeout(function(){gui.inAppBrowser.close},config.TIME_WAIT_HTTP_POST)),null!==event.url.match("cancelPayment")&&(gui.inAppBrowser.removeEventListener('navigator.notification.alert("Are',gui.onAppBrowserExit),gui.inAppBrowser.removeEventListener("loadstop",gui.onAppBrowserLoad),navigator.notification.alert("the Payment was cancelled :-(",null,"Uh oh!"),setTimeout(function(){gui.inAppBrowser.close},config.TIME_WAIT_HTTP_POST))},GUI.prototype.onAppBrowserExit=function(event){gui.inAppBrowser.removeEventListener("loadstop",gui.onAppBrowserLoad),gui.inAppBrowser.removeEventListener("exit",gui.onAppBrowserExit)},GUI.prototype.onBackButton=function(){var page=$.mobile.activePage.attr("id");switch(!0){case/MainPage/.test(page):$(".ui-popup-active").length>0?$("#popupDiv").popup("close"):"undefined"!=typeof cordova&&null!=cordova&&$.when(app.events.deviceReady,app.events.documentReady).done(function(){function onConfirmQuit(button){2==button&&(cordova.plugins.notification.local.cancelAll(function(){},this),navigator.app.exitApp())}navigator.notification.confirm(dictionary.Literals.label_18,onConfirmQuit,dictionary.Literals.label_19,dictionary.Literals.label_20)});break;case/chat-page/.test(page):null!=gui.photoGallery&&gui.photoGallery.close(),$(".ui-popup-active").length>0?$("#popupDivMultimedia").popup("close"):$("body").pagecontainer("change","#MainPage",{transition:"none"});break;case/emoticons/.test(page):$("body").pagecontainer("change","#chat-page",{transition:"none"});break;case/ProfileOfContact/.test(page):gui.isPlanDisplayed?($("body").pagecontainer("change","#searchResultsPage",{transition:"none"}),gui.isPlanDisplayed=!1):$("body").pagecontainer("change","#chat-page",{transition:"none"}),gui.removeImgFromGallery(gui.indexOfImages4Gallery);break;case/forwardMenu/.test(page):$("body").pagecontainer("change","#chat-page",{transition:"none"});break;case/createPlanPage/.test(page):$("body").pagecontainer("change","#searchPage",{transition:"none"});break;case/searchResultsPage/.test(page):$("body").pagecontainer("change","#searchPage",{transition:"none"});break;default:$("body").pagecontainer("change","#MainPage",{transition:"none"})}},GUI.prototype.onChatInput=function(){var textMessage=$("#chat-input").val();if(textMessage=textMessage.replace(/\n/g,""),document.getElementById("chat-input").value="",""!=textMessage){var message2send=new Message({to:app.currentChatWith,from:user.publicClientID,messageBody:{messageType:"text",text:gui._sanitize(textMessage)}});message2send.convertToUTF();var msg2store=new Message(message2send);mailBox.storeMessage(msg2store),gui.showMsgInConversation(msg2store,{isReverse:!1,withFX:!0}),postman.sendMsg(message2send),$("#chat-multimedia-image").attr("src","res/multimedia.png"),$("#chat-multimedia-button").unbind("click",gui.showEmojis),$("#chat-multimedia-button").bind("click",gui.showImagePic);var obj=abstractHandler.getObjById(app.currentChatWith);obj.isAccepted||gui.onConsentButton()}},GUI.prototype.onConsentButton=function(){$("#consent-menu").remove();var obj=abstractHandler.getObjById(app.currentChatWith);"undefined"!=typeof obj&&(obj.isAccepted=!0,obj.isBlocked=!1,abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj))},GUI.prototype.onGroupsButton=function(){var group=gui.groupOnMenu,action=$("#groupsButton").data("action"),inputNickName=$("#nickNameGroupField").val();if(""==inputNickName||inputNickName==dictionary.Literals.label_23){var html="";return html+='<div role="main" class="ui-content">',html+=' <h1 class="ui-title" role="heading" aria-level="1"> oops!</h1><p> </p>',html+="\t<h1> </h1><h2> remember to set a name for the Group</h2><h1> </h1>",html+="</div>",gui.showDialog(html),void gui.loadGroupMenu()}"create"==action?($("#groupsButton").data("action","modify").text(dictionary.Literals.label_39),groupsHandler.setGroupOnList(group),groupsHandler.setGroupOnDB(group),groupsHandler.sendGroupUpdate(group),gui.showGroupsOnGroupMenu(),gui.showEntryOnMainPage(group,!1)):(groupsHandler.setGroupOnList(group),groupsHandler.setGroupOnDB(group),groupsHandler.sendGroupUpdate(group))},GUI.prototype.onPlanSubmit=function(){gui.showLoadingSpinner();var action=$("#planSubmitButton").data("action"),inputNickName=$("#nickNamePlanField").val();if(""==inputNickName||inputNickName==dictionary.Literals.label_23){var html="";return html+='<div role="main" class="ui-content">',html+=' <h1 class="ui-title" role="heading" aria-level="1"> oops!</h1><p> </p>',html+="\t<h1> </h1><h2> remember to set a name for the Plan</h2><h1> </h1>",html+="</div>",gui.showDialog(html),void gui.hideLoadingSpinner()}var $dateInput=$(".myDatePicker"),pickerDate=$dateInput.pickadate("picker"),$dateInput2=$("#label_71"),pickerTime=$dateInput2.pickatime("picker"),dateInMiliseconds=pickerDate.get("select").pick,timeObj={hour:pickerTime.get("select").hour.toString(),mins:pickerTime.get("select").mins.toString()};gui.groupOnMenu.meetingInitDate=dateInMiliseconds,gui.groupOnMenu.meetingInitTime=timeObj;var group=gui.groupOnMenu,plan={planId:group.publicClientID,organizer:user.publicClientID,imgsrc:"./res/group_black_195x195.png"==group.imgsrc?"":group.imgsrc,nickName:group.nickName,commentary:group.commentary,location:group.location,meetingInitDate:group.meetingInitDate,meetingInitTime:group.meetingInitTime,organizerObj:{publicClientID:user.publicClientID,nickName:user.myCurrentNick,commentary:user.myCommentary,location:{lat:app.myPosition.coords.latitude.toString(),lon:app.myPosition.coords.longitude},pubKeyPEM:user.keys.publicKey}},html="";html+='<div role="main" class="ui-content">',html+=' <h1 class="ui-title" role="heading" aria-level="1"> done yeah!</h1><p> </p>',html+="</div>","create"==action?(postman.send("PlanCreation",plan),$("#planSubmitButton").data("action","modify").text(dictionary.Literals.label_39)):postman.send("PlanModification",plan),groupsHandler.setGroupOnList(group),groupsHandler.setGroupOnDB(group),gui.showDialog(html),gui.hideLoadingSpinner(),gui.showEntryOnMainPage(group,!1)},GUI.prototype.onProfileUpdate=function(){app.profileIsChanged&&(user.lastProfileUpdate=(new Date).getTime(),app.profileIsChanged=!1,app.sendProfileUpdate(),user.updateUserSettings())},GUI.prototype.onRemoveContactFromGroup=function(contact){gui.showRemoveContactFromGroup(contact),gui.groupOnMenu.removeMember(contact)},GUI.prototype.onReportAbuse=function(){$("#consent-menu").remove();var obj=abstractHandler.getObjById(app.currentChatWith);"undefined"!=typeof obj&&(obj.isAccepted=!1,obj.isBlocked=!0,abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj),gui.showReportAbuse())},GUI.prototype.onReportBlock=function(){$("#consent-menu").remove();var obj=abstractHandler.getObjById(app.currentChatWith);"undefined"!=typeof obj&&(obj.isAccepted=!1,obj.isBlocked=!0,abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj),$("#"+obj.publicClientID).remove())},GUI.prototype.orderEntriesOnMainPage=function(){$("#listOfContactsInMainPage").listview().listview("refresh")},GUI.prototype.printMessagesOf=function(publicClientID,olderDate,newerDate,listOfMessages){mailBox.getAllMessagesOf(publicClientID,olderDate,newerDate).done(function(list){var newList=listOfMessages.concat(list);newList.length>0||olderDate<config.TIME_UNIX_2015?(newList.map(function(message){gui.showMsgInConversation(message,{isReverse:!1,withFX:!0})}),gui.printOldMessagesOf(publicClientID,olderDate-config.TIME_UNIX_MONTH,olderDate)):(olderDate-=config.TIME_UNIX_MONTH,newerDate-=config.TIME_UNIX_MONTH,gui.printMessagesOf(publicClientID,olderDate,newerDate,newList))})},GUI.prototype.printOldMessagesOf=function(publicClientID,olderDate,newerDate){mailBox.getAllMessagesOf(publicClientID,olderDate,newerDate).done(function(list){list.reverse().map(function(message){gui.showMsgInConversation(message,{isReverse:!0,withFX:!1})}),olderDate>config.TIME_UNIX_2015?(olderDate-=config.TIME_UNIX_MONTH,newerDate-=config.TIME_UNIX_MONTH,gui.printOldMessagesOf(publicClientID,olderDate,newerDate)):(gui.hideLoadingSpinner(),$(".blue-r-by-end").delay(config.TIME_FADE_ACK).fadeTo(config.TIME_FADE_ACK,0))})},GUI.prototype.removeImgFromGallery=function(index){gui.listOfImages4Gallery.splice(parseInt(index)-1,1),gui.indexOfImages4Gallery=gui.indexOfImages4Gallery-1},GUI.prototype.setImgIntoGallery=function(index,src,msgId){var img=new Image;img.src=src,img.onload=function(){var height=img.height,width=img.width;gui.listOfImages4Gallery[index]={src:src,w:width,h:height,msgId:msgId}},gui.indexOfImages4Gallery=gui.indexOfImages4Gallery+1},GUI.prototype.setLocalLabels=function(){document.getElementById("label_1").innerHTML=dictionary.Literals.label_1,document.getElementById("label_2").innerHTML=dictionary.Literals.label_2,document.getElementById("label_3").innerHTML=dictionary.Literals.label_3,document.getElementById("label_4").innerHTML=dictionary.Literals.label_4,document.getElementById("label_8").innerHTML=dictionary.Literals.label_8,document.getElementById("label_9").innerHTML=dictionary.Literals.label_9,document.getElementById("label_10").innerHTML=dictionary.Literals.label_10,document.getElementById("label_21").innerHTML=dictionary.Literals.label_36,document.getElementById("label_22").innerHTML=dictionary.Literals.label_1,document.getElementById("profileNameField").placeholder=dictionary.Literals.label_23,document.getElementById("profileCommentary").placeholder=dictionary.Literals.label_24,document.getElementById("profileTelephone").placeholder=dictionary.Literals.label_25,document.getElementById("profileEmail").placeholder=dictionary.Literals.label_26,document.getElementById("label_27").innerHTML=dictionary.Literals.label_27,document.getElementById("label_28").innerHTML=dictionary.Literals.label_28,document.getElementById("label_29").innerHTML=dictionary.Literals.label_29,document.getElementById("label_31").innerHTML=dictionary.Literals.label_31,document.getElementById("label_32").innerHTML=dictionary.Literals.label_32,document.getElementById("label_33").innerHTML=dictionary.Literals.label_33,document.getElementById("buyButton").innerHTML=dictionary.Literals.label_34,document.getElementById("label_37").innerHTML=dictionary.Literals.label_37,document.getElementById("groupsButton").innerHTML=dictionary.Literals.label_38,document.getElementById("label_52").innerHTML=dictionary.Literals.label_52,document.getElementById("label_60").innerHTML=dictionary.Literals.label_60,document.getElementById("label_65").innerHTML=dictionary.Literals.label_65,document.getElementById("label_66").innerHTML=dictionary.Literals.label_66,document.getElementById("label_72").innerHTML=dictionary.Literals.label_72},GUI.prototype.setTimeLastSMS=function(obj){$("#"+obj.publicClientID).data("sortby",obj.timeLastSMS)},GUI.prototype.showAddContact2Group=function(contact){$("#buttonAddContact2Group"+contact.publicClientID).attr({class:"icon-list ui-btn ui-btn-icon-notext ui-icon-check"}),$("#contacts4Group").find("#divAddContact2Group"+contact.publicClientID).unbind("click").on("click",function(){gui.onRemoveContactFromGroup(contact)}),$("#contacts4Group").listview().listview("refresh")},GUI.prototype.showBlockSomebodyPrompt=function(){var obj=abstractHandler.getObjById(app.currentChatWith),html="";html+='<div id="block-confirm" role="main" class="ui-content">',html+=' <h1 id="label_51" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_51+"</h1><p> </p>",html+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+obj.imgsrc+'" class="imgInMainPage"/>  \t <h2>'+obj.nickName+"</h2>   \t <p>"+obj.commentary+"</p>    </a>  </li>",html+=' <a id="label_56" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",html+=' <a id="label_57" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",html+="</div>",gui.showDialog(html),$("#label_56").unbind("click").on("click",function(){gui.onReportBlock(),$("#popupDiv").remove()}),$("#label_57").unbind("click").on("click",function(){$("#popupDiv").remove()})},GUI.prototype.showConferencePage=function(callAceptanceCB,callRejectionCB){$("body").pagecontainer("change","#conference-page",{transition:"none"}),$("#callRejectButton").unbind("click").on("click",callRejectionCB),$("#callAcceptButton").unbind("click").on("click",callAceptanceCB),$("#conferenceTag").hide(),$("#imgConferenceCaller").remove();var contact=contactsHandler.getContactById(app.currentChatWith);"undefined"!=typeof contact&&null!=contact&&($(".ui-height-70percent").prepend($("<img>",{id:"imgConferenceCaller",src:contact.imgsrc,class:"vertical-center"})),gui.showLoadingSpinner())},GUI.prototype.showConsentMenu=function(){var prompt2show="";prompt2show+='<div data-role="none" id="consent-menu" class="ui-dialog-contain" > ',prompt2show+=" <h3></h3>",prompt2show+=' <a id="label_43" class="ui-btn ui-shadow ui-corner-all ui-btn-b">'+dictionary.Literals.label_43+"</a>",prompt2show+=' <a id="label_44" class="ui-btn ui-shadow ui-corner-all ui-btn-b">'+dictionary.Literals.label_44+"</a>",prompt2show+=' <a id="label_45" class="ui-btn ui-shadow ui-corner-all ui-btn-a">'+dictionary.Literals.label_45+"</a>",prompt2show+="</div>",$("#chat-page-content").append(prompt2show),$("#label_43").unbind("click").bind("click",function(){gui.showBlockSomebodyPrompt()}),$("#label_44").unbind("click").bind("click",function(){gui.onReportAbuse()}),$("#label_45").unbind("click").bind("click",function(){gui.onConsentButton()})},GUI.prototype.showConversation=function(obj,callback){gui.listOfImages4Gallery=null,gui.listOfImages4Gallery=[],gui.indexOfImages4Gallery=0,app.currentChatWith=obj.publicClientID,$("body").pagecontainer("change","#chat-page"),gui.showLoadingSpinner(),$("#imgOfChat-page-header").attr("src",obj.imgsrc),mailBox.retrieveMessages(obj.publicClientID).done(function(list){list.length==config.MAX_SMS_RETRIEVAL&&gui.bindPagination(list[0].timestamp),list.reverse().map(function(message){gui.showMsgInConversation(message,{isReverse:!1,withFX:!0})}),gui.hideLoadingSpinner(),obj.isAccepted||gui.showConsentMenu(),callback&&callback()}),obj.counterOfUnreadSMS>0&&(obj.counterOfUnreadSMS=0,abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj),gui.refreshCounterOfChat(obj)),obj instanceof ContactOnKnet&&contactsHandler.sendProfileRequest(obj),document.getElementById("css/jquery.emojipicker.tw.css")||(app.loadjscssfile("css/jquery.emojipicker.tw.css","css"),log.info("gui.showConversation - loadjscssfile called"))},GUI.prototype.showContactsOnGroupMenu=function(){$("#contacts4Group").empty(),contactsHandler.listOfContacts.map(function(obj){var html2insert='<li id="divAddContact2Group'+obj.publicClientID+'"> <a>  <img src="'+obj.imgsrc+'" class="imgInMainPage"/>  <h2>'+obj.nickName+"</h2>   <p>"+obj.commentary+'</p> </a> <a id="buttonAddContact2Group'+obj.publicClientID+'" data-role="button" class="icon-list" data-inline="true"> </a></li>';$("#contacts4Group").append(html2insert),gui.groupOnMenu.listOfMembers.indexOf(obj.publicClientID)!=-1?gui.showAddContact2Group(obj):gui.showRemoveContactFromGroup(obj)})},GUI.prototype.showContactOnMapPage=function(contact){var html2insert='<li id="'+contact.publicClientID+'-inMap"> <a>    <img id="profilePhoto'+contact.publicClientID+'" src="'+contact.imgsrc+'" class="imgInMainPage"/>  <h2>'+contact.nickName+"</h2>   <p>"+contact.commentary+"</p></a> <a></a></li>";$("#listOfContactsInMapPage").append(html2insert).listview().listview("refresh").find("#"+contact.publicClientID+"-inMap").first().on("click",function(){gui.showConversation(contact)});var latlng=L.latLng(contact.location.lat,contact.location.lon);marker=new L.marker(latlng).bindPopup(contact.nickName).addTo(app.map)},GUI.prototype.showDialog=function(html){$("#popupDiv").remove();var prompt2show='<div id="popupDiv" data-role="popup"> '+html+"</div>",activePage=$.mobile.activePage.attr("id");$("#"+activePage).append(prompt2show),$("#"+activePage).trigger("create"),$(".backButton").unbind("click").bind("click",function(){gui.onBackButton()}),$("#popupDiv").popup("open")},GUI.prototype.showEmojis=function(){$("body").pagecontainer("change","#emoticons",{transition:"none"})},GUI.prototype.showEntryOnMainPage=function(obj,isNewContact){if($("#"+obj.publicClientID).length)return $("#listOfContactsInMainPage").prepend($("#"+obj.publicClientID)),$("#listOfContactsInMainPage").listview().listview("refresh"),void gui.refreshProfileInfo(obj);if(!obj.isBlocked){var attributesOfLink="";isNewContact&&(attributesOfLink+=' data-role="button" class="icon-list" data-icon="plus" data-iconpos="notext" data-inline="true" ');var htmlOfCounter="";htmlOfCounter=obj.counterOfUnreadSMS>0?'<span id="counterOf_'+obj.publicClientID+'" class="ui-li-count" style="border-color: #FF9720;">'+obj.counterOfUnreadSMS+"</span>":'<span id="counterOf_'+obj.publicClientID+'" class="" style="border-color: #FF9720;"></span>';var html2insert='<li id="'+obj.publicClientID+'" data-sortby='+obj.timeLastSMS+' >\t<a id="link2go2ChatWith_'+obj.publicClientID+'">\t\t<img id="profilePhoto'+obj.publicClientID+'" src="'+obj.imgsrc+'" class="imgInMainPage"/>\t\t<h2>'+obj.nickName+"</h2> \t\t<p>"+obj.commentary+"</p>"+htmlOfCounter+' \t</a>\t<a id="linkAddNewContact'+obj.publicClientID+'" '+attributesOfLink+" ></a></li>";$("#listOfContactsInMainPage").prepend(html2insert).find("#link2go2ChatWith_"+obj.publicClientID).on("click",function(){gui.showConversation(obj)}),isNewContact?$("#linkAddNewContact"+obj.publicClientID).on("click",function(){contactsHandler.addNewContactOnDB(obj)}):$("#linkAddNewContact"+obj.publicClientID).on("click",function(){gui.showConversation(obj)}),$("#listOfContactsInMainPage").listview().listview("refresh"),gui.showLastMsgTruncated(obj)}},GUI.prototype.showEntryOnResultsPage=function(obj,isNewContact){var a=$("#listInResultsPage").find("#results_"+obj.publicClientID);if(0==a.length&&!obj.isBlocked){var attributesOfLink="";isNewContact&&(attributesOfLink+=' data-role="button" class="icon-list" data-icon="plus" data-iconpos="notext" data-inline="true" ');var html2insert='<li id="results_'+obj.publicClientID+'" >\t<a id="resultGo2Chat_'+obj.publicClientID+'">\t\t<img id="profilePhoto'+obj.publicClientID+'" src="'+obj.imgsrc+'" class="imgInMainPage"/>\t\t<h2>'+obj.nickName+"</h2> \t\t<p>"+obj.commentary+'</p> \t</a>\t<a id="linkAddNewContact'+obj.publicClientID+'" '+attributesOfLink+" ></a></li>";$("#listInResultsPage").prepend(html2insert).find("#resultGo2Chat_"+obj.publicClientID).on("click",function(){gui.showConversation(obj)}),isNewContact?$("#linkAddNewContact"+obj.publicClientID).on("click",function(){contactsHandler.addNewContactOnDB(obj)}):$("#linkAddNewContact"+obj.publicClientID).on("click",function(){gui.showConversation(obj)}),$("#listInResultsPage").listview().listview("refresh")}},GUI.prototype.showGallery=function(index){if("WinCE"!=app.devicePlatform&&"Win32NT"!=app.devicePlatform){gui.loadGalleryInDOM();var pswpElement=document.querySelectorAll(".pswp")[0],options={};options.index=parseInt(index),options.mainClass="pswp--minimal--dark",options.barsSize={top:0,bottom:0},options.captionEl=!1,options.fullscreenEl=!1,options.shareEl=!0,options.bgOpacity=.85,options.tapToClose=!1,options.tapToToggleControls=!1,options.shareButtons=[],gui.photoGalleryClosed=!1,gui.photoGallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,gui.listOfImages4Gallery,options),gui.photoGallery.init(),gui.photoGallery.listen("destroy",function(){setTimeout(function(){gui.photoGalleryClosed=!0},config.TIME_SILENT_SCROLL)})}},GUI.prototype.showGroupsOnGroupMenu=function(){$("#listOfGroups").empty(),groupsHandler.list.map(function(group){var html2insert='<li id="divGroupOnMenu'+group.publicClientID+'"> <a>  <img src="'+group.imgsrc+'" class="imgInMainPage"/>  <h2>'+group.nickName+"</h2>   <p>"+group.commentary+"</p> </a></li>";$("#listOfGroups").append(html2insert).listview().listview("refresh").find("#divGroupOnMenu"+group.publicClientID).unbind("click").on("click",function(){gui.loadGroupMenu(group)})})},GUI.prototype.showJoinPlanPrompt=function(plan){var obj=abstractHandler.getObjById(plan.organizerObj.publicClientID);if("undefined"!=typeof obj&&null!=obj){var html="";html+='<div id="block-confirm" role="main" class="ui-content">',html+=' <h1 id="label_76" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_76+"</h1><p> </p>",html+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+obj.imgsrc+'" class="imgInMainPage"/>  \t <h2>'+obj.nickName+"</h2>   \t <p>"+obj.commentary+"</p>    </a>  </li>",html+=' <a id="label_56" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",html+=' <a id="label_57" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",html+="</div>",gui.showDialog(html),$("#label_56").unbind("click").on("click",function(){gui.showConversation(obj,function(){var message2send=new Message({to:obj.publicClientID,from:user.publicClientID,messageBody:{messageType:"inclusionRequest",planId:plan.planId}});log.debug("forwardMsg ",message2send,plan),app.forwardMsg(message2send,obj)}),$("#popupDiv").remove()}),$("#label_57").unbind("click").on("click",function(){$("#popupDiv").remove()})}},GUI.prototype.showImagePic=function(){var prompt2show='<div id="popupDivMultimedia" data-role="popup" data-overlay-theme="a"> \t<a class="backButton ui-btn-right" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" ></a>\t<input data-role="none" hidden type="file" name="image" id="picPopupDivMultimedia" class="picedit_box">\t\t </div>';$("#multimedia-content").append(prompt2show),$("#multimedia-content").trigger("create"),$(".backButton").unbind("click").bind("click",function(){gui.onBackButton()}),$("#popupDivMultimedia").bind({popupafterclose:function(event,ui){$("#popupDivMultimedia").remove()}}),$("#picPopupDivMultimedia").picEdit({maxWidth:config.MAX_WIDTH_IMG>.7*$(window).width()?.7*$(window).width():config.MAX_WIDTH_IMG,maxHeight:config.MAX_HEIGHT_IMG>.6*$(window).height()?.6*$(window).height():config.MAX_HEIGHT_IMG,displayWidth:.7*$(window).width(),displayHeight:.6*$(window).height(),navToolsEnabled:!1,isMobile:app.isMobile,onImageCreation:function(){$("#popupDivMultimedia").popup("close")},onNativeCameraInit:app.onNativeCameraInit,imageUpdated:function(img){app.sendMultimediaMsg({receiver:app.currentChatWith,src:img.src})}}),$("#popupDivMultimedia").popup("open")},GUI.prototype.showLastMsgTruncated=function(obj){var tag=$("#link2go2ChatWith_"+obj.publicClientID).children().closest("p");if(""!=obj.lastMsgTruncated){var ellipsis="";config.MAX_LENGTH_TRUNCATED_SMS-4<obj.lastMsgTruncated.length&&(ellipsis=" ..."),tag.html(decodeURIComponent(obj.lastMsgTruncated)+ellipsis)}else tag.html(decodeURIComponent(obj.commentary))},GUI.prototype.showListOfBlocked=function(){$("#listOfBlocked").empty();var listOfBlocked=[];groupsHandler.list.map(function(group){group.isBlocked&&listOfBlocked.push(group)}),contactsHandler.listOfContacts.map(function(obj){obj.isBlocked&&listOfBlocked.push(obj)}),listOfBlocked.map(function(obj){var html2insert='<li id="divBlockedPeople'+obj.publicClientID+'"> <a>  <img src="'+obj.imgsrc+'" class="imgInMainPage"/>  <h2>'+obj.nickName+"</h2>   <p>"+obj.commentary+'</p> </a> <a id="buttonUnblock'+obj.publicClientID+'" data-role="button" class="icon-list ui-icon-forbidden" data-inline="true"> </a></li>';
$("#listOfBlocked").append(html2insert).listview().listview("refresh").find("#divBlockedPeople"+obj.publicClientID).unbind("click").on("click",function(){gui.showUnblockSomebodyPrompt(obj)})})},GUI.prototype.showLoadingSpinner=function(text2show){$(".mask-color").fadeIn("fast")},GUI.prototype.showLocalNotification=function(msg){if(app.isMobile&&(app.inBackground||msg.from!=app.currentChatWith)&&"Android"==app.devicePlatform){var contact=contactsHandler.getContactById(msg.from),sendersName=contact?contact.nickName:dictionary.Literals.label_16,text2show="";"multimedia"==msg.messageBody.messageType?text2show="multimedia":"text"==msg.messageBody.messageType&&(text2show=decodeURI(gui._sanitize(msg.messageBody.text)).substring(0,config.MAX_LENGTH_TRUNCATED_SMS));var options={id:0,title:sendersName,text:text2show};"Android"==app.devicePlatform&&(options.smallIcon="res://icon.png"),cordova.plugins.notification.local.isPresent(0,function(present){present?cordova.plugins.notification.local.update(options):cordova.plugins.notification.local.schedule(options)})}},GUI.prototype.showMsgInConversation=function(message,options){var authorOfMessage,classOfmessageStateColor="";if(message.from==user.publicClientID)authorOfMessage=" ",classOfmessageStateColor="red-no-rx-by-srv",1==message.markedAsRead?classOfmessageStateColor="blue-r-by-end":1==message.ACKfromAddressee?classOfmessageStateColor="green-rx-by-end":1==message.ACKfromServer&&(classOfmessageStateColor="amber-rx-by-srv");else{var contact=contactsHandler.getContactById(message.from);if("undefined"==typeof contact||null==contact)return;if(authorOfMessage=contact.nickName,0==message.markedAsRead){var messageACK={to:message.to,from:message.from,msgID:message.msgID,typeOfACK:"ReadfromAddressee"};postman.send("MessageDeliveryACK",messageACK),message.markedAsRead=!0,mailBox.storeMessage(message)}}var htmlOfContent="",htmlOfVideoPreview="";if("text"==message.messageBody.messageType){htmlOfContent=this._sanitize(message.messageBody.text),htmlOfContent=decodeURI(htmlOfContent);var parsedLinks=this._parseLinks(htmlOfContent);htmlOfContent=parsedLinks.htmlOfContent,htmlOfContent=twemoji.parse(htmlOfContent,function(icon,options,variant){return"./js/"+options.size+"/"+icon+".png"}),parsedLinks.mediaLinks.map(function(link){var srcPath=null;srcPath="youtube"==link.type?"http://www.youtube.com/embed/"+link.id:"https://player.vimeo.com/video/"+link.id,null!=srcPath&&(htmlOfVideoPreview+='<div class="youtube-preview"><iframe width="100%" height="100%" src='+srcPath+' frameborder="0" allowfullscreen=""></iframe><div class="tool-bar"> <div data-role="none" class="pswp__button pswp__button--share" ></div> </div></div>')})}else if("multimedia"==message.messageBody.messageType)htmlOfContent='<div class="image-preview">  <a>  <img class="image-embed" src="'+message.messageBody.src+'" data-index="'+gui.indexOfImages4Gallery+'"> </a> <div class="tool-bar"> <div data-role="none" class="pswp__button pswp__button--share" ></div> </div></div>',gui.setImgIntoGallery(gui.indexOfImages4Gallery,message.messageBody.src,message.msgID);else if("inclusionRequest"==message.messageBody.messageType){var group=groupsHandler.getGroupById(message.messageBody.planId),groupName="undefined"==typeof group||null==group?message.messageBody.planId:group.nickName,groupPhoto="undefined"==typeof group||null==group?"./res/new_contact_added_195x195.png":group.imgsrc,photo="",name="",contact=null,header="",requestChecked=!1;if(message.from==user.publicClientID)photo=groupPhoto,header=dictionary.Literals.label_78;else{var contact=contactsHandler.getContactById(message.from);name="undefined"==typeof contact||null==contact?message.from:contact.nickName,photo="undefined"==typeof contact||null==contact?"./res/new_contact_added_195x195.png":contact.imgsrc,header=dictionary.Literals.label_77,group.listOfMembers.map(function(id){id==contact.publicClientID&&(requestChecked=!0)})}htmlOfContent="",htmlOfContent+='<div id="block-confirm" role="main" class="ui-content">',htmlOfContent+=' <h1 id="label_77" class="ui-title" role="heading" aria-level="1">'+header+"</h1><p> </p>",htmlOfContent+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+photo+'" class="imgInMainPage"/>  \t <h2>'+name+"</h2>   \t <h2>"+dictionary.Literals.label_40+groupName+"</h2>    </a>  </li>",message.from!=user.publicClientID&&0==requestChecked&&(htmlOfContent+=' <a id="label_56" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",htmlOfContent+=' <a id="label_57" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",htmlOfContent+="</div>")}var timeStampOfMessage=new Date(message.timestamp),html2insert='<div class="activity">\t<span class="posted_at">  \t\t<div id="messageStateColor_'+message.msgID+'" class="'+classOfmessageStateColor+'"></div>'+gui.formatter.formatDate(timeStampOfMessage,{datetime:"medium"})+'\t</span>\t<div class="readable">\t\t<span class="user">'+authorOfMessage+'</span>\t\t<span class="content">'+htmlOfContent+htmlOfVideoPreview+"</span>\t</div></div>",$newMsg=$(html2insert);"multimedia"==message.messageBody.messageType?($newMsg.find(".pswp__button").unbind("click").on("click",function(){app.msg2forward=message.msgID,$("body").pagecontainer("change","#forwardMenu",{transition:"none"})}),$newMsg.find(".image-embed").unbind("click").on("click",function(evt){gui.showGallery($(evt.target).data("index"))})):"inclusionRequest"==message.messageBody.messageType&&$newMsg.find("#label_56").unbind("click").on("click",function(evt){var contact=contactsHandler.getContactById(message.from),group=groupsHandler.getGroupById(message.messageBody.planId);group.addMember(contact),groupsHandler.setGroupOnList(group),groupsHandler.setGroupOnDB(group),groupsHandler.sendGroupUpdate(group);var html="";html+='<div role="main" class="ui-content">',html+=' <h1 class="ui-title" role="heading" aria-level="1"> done yeah!</h1><p> </p>',html+="</div>",gui.showDialog(html)}),message.from!=user.publicClientID&&$newMsg.css("background","#FFFFE0"),options.isReverse?$("#chat-page-content").prepend($newMsg):($("#chat-page-content").append($newMsg),$("#chat-page-content").trigger("create")),options.withFX&&($(".blue-r-by-end").delay(config.TIME_FADE_ACK).fadeTo(config.TIME_FADE_ACK,0),setTimeout(function(){$.mobile.silentScroll($(document).height())},config.TIME_SILENT_SCROLL))},GUI.prototype.showPlanImgInResultsPage=function(params){""!=params.imgsrc&&$("#profilePhotoResults_"+params.planId).attr("src",params.imgsrc)},GUI.prototype.showPlansInResultsPage=function(list){list.map(function(obj){var a=$("#listInResultsPage").find("#results_"+obj.planId);if(0==a.length){var attributesOfLink=' data-role="button" class="icon-list" data-icon="plus" data-iconpos="notext" data-inline="true" ',html2insert='<li id="results_'+obj.planId+'" >\t<a id="resultsGo2Chat_'+obj.planId+'">\t\t<img id="profilePhotoResults_'+obj.planId+'" src="./res/group_black_195x195.png" class="imgInMainPage"/>\t\t<h2>'+obj.nickName+"</h2> \t\t<p>"+obj.commentary+'</p> \t</a>\t<a id="linkAddNewContact'+obj.planId+'" '+attributesOfLink+" ></a></li>";$("#listInResultsPage").prepend(html2insert).find("#resultsGo2Chat_"+obj.planId).on("click",function(){gui.showProfile(obj)}).find("#linkAddNewContact"+obj.planId).on("click",function(){gui.showProfile(obj)}),$("#listInResultsPage").listview().listview("refresh"),postman.send("ReqPlanImg",{planId:obj.planId})}}),list.map(function(obj){if(obj.organizerObj.publicClientID!=user.publicClientID){var contact=contactsHandler.getContactById(obj.organizerObj.publicClientID);"undefined"!=typeof contact&&null!=contact||(contact=new ContactOnKnet(obj.organizerObj),contactsHandler.setContactOnList(contact),contactsHandler.sendProfileRequest(contact))}})},GUI.prototype.showProfile=function(input){var obj,isGroup=!1,isContact=!1,isPlan=!1;if(input)obj=input,isPlan=!0,gui.isPlanDisplayed=!0;else{if(obj=abstractHandler.getObjById(app.currentChatWith),"undefined"==typeof obj)return;obj instanceof ContactOnKnet?isContact=!0:isGroup=!0}$("#ProfileOfContact-page").remove();var strVar="";if(strVar+='\t\t<div data-role="page" data-cache="false" id="ProfileOfContact-page" >',strVar+='\t\t\t<div data-role="header" data-position="fixed">\t\t\t\t\t\t\t',strVar+='\t\t\t  <div class="ui-grid-d" >',strVar+='\t\t\t    <div class="ui-block-a">',strVar+='\t\t\t\t\t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',strVar+='\t\t\t\t\t <img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',strVar+="\t\t\t\t\t</a>",strVar+="\t    \t\t</div>",strVar+='\t\t\t    <div class="ui-block-b"></div>',strVar+='\t\t\t    <div class="ui-block-c"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+='\t\t\t    <div class="ui-block-e"></div>',strVar+="\t\t\t  </div>",strVar+="\t\t\t</div><!-- /header -->",strVar+='\t\t\t<div data-role="content" data-theme="a"> ',strVar+='\t\t\t\t<div class="container" id="main">',strVar+='\t\t\t\t\t<div class="row">',strVar+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="sidebar">',strVar+='\t\t\t\t\t\t\t\t<div class="user">',strVar+='\t\t\t\t\t\t\t\t\t<div class="text-center">',""==obj.imgsrc&&isPlan&&(obj.imgsrc="./res/group_black_195x195.png"),strVar+='\t\t\t\t\t\t\t\t\t\t<img src="'+obj.imgsrc+'" class="img-circle" data-index=\''+gui.indexOfImages4Gallery+"'>",strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t\t\t\t<div class="user-head">',strVar+="\t\t\t\t\t\t\t\t\t\t<h1>"+obj.nickName+"</h1>",strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',(isGroup||isContact)&&(strVar+="\t\t\t\t\t\t\t\t\t\t<h5>"+obj.commentary+"</h5>",strVar+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>'),strVar+="\t\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',strVar+='\t\t\t\t\t\t\t<div id="content">',strVar+='\t\t\t\t\t\t\t\t<div class="main-content"> ',strVar+='\t\t\t\t\t          \t\t<div class="timeline-panel">',strVar+=isContact?"\t\t\t\t\t        \t\t<h1>"+dictionary.Literals.label_63+"</h1>":"\t\t\t\t\t        \t\t<h1>"+dictionary.Literals.label_62+"</h1>",strVar+='\t\t\t\t\t    \t      \t\t<div class="hr-left"></div>',strVar+='\t\t\t\t\t        \t  \t\t<div class="row" id="contact">',strVar+='\t\t\t\t\t          \t\t\t\t<div class="col-md-12">',strVar+="\t\t\t\t\t\t\t\t\t\t\t\t<strong>"+obj.nickName+"</strong><br>",isPlan&&(strVar+="\t\t\t\t\t\t\t\t\t\t\t<p>"+obj.commentary+"</p>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_73" data-role="none"  class="myDatePicker form-control input-lg " placeholder="" readonly> ',strVar+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_74" data-role="none"  class="form-control input-lg myTimePicker" placeholder="" readonly> ',strVar+="\t\t\t\t\t\t\t\t\t\t\t</div>"),isContact&&(strVar+="\t\t\t\t\t          \t\t\t\t\t<address>",strVar+='\t\t\t\t\t\t\t\t\t\t\t  \t\t<abbr title="Phone"> &#9742 &nbsp;'+obj.telephone+"</abbr>",strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</address>",strVar+="\t\t\t\t\t\t\t\t\t\t\t\t<email>",strVar+='\t\t\t\t\t\t\t\t\t\t\t\t  \t<abbr title="email"> &#9993; &nbsp;'+obj.email+"</abbr>",strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</email>"),(isGroup||isContact)&&(strVar+="\t\t\t\t\t\t\t\t\t\t\t\t<address>",strVar+='\t\t\t\t\t\t\t\t\t\t\t\t  \t<abbr title="id"> &#x1f511; &nbsp;'+obj.publicClientID+"</abbr>",strVar+="\t\t\t\t\t\t\t\t\t\t\t\t</address>",strVar+="\t\t\t\t\t\t          \t\t\t</div>",strVar+='\t\t\t\t\t\t          \t\t\t<div class="col-md-12"><br>'),isGroup){strVar+='<ul id="contacts4Profile">';var list=[];obj.listOfMembers.map(function(id){var contact2list=contactsHandler.getContactById(id);("undefined"!=typeof contact2list||null!=contact2list&&contact2list.publicClientID!=user.publicClientID)&&list.push(contact2list)}),list.map(function(e){strVar+='<li id="contact4Profile_'+e.publicClientID+'">',strVar+=" <a>",strVar+='  <img src="'+e.imgsrc+'" class="imgInMainPage"/>',strVar+="  <h2>"+e.nickName+"</h2> ",strVar+="  <p>"+e.commentary+"</p>",strVar+=" </a>",strVar+=' <a id="buttonAddContact2Group'+e.publicClientID+'" data-role="button" class="icon-list" data-inline="true">',strVar+=" </a>",strVar+="</li>"}),strVar+="</ul>"}if(strVar+="\t\t\t\t\t        \t  \t\t\t</div>",strVar+="\t\t\t\t\t          \t\t\t</div>",strVar+='\t\t\t\t\t          \t\t\t<div id="mapProfile" class="mapPlanPage">',strVar+="\t\t\t\t\t          \t\t\t</div>",(isGroup||isContact)&&(strVar+='\t\t\t\t\t\t\t\t\t\t<div class="col-md-12">',strVar+='\t\t\t\t\t          \t\t\t\t<h1 id="label_49">'+dictionary.Literals.label_49+"</h1>",strVar+="\t\t\t\t\t          \t\t\t\t<h1></h1>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<button id="label_54">'+dictionary.Literals.label_43+"</button>",strVar+='\t\t\t\t\t\t\t\t\t\t\t<button id="label_55">'+dictionary.Literals.label_48+"</button>",strVar+="\t\t\t\t\t          \t\t\t</div>"),isPlan){if(obj.organizerObj.publicClientID==user.publicClientID)return gui.groupOnMenu=new Group(obj),gui.groupOnMenu.publicClientID=obj.planId,$("body").pagecontainer("change","#createPlanPage",{transition:"none"}),void $("#planSubmitButton").delay(config.TIME_SILENT_SCROLL).data("action","modify").text(dictionary.Literals.label_39);strVar+="\t\t\t\t\t          \t<h1></h1>",strVar+='\t\t\t\t\t\t\t\t<button id="label_75">'+dictionary.Literals.label_75+"</button>"}if(strVar+="\t\t\t\t\t    \t      \t</div>",strVar+="\t\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t\t</div>",strVar+="\t\t\t\t\t</div>",strVar+="\t\t\t\t</div>",strVar+="\t\t\t</div><!-- /content -->",strVar+="\t\t</div><!-- / ProfileOfContact-page-->",$("body").append(strVar).find(".img-circle").unbind("click").on("click",function(evt){gui.showGallery($(evt.target).data("index"))}),$("#contacts4Profile").listview().listview("refresh").find('[id^="contact4Profile_"]').on("click",function(e){var id=$(this).attr("id"),idTruncated=id.substring(16,id.length),contact2show=contactsHandler.getContactById(idTruncated);"undefined"!=typeof contact2show&&null!=contact2show&&gui.showConversation(contact2show)}),$("body").pagecontainer("change","#ProfileOfContact-page",{transition:"none"}),gui.setImgIntoGallery(gui.indexOfImages4Gallery,obj.imgsrc,""),$(".backButton").unbind("click").bind("click",function(){gui.onBackButton()}),$("#label_54").unbind("click").bind("click",function(){gui.showBlockSomebodyPrompt()}),$("#label_55").unbind("click").bind("click",function(){gui.onReportAbuse()}),isPlan){gui.loadMapOnProfile(obj);var date2display=new Date(parseInt(obj.meetingInitDate));date2display=gui.formatter.formatDate(date2display,{datetime:"medium"}),date2display=date2display.substring(0,date2display.length-5),$("#label_73").val(date2display);var time2display=gui.formatter.formatDate(new Date(2e3,10,10,obj.meetingInitTime.hour,obj.meetingInitTime.mins),{time:"medium"});$("#label_74").val(time2display),$("#label_75").unbind("click").bind("click",function(){gui.showJoinPlanPrompt(obj)})}else gui.loadMapOnProfile()},GUI.prototype.showRemoveContactFromGroup=function(contact){$("#buttonAddContact2Group"+contact.publicClientID).attr({class:"icon-list ui-btn ui-btn-icon-notext ui-icon-plus"}),$("#contacts4Group").find("#divAddContact2Group"+contact.publicClientID).unbind("click").on("click",function(){gui.onAddContact2Group(contact)}),$("#contacts4Group").listview().listview("refresh")},GUI.prototype.showReportAbuse=function(){var html="";html+='<div id="block-confirm" role="main" class="ui-content">',html+=' <h1 id="label_58" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_58+"</h1><p> </p>",html+="</div>",gui.showDialog(html)},GUI.prototype.showTargetOnForwardMenu=function(obj){var html2insert='<li id="'+obj.publicClientID+'-inForwardMenu"> <a>    <img id="profilePhoto'+obj.publicClientID+'" src="'+obj.imgsrc+'" class="imgInMainPage"/>  <h2>'+obj.nickName+"</h2>   <p>"+obj.commentary+"</p></a> <a></a></li>";$("#listOfContactsInForwardMenu").append(html2insert).listview().listview("refresh").find("#"+obj.publicClientID+"-inForwardMenu").first().on("click",function(){gui.forwardMsg(obj)})},GUI.prototype.showTermsAndConditions=function(){var html="";html+='<h1>Terms and Conditions ("Terms")</h1>',html+='<p>Please read these Terms and Conditions carefully before using either the knet mobile app or the http://www.instaltic.com/knet website (the "Service") operated by InstalTIC S.L. ("us", "we", or "our").</p>',html+="<p>Your access to and use of the Service is conditioned on your acceptance of and compliance with these Terms. These Terms apply to all visitors, users and others who access or use the Service.</p>",html+="<p>By accessing or using the Service you agree to be bound by these Terms. If you disagree with any part of the terms then you may not access the Service.</p>",html+="<p><strong> privacy policy </strong></p>",html+="<p>We do not request any personal data from you. Your identity is just a random number for us. However you can always set your details in your profile if you want to share them with other users. </p>",html+="<p>We do not collect your messages. The only message data stored on our servers is the data that is currently in transit, and even this data is encrypted with end-to-end encryption, we can not read it. </p>",html+="<p>We do not any financial data of yours. </p>",html+="<p>There are some data knet uses in order to provide the service: </p>",html+="<p>your IP-address, or the IP-Address of a router when you are in a network using NAT,</p>",html+="<p>your public keys, </p>",html+="<p>your client identifier, which is a random number, </p>",html+="<p>your chosen nickname, avatar, telephone and email, if and only is you decided to put it into your profile. </p>",html+="<p><strong>Accounts</strong></p>",html+="<p>We may terminate your account, without previous warning if you breach the Terms. We will immediately block your account if we detect an inappropriate use of the service. </p>",html+="<p><strong>Links To Other Web Sites</strong></p>",html+="<p>Our Service may contain links to third-party web sites or services that are not owned or controlled by knet.</p>",html+="<p>knet has no control over, and assumes no responsibility for, the content, privacy policies, or practices of any third party web sites or services. You further acknowledge and agree that knet shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with use of or reliance on any such content, goods or services available on or through any such web sites or services.</p>",html+="<p>We strongly advise you to read the terms and conditions and privacy policies of any third-party web sites or services that you visit.</p>",html+="<p><strong>Termination</strong></p>",html+="<p>We may terminate or suspend access to our Service immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms.</p>",html+="<p>All provisions of the Terms which by their nature should survive termination shall survive termination, including, without limitation, ownership provisions, warranty disclaimers, indemnity and limitations of liability.</p>",html+="<p>We may terminate or suspend your account immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms.</p>",html+="<p>Upon termination, your right to use the Service will immediately cease. If you wish to terminate your account, you may simply discontinue using the Service.</p>",html+="<p>All provisions of the Terms which by their nature should survive termination shall survive termination, including, without limitation, ownership provisions, warranty disclaimers, indemnity and limitations of liability.</p>",html+="<p><strong>Governing Law</strong></p>",html+="<p>These Terms shall be governed and construed in accordance with the laws of Spain, without regard to its conflict of law provisions.</p>",html+="<p>Our failure to enforce any right or provision of these Terms will not be considered a waiver of those rights. If any provision of these Terms is held to be invalid or unenforceable by a court, the remaining provisions of these Terms will remain in effect. These Terms constitute the entire agreement between us regarding our Service, and supersede and replace any prior agreements we might have between us regarding the Service.</p>",html+="<p><strong>Changes</strong></p>",html+="<p>We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material we will try to provide at least 15 days notice prior to any new terms taking effect. What constitutes a material change will be determined at our sole discretion.</p>",html+="<p>By continuing to access or use our Service after those revisions become effective, you agree to be bound by the revised terms. If you do not agree to the new terms, please stop using the Service.</p>",html+="<p><strong>Contact Us</strong></p>",html+="<p>If you have any questions about these Terms, please contact us. The easiest way to contact us is to email us to support@instaltic.com</p>",html+="<p><strong></strong></p>",html+="<p><strong><br></strong></p>",html+='<a id="label_59" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_59+"</a>",html+="<p><strong><br></strong></p>",gui.showDialog(html),$("#label_59").click(function(){$("#popupDiv").popup("close"),$("#popupDiv").remove()})},GUI.prototype.showUnblockSomebodyPrompt=function(obj){var html="";html+='<div role="main" class="ui-content">',html+=' <h1 id="label_50" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_50+"</h1><p> </p>",html+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+obj.imgsrc+'" class="imgInMainPage"/>  \t <h2>'+obj.nickName+"</h2>   \t <p>"+obj.commentary+"</p>    </a>  </li>",html+='  <a id="label_46" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",html+='  <a id="label_47" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",html+=" </ul>",html+="</div>",gui.showDialog(html),gui.loadGroupMenu(),$("#label_46").unbind("click").on("click",function(){obj.isBlocked=!1,abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj),$("#popupDiv").remove(),gui.loadGroupMenu(),gui.showEntryOnMainPage(obj)}),$("#label_47").unbind("click").on("click",function(){$("#popupDiv").remove()})},GUI.prototype.showWelcomeMessage=function(text2show){text2show&&$.mobile.loading("show",{text:text2show,textVisible:!0,theme:$.mobile.loader.prototype.options.theme,textonly:!0,html:""})},GUI.prototype.showPeerIsOnline=function(ping){var obj=abstractHandler.getObjById(ping.idWhoIsOnline);if("undefined"!=typeof obj&&null!=obj){var tag=$("#link2go2ChatWith_"+obj.publicClientID).children().closest("p");"on"!=tag.data("typing")&&(tag.html('<font color="orange"><b> online</b></font>'),tag.delay(config.TIME_FADE_ONLINE_NOTICE).fadeOut(config.TIME_FADE_ONLINE_NOTICE).fadeIn(config.TIME_FADE_ONLINE_NOTICE).fadeOut(config.TIME_FADE_ONLINE_NOTICE).fadeIn(config.TIME_FADE_ONLINE_NOTICE,function(){var newObj=abstractHandler.getObjById(ping.idWhoIsOnline);gui.showLastMsgTruncated(newObj)}))}},GUI.prototype.showPeerIsTyping=function(ping){var obj=abstractHandler.getObjById(ping.idWhoIsWriting);if("undefined"!=typeof obj&&null!=obj){var tag=$("#link2go2ChatWith_"+obj.publicClientID).children().closest("p");"on"!=tag.data("typing")&&(tag.html('<font color="orange"><b> '+dictionary.Literals.label_61+" ... </b></font>"),tag.data("typing","on"),tag.delay(config.TIME_FADE_WRITING).fadeOut(config.TIME_FADE_WRITING).fadeIn(config.TIME_FADE_WRITING).fadeOut(config.TIME_FADE_WRITING).fadeIn(config.TIME_FADE_WRITING,function(){tag.data("typing","off");var newObj=abstractHandler.getObjById(ping.idWhoIsWriting);gui.showLastMsgTruncated(newObj)}))}},GUI.prototype.refreshCounterOfChat=function(obj){obj.counterOfUnreadSMS>0?($("#counterOf_"+obj.publicClientID).text(obj.counterOfUnreadSMS),$("#counterOf_"+obj.publicClientID).attr("class","ui-li-count")):($("#counterOf_"+obj.publicClientID).text(""),$("#counterOf_"+obj.publicClientID).attr("class","")),$("#listOfContactsInMainPage").listview().listview("refresh")},GUI.prototype.refreshProfileInfo=function(profileUpdate){var obj=abstractHandler.getObjById(profileUpdate.publicClientID);if("undefined"!=typeof obj&&null!=obj){obj.lastProfileUpdate=(new Date).getTime(),abstractHandler.setOnList(obj),abstractHandler.setOnDB(obj),$("#profilePhoto"+obj.publicClientID).attr("src",obj.imgsrc),app.currentChatWith==obj.publicClientID&&$("#imgOfChat-page-header").attr("src",obj.imgsrc);var kids=$("#link2go2ChatWith_"+obj.publicClientID).children();""!=obj.imgsrc&&kids.find("img").attr("src",obj.imgsrc),""!=obj.nickName&&kids.closest("h2").html(obj.nickName),""!=obj.commentary&&kids.closest("p").html(obj.commentary)}},GUI.prototype.refreshPurchasePrice=function(){var purchase=gui.getPurchaseDetails(),price=0;"fourYears"==purchase.licenseDurationChoosen&&(price+=3),"oneYear"==purchase.licenseDurationChoosen&&(price+=1),purchase.isNGOdonationChecked&&(price+=1),purchase.isFSIdonationChecked&&(price+=1),$("#price").html(price+"€")},MailBox.prototype.getAllMessagesOf=function(id,olderDate,newerDate){var range=IDBKeyRange.bound(olderDate,newerDate),deferred=$.Deferred(),listOfMessages=[];return db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(range).onsuccess=function(e){var cursor=e.target.result;if(cursor){if(cursor.value.chatWith==id){var newMsg=new Message(cursor.value);listOfMessages.push(newMsg)}cursor.continue()}else deferred.resolve(listOfMessages)},deferred.promise()},MailBox.prototype.getMessageByID=function(msgID){var singleKeyRange=IDBKeyRange.only(msgID),deferredGetMessageByID=$.Deferred();return db.transaction(["messages"],"readonly").objectStore("messages").openCursor(singleKeyRange).onsuccess=function(e){var message,cursor=e.target.result;if(cursor){message=cursor.value;var newMsg=new Message(message);deferredGetMessageByID.resolve(newMsg)}},deferredGetMessageByID.promise()},MailBox.prototype.getMessagesSentOffline=function(olderDate,newerDate){var range=IDBKeyRange.bound(olderDate,newerDate),deferred=$.Deferred(),listOfMessages=[];return db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(range).onsuccess=function(e){var cursor=e.target.result;if(cursor){if(0==cursor.value.ACKfromServer){var newMsg=new Message(cursor.value);listOfMessages.push(newMsg)}cursor.continue()}else deferred.resolve(listOfMessages)},deferred.promise()},MailBox.prototype.retrieveMessages=function(id,newerDate){"undefined"==typeof newerDate&&(newerDate=(new Date).getTime());var olderDate=config.TIME_UNIX_2015,range=IDBKeyRange.bound(olderDate,newerDate),deferred=$.Deferred(),listOfMessages=[],counter=0;return db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(range,"prev").onsuccess=function(e){var cursor=e.target.result;if(cursor&&counter<config.MAX_SMS_RETRIEVAL){if(cursor.value.chatWith==id){var newMsg=new Message(cursor.value);listOfMessages.push(newMsg),counter+=1}cursor.continue()}else deferred.resolve(listOfMessages)},deferred.promise()},MailBox.prototype.sendOfflineMessages=function(olderDate,newerDate,listOfMessages){mailBox.getMessagesSentOffline(olderDate,newerDate).done(function(list){listOfMessages.length>config.MAX_SEND_OFFLINE_SMS||olderDate<config.TIME_UNIX_2015?listOfMessages.map(function(message){postman.sendMsg(message)}):(olderDate-=config.TIME_UNIX_MONTH,newerDate-=config.TIME_UNIX_MONTH,mailBox.sendOfflineMessages(olderDate,newerDate,listOfMessages.concat(list)))})},MailBox.prototype.storeMessage=function(msg2Store){try{var singleKeyRange=IDBKeyRange.only(msg2Store.msgID),transaction=db.transaction(["messages"],"readwrite"),store=transaction.objectStore("messages");store.openCursor(singleKeyRange).onsuccess=function(e){var cursor=e.target.result;cursor?cursor.update(msg2Store):store.add(msg2Store)}}catch(e){log.debug("MailBox.prototype.storeMessage",e)}},MailBox.prototype.removeMessage=function(msg2remove){try{var transaction=db.transaction(["messages"],"readwrite"),store=transaction.objectStore("messages");store.delete(msg2remove.msgID).onsuccess=function(e){log.debug("removeMessage ::: succesfully removed")}}catch(e){log.debug("MailBox.prototype.storeMessage",e)}},MailBox.prototype.unwrapMessagesOf=function(contact){try{var singleKeyRange=IDBKeyRange.only(contact.publicClientID),transaction=db.transaction(["messages"],"readonly"),store=transaction.objectStore("messages");store.index("publicclientid").openCursor(singleKeyRange).onsuccess=function(e){var cursor=e.target.result;cursor&&cursor.value.messageBody.hasOwnProperty("index4Key")&&(postman.onMsgFromClient(cursor.value),log.info("MailBox.prototype.unwrapMessagesOf"))}}catch(e){log.debug("MailBox.prototype.unwrapMessagesOf",e)}},Application.prototype.bindDeviceEvents=function(){document.addEventListener("deviceready",this.onDeviceReady,!1),document.addEventListener("backbutton",gui.onBackButton,!1),document.addEventListener("menubutton",function(){},!1),document.addEventListener("searchbutton",function(){},!1),document.addEventListener("startcallbutton",function(){},!1),document.addEventListener("endcallbutton",function(){},!1),document.addEventListener("pause",function(){app.inBackground=!0},!1),document.addEventListener("resume",this.onResumeCustom,!1),document.addEventListener("online",this.onOnlineCustom,!1)},Application.prototype.bindPushEvents=function(){var push=PushNotification.init(config.pushOptions);push.on("registration",function(data){app.sendPushRegistrationId(data.registrationId)}),push.on("notification",function(data){}),push.on("error",function(e){console.log("Application.prototype.bindPushEvents - error")})},Application.prototype.connect2paypal=function(myPurchase){$.ajax({url:"https://"+config.ipServerSockets+":"+config.portServerSockets+"/payment",method:"POST",data:{handshakeToken:user.handshakeToken,purchase:myPurchase},dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!1}}).done(function(response){1==response.OK&&(gui.inAppBrowser=window.open(response.URL,"_blank","location=yes"),gui.inAppBrowser.addEventListener("loadstop",gui.onAppBrowserLoad),gui.inAppBrowser.addEventListener("exit",gui.onAppBrowserExit))}).fail(function(){log.info("Application.prototype.connect2paypal - failed")}).always(function(){gui.hideLoadingSpinner()})},Application.prototype.connect2server=function(result){app.symetricKey2use=user.myArrayOfKeys[result.index];var challengeClear=postman.decrypt(result.challenge).challenge,token2sign={handshakeToken:user.handshakeToken,challenge:encodeURI(postman.encrypt({challengeClear:challengeClear}))};app.tokenSigned=postman.signToken(token2sign);var remoteServer=postman.decrypt(result.server2connect);null!=remoteServer&&(config.ipServerSockets=remoteServer.ipServerSockets,config.portServerSockets=remoteServer.portServerSockets),"undefined"!=typeof socket&&socket.disconnect(),log.info("remoteServer",remoteServer);var url="https://"+config.ipServerSockets+":"+config.portServerSockets,options={forceNew:!0,secure:!0,reconnection:!0,query:"token="+app.tokenSigned+"&version="+config.SW_VERSION,path:"/wss/socket.io"};socket=io.connect(url,options),socket.on("connect",function(){app.connecting=!1,log.info("socket.on.connect");var newerDate=(new Date).getTime(),olderDate=new Date(newerDate-config.TIME_UNIX_MONTH).getTime();mailBox.sendOfflineMessages(olderDate,newerDate,[]),
app.isMobile&&app.bindPushEvents();var awarenessList=[];contactsHandler.listOfContacts.map(function(e){awarenessList.push(e.publicClientID)});var ping={idWhoIsOnline:user.publicClientID,listOfReceivers:awarenessList};postman.send("WhoIsOnline",ping),log.info("send ... WhoIsOnline"),easyrtc._init()}),socket.on("disconnect",function(){log.info("socket.on.disconnect, sendLogin in ",config.TIME_WAIT_WAKEUP),setTimeout(function(){app.sendLogin()},config.TIME_WAIT_WAKEUP),app.easyrtcid=null}),socket.on("reconnect_attempt",function(){log.info("socket.on.reconnect_attempt"),app.connecting=!0}),socket.on("reconnect_failed",function(){log.info("socket.on.reconnect_failed"),app.connecting=!1,app.sendLogin()}),socket.on("reconnect",function(){log.info("socket.on.reconnect"),app.connecting=!1,postman.send("reconnectNotification",{publicClientID:user.publicClientID});var newerDate=(new Date).getTime(),olderDate=new Date(newerDate-config.TIME_UNIX_MONTH).getTime();mailBox.sendOfflineMessages(olderDate,newerDate,[])}),socket.on("MessageDeliveryReceipt",function(inputDeliveryReceipt){log.info("MessageDeliveryReceipt ");var deliveryReceipt=postman.getDeliveryReceipt(inputDeliveryReceipt);null!=deliveryReceipt&&setTimeout(function(){mailBox.getMessageByID(deliveryReceipt.msgID).done(function(message){"undefined"!=typeof message&&null!=message&&("ACKfromServer"==deliveryReceipt.typeOfACK&&0==message.ACKfromServer&&(message.ACKfromServer=!0,$("#messageStateColor_"+deliveryReceipt.msgID).toggleClass("amber-rx-by-srv")),"ACKfromAddressee"==deliveryReceipt.typeOfACK&&0==message.ACKfromAddressee&&(message.ACKfromServer=!0,message.ACKfromAddressee=!0,$("#messageStateColor_"+deliveryReceipt.msgID).toggleClass("green-rx-by-end")),"ReadfromAddressee"==deliveryReceipt.typeOfACK&&(message.ACKfromServer=!0,message.ACKfromAddressee=!0,message.markedAsRead=!0,$("#messageStateColor_"+deliveryReceipt.msgID).toggleClass("blue-r-by-end"),$(".blue-r-by-end").delay(config.TIME_FADE_ACK).fadeTo(config.TIME_FADE_ACK,0)),mailBox.storeMessage(message))})},config.TIME_WAIT_DB)}),socket.on("ServerReplytoDiscoveryHeaders",function(inputListOfHeaders){var listOfHeaders=postman.getListOfHeaders(inputListOfHeaders);if(null!=listOfHeaders){log.info("socket.on.ServerReplytoDiscoveryHeaders",listOfHeaders);var loopRequestingMessages=setInterval(function(){if(listOfHeaders.length>0){var message2request=listOfHeaders.pop(),requestOfMessage={msgID:message2request.msgID};postman.send("messageRetrieval",requestOfMessage)}else clearInterval(loopRequestingMessages)},config.TIME_WAIT_MAILBOX_POLLING)}}),socket.on("RequestForProfile",function(input){var request=postman.getProfileRequest(input);null!=request&&request.lastProfileUpdate<user.lastProfileUpdate&&app.sendProfileUpdate()}),socket.on("ProfileFromServer",function(input){var contactUpdate=postman.getProfileFromServer(input);if(null!=contactUpdate){var contact=contactsHandler.getContactById(contactUpdate.publicClientID);if("undefined"!=typeof contact&&null!=contact){contact.lastProfileUpdate=(new Date).getTime(),contactsHandler.setContactOnList(contactUpdate),contactsHandler.updateContactOnDB(contact),$("#profilePhoto"+contact.publicClientID).attr("src",contact.imgsrc),app.currentChatWith==contact.publicClientID&&$("#imgOfChat-page-header").attr("src",contact.imgsrc);var kids=$("#link2go2ChatWith_"+contact.publicClientID).children();""!=contact.imgsrc&&kids.find("img").attr("src",contact.imgsrc),""!=contact.nickName&&kids.closest("h2").html(contact.nickName),""!=contact.commentary&&kids.closest("p").html(contact.commentary)}}}),socket.on("locationFromServer",function(input){var position=postman.getLocationFromServer(input);log.info("locationFromServer ::: "+JSON.stringify(position)),position&&null!=position&&""==app.myPosition.coords.latitude&&(app.myPosition.coords.latitude=parseFloat(position.coords.latitude),app.myPosition.coords.longitude=parseFloat(position.coords.longitude)),app.sendRequest4Neighbours()}),socket.on("notificationOfNewContact",contactsHandler.processNewContacts),socket.on("KeysDelivery",function(input){log.info("socket.on.KeysDelivery - receiving something");var data=postman.getKeysDelivery(input);if(null!=data)if(data.from==user.publicClientID)log.info("socket.on.KeysDelivery - discard my own delivery");else try{var contact=contactsHandler.getContactById(data.from);if("undefined"!=typeof contact&&null!=contact||(contact=new ContactOnKnet({publicClientID:data.from}),contactsHandler.setContactOnList(contact),gui.showEntryOnMainPage(contact,!1)),null==contact.decryptionKeys){var masterKeydecrypted=app.keys.privateKey.decrypt(data.setOfKeys.masterKeyEncrypted,"RSA-OAEP"),decipher=forge.cipher.createDecipher("AES-CBC",masterKeydecrypted);decipher.start({iv:data.setOfKeys.symKeysEncrypted.iv2use}),decipher.update(forge.util.createBuffer(data.setOfKeys.symKeysEncrypted.keysEncrypted)),decipher.finish(),contact.decryptionKeys=KJUR.jws.JWS.readSafeJSONString(decipher.output.data).setOfSymKeys,contactsHandler.setContactOnList(contact),contactsHandler.setContactOnDB(contact),contactsHandler.sendProfileRequest(contact),mailBox.unwrapMessagesOf(contact)}}catch(ex){return log.debug("socket.on.KeysDelivery",contact),null}}),socket.on("KeysRequest",function(input){var data=postman.getKeysRequest(input);if(null!=data)if(data.from==user.publicClientID)log.info("socket.on.KeysRequest - discard my own Request");else try{var contact=contactsHandler.getContactById(data.from);contactsHandler.sendKeys(contact)}catch(ex){return log.debug("socket.on.KeysRequest",ex),null}}),socket.on("MessageFromClient",function(input){postman.onMsgFromClient(input)}),socket.on("WhoIsOnline",function(input){var ping=postman.getWhoIsOnline(input);null!=ping&&gui.showPeerIsOnline(ping)}),socket.on("WhoIsWriting",function(input){var ping=postman.getWhoIsWriting(input);null!=ping&&gui.showPeerIsTyping(ping)}),socket.on("PlansAround",function(input){var list=postman.getPlansAround(input);null!=list&&(gui.listOfPlans=list,gui.showPlansInResultsPage(list))}),socket.on("ImgOfPlanFromServer",function(input){var params=postman.getPlanImgFromServer(input);null!=params&&(gui.listOfPlans.map(function(e){e.planId==params.planId&&(e.imgsrc=params.imgsrc)}),gui.showPlanImgInResultsPage(params))})},Application.prototype.detectLanguage=function(){var language={};language.detected=null,language.value=null,"undefined"==typeof cordova||null==cordova?(language.detected=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,app.setLanguage(language)):$.when(app.events.documentReady,app.events.deviceReady).done(function(){navigator.globalization.getPreferredLanguage(function(detectedLanguage){language.detected=detectedLanguage.value,app.setLanguage(language)},function(){language.detected="English",app.setLanguage(language)})})},Application.prototype.detectPosition=function(){function success(pos){app.myPosition=pos,app.sendRequest4Neighbours()}function fail(error){log.info("detectPosition ::: failed "+JSON.stringify(error))}"undefined"==typeof cordova||null==cordova?navigator.geolocation&&navigator.geolocation.getCurrentPosition(success,fail,{maximumAge:1e5,enableHighAccuracy:!0,timeout:6e4}):$.when(app.events.deviceReady).done(function(){function success(pos){app.myPosition=pos,app.sendRequest4Neighbours()}function fail(error){console.log("DEBUG ::: detectPosition ::: failed")}navigator.geolocation.watchPosition(success,fail,{maximumAge:1e5,enableHighAccuracy:!1,timeout:6e4})})},Application.prototype.forwardMsg=function(message2send,receiver){message2send.from=user.publicClientID,message2send.to=receiver.publicClientID,message2send.chatWith=receiver.publicClientID,message2send.timestamp=(new Date).getTime(),message2send.msgID=message2send.assignId();var msg2store=new Message(message2send);msg2store.msgID=message2send.msgID,mailBox.storeMessage(msg2store),gui.showMsgInConversation(msg2store,{isReverse:!1,withFX:!0}),postman.sendMsg(message2send)},Application.prototype.registrationProcess=function(){gui.hideLoadingSpinner(),gui.showWelcomeMessage(dictionary.Literals.label_35),postman.generateKeyPair().done(function(keys){app.keys=keys;var certificate=postman.createCertificate(app.keys);app.keys.certificate=forge.pki.certificateToPem(certificate);var params={onConnected:function(){var clientPEMpublicKey=forge.pki.publicKeyToPem(app.keys.publicKey),registryRequest={event:"register",data:{clientPEMpublicKey:clientPEMpublicKey}},data2send=JSON.stringify(registryRequest);log.debug("registrationProcess ::: preparing"+data2send),app.authSocket.TLS.prepare(data2send)},onClosed:function(){},onDisconnected:function(){},onError:function(){gui.showWelcomeMessage(dictionary.Literals.label_42)},onReconnect:function(){}};app.establishTLS(params)})},Application.prototype.init=function(){window.shimIndexedDB.__useShim(),gui.loadBody(),gui.loadAsideMenuMainPage(),gui.bindDOMevents(),app.detectPosition(),app.detectLanguage(),app.loadPersistentData(),app.loadContactsBook(),app.loadMyNumber()},Application.prototype.initializeDevice=function(){Application.prototype.bindDeviceEvents(),"undefined"!=typeof cordova&&null!=cordova||(app.events.deviceReady.resolve(),app.isMobile=!1)},Application.prototype.loadContacts=function(){IDBKeyRange.only("publicClientID");db.transaction(["contacts"],"readonly").objectStore("contacts").openCursor(null,"nextunique").onsuccess=function(e){var cursor=e.target.result;if(cursor){var contact=new ContactOnKnet(cursor.value);contactsHandler.setContactOnList(contact),gui.showEntryOnMainPage(contact,!1),cursor.continue()}else gui.orderEntriesOnMainPage(),app.events.contactsLoaded.resolve()}},Application.prototype.loadContactsBook=function(){"undefined"!=typeof cordova&&null!=cordova&&$.when(app.events.deviceReady,app.events.documentReady).done(function(){})},Application.prototype.loadGroups=function(){IDBKeyRange.only("publicClientID");db.transaction(["groups"],"readonly").objectStore("groups").openCursor(null,"nextunique").onsuccess=function(e){var cursor=e.target.result;if(cursor){var group=new Group(cursor.value);groupsHandler.list.push(group),gui.showEntryOnMainPage(group,!1),cursor.continue()}}},Application.prototype.loadjscssfile=function(filename,filetype){if("js"==filetype){var fileref=document.createElement("script");fileref.setAttribute("type","text/javascript"),fileref.setAttribute("src",filename),fileref.setAttribute("id",filename)}else if("css"==filetype){var fileref=document.createElement("link");fileref.setAttribute("rel","stylesheet"),fileref.setAttribute("type","text/css"),fileref.setAttribute("href",filename),fileref.setAttribute("id",filename)}"undefined"!=typeof fileref&&document.getElementsByTagName("head")[0].appendChild(fileref)},Application.prototype.loadMyNumber=function(){"undefined"!=typeof cordova&&null!=cordova&&$.when(app.events.deviceReady,app.events.documentReady).done(function(){window.plugins.sim.getSimInfo(app.loadMyNumberSuccess,app.loadMyNumberError)})},Application.prototype.loadMyNumberError=function(result){},Application.prototype.loadMyNumberSuccess=function(result){if(""==user.myTelephone||null==user.myTelephone){var obj=JSON.parse(result);user.myTelephone=""+obj.mcc+obj.mnc,user.updateUserSettings()}},Application.prototype.loadPersistentData=function(){"undefined"==typeof cordova||null==cordova?$.when(app.events.documentReady).done(function(){app.loadStoredData()}):$.when(app.events.deviceReady,app.events.documentReady).done(function(){app.loadStoredData()})},Application.prototype.loadStoredData=function(){this.indexedDBHandler=indexedDB.open("com.instaltic.knet",5),this.indexedDBHandler.onupgradeneeded=function(event){var thisDB=event.target.result;if(!thisDB.objectStoreNames.contains("usersettings"))var objectStore=thisDB.createObjectStore("usersettings",{keyPath:"index"});if(!thisDB.objectStoreNames.contains("messages")){var objectStore=thisDB.createObjectStore("messages",{keyPath:"msgID"});objectStore.createIndex("timestamp","timestamp",{unique:!1}),objectStore.createIndex("publicclientid","publicclientid",{unique:!1})}if(!thisDB.objectStoreNames.contains("contacts"))var objectStore=thisDB.createObjectStore("contacts",{keyPath:"publicClientID"});if(!thisDB.objectStoreNames.contains("groups"))var objectStore=thisDB.createObjectStore("groups",{keyPath:"publicClientID"})},this.indexedDBHandler.onsuccess=function(event,caca){db=event.target.result,app.loadUserSettings(),app.loadGroups(),app.loadContacts()},this.indexedDBHandler.onerror=function(e){log.debug("indexedDBHandler.onerror",e)},this.indexedDBHandler.onblocked=function(){log.debug("indexedDBHandler.onblocked")}},Application.prototype.loadUserSettings=function(){var singleKeyRange=IDBKeyRange.only(0);try{db.transaction(["usersettings"],"readonly").objectStore("usersettings").openCursor(singleKeyRange).onsuccess=function(e){var cursor=e.target.result;return cursor&&"undefined"!=typeof cursor.value.publicClientID?(user=new UserSettings(cursor.value),app.keys.privateKey=forge.pki.privateKeyFromPem(user.keys.privateKey),app.keys.publicKey=forge.pki.publicKeyFromPem(user.keys.publicKey),app.keys.certificate=user.keys.certificate,gui.loadLoadingSpinner(),void app.events.userSettingsLoaded.resolve()):void app.registrationProcess()}}catch(e){log.debug("Application.prototype.loadUserSettings",e)}},Application.prototype.onDeviceReady=function(){try{app.devicePlatform=device.platform,app.deviceVersion=device.version,"WinCE"==app.devicePlatform||"Win32NT"==app.devicePlatform?document.removeEventListener("backbutton",gui.onBackButton,!1):document.addEventListener("backbutton",gui.onBackButton,!1),app.events.deviceReady.resolve()}catch(e){log.debug("Application.prototype.onDeviceReady",e)}},Application.prototype.onNativeCameraInit=function(sourceType,callback){app.setMultimediaAsOpen();var options={quality:50,encodingType:Camera.EncodingType.JPEG};"PHOTOLIBRARY"==sourceType?(options.sourceType=navigator.camera.PictureSourceType.PHOTOLIBRARY,options.destinationType=navigator.camera.DestinationType.FILE_URI):"CAMERA"==sourceType&&(options.sourceType=navigator.camera.PictureSourceType.CAMERA,options.destinationType=navigator.camera.DestinationType.FILE_URI),navigator.camera.getPicture(function(datasrc){callback(datasrc)},function(message){console.log("DEBUG ::: Application.prototype.onNativeCameraInit failed")},options)},Application.prototype.onOnlineCustom=function(){$.when(app.events.documentReady,app.events.contactsLoaded,app.events.userSettingsLoaded,app.events.deviceReady).done(function(){setTimeout(function(){app.sendLogin()},2*config.TIME_WAIT_WAKEUP)})},Application.prototype.onProcessPayment=function(){gui.showLoadingSpinner(),$.when(app.events.deviceReady).done(function(){var purchase=gui.getPurchaseDetails();app.connect2paypal(purchase)})},Application.prototype.onResumeCustom=function(){0==app.multimediaWasOpened&&(gui.hideLocalNotifications(),setTimeout(function(){app.sendLogin()},config.TIME_WAIT_WAKEUP)),app.inBackground=!1,app.multimediaWasOpened=!1,postman.send("reconnectNotification",{publicClientID:user.publicClientID})},Application.prototype.onTLSmsg=function(input){var obj=JSON.parse(input),event=obj.event;switch(event){case"registration":app.userRegistration(obj.data);break;case"LoginResponse":app.connect2server(obj.data),gui.hideLoadingSpinner();break;default:log.debug("onTLSmsg ::: any other event...")}},Application.prototype.userRegistration=function(data){if(log.debug("userRegistration ::: registration..."),"undefined"==typeof data||null==data||"undefined"==typeof data.publicClientID||null==data.publicClientID||"undefined"==typeof data.handshakeToken||null==data.handshakeToken)log.debug("userRegistration ::: something went wrong...");else{user=new UserSettings(data),user.myCurrentNick=user.publicClientID,user.lastProfileUpdate=(new Date).getTime(),user.keys.privateKey=forge.pki.privateKeyToPem(app.keys.privateKey),user.keys.publicKey=forge.pki.publicKeyToPem(app.keys.publicKey),user.keys.certificate=app.keys.certificate;var transaction=db.transaction(["usersettings"],"readwrite"),store=transaction.objectStore("usersettings");store.add(user);$.mobile.loading("hide"),gui.showTermsAndConditions(),app.events.userSettingsLoaded.resolve()}},Application.prototype.sendLogin=function(){if(1==app.connecting||0==app.initialized||"undefined"!=typeof socket&&1==socket.connected)return void log.info("sendLogin returned");log.info("sendLogin"),app.connecting=!0,gui.showLoadingSpinner();var params={onConnected:function(){var loginRequest={event:"login",data:{handshakeToken:user.handshakeToken}},data2send=JSON.stringify(loginRequest);log.debug("callback ::: establishTLS ::: onConnected : "+data2send),app.authSocket.TLS.prepare(data2send),gui.hideLoadingSpinner()},onClosed:function(){log.info("callback ::: establishTLS ::: onClosed"),"undefined"!=typeof app.authSocket.TLS&&app.authSocket.TLS.close()},onDisconnected:function(){log.info("callback ::: establishTLS ::: onDisconnected")},onReconnect:function(){log.info("callback ::: establishTLS ::: onReconnect")},onError:function(){app.connecting=!1,log.info("callback ::: establishTLS ::: onError"),setTimeout(function(){app.sendLogin()},2*config.TIME_WAIT_HTTP_POST)},onConnect_error:function(){app.connecting=!1,log.info("callback ::: establishTLS ::: onConnect_error "),setTimeout(function(){app.sendLogin()},3*config.TIME_WAIT_HTTP_POST)}};app.establishTLS(params)},Application.prototype.sendMultimediaMsg=function(options){var message2send=new Message({to:options.receiver,from:user.publicClientID,messageBody:{messageType:"multimedia",src:options.src}}),msg2store=new Message(message2send);mailBox.storeMessage(msg2store),gui.showMsgInConversation(msg2store,{isReverse:!1,withFX:!0}),postman.sendMsg(message2send)},Application.prototype.sendProfileUpdate=function(){var profileResponseObject={publicClientIDofSender:user.publicClientID,img:user.myPhotoPath,commentary:user.myCommentary,nickName:user.myCurrentNick,telephone:user.myTelephone,email:user.myEmail,visibility:user.visibility};postman.send("profileUpdate",profileResponseObject)},Application.prototype.sendPushRegistrationId=function(token){var registration={publicClientID:user.publicClientID,token:token};postman.send("PushRegistration",registration)},Application.prototype.sendRequest4Plans=function(selectedPosition){var whatsAround={location:{lat:null,lon:null}};selectedPosition&&(whatsAround.location.lat=selectedPosition.lat.toString(),whatsAround.location.lon=selectedPosition.lng.toString()),null!=whatsAround.location.lat&&postman.send("Request4Plans",whatsAround)},Application.prototype.sendRequest4Neighbours=function(selectedPosition){var whoIsAround={location:{lat:null,lon:null}};selectedPosition?(whoIsAround.location.lat=selectedPosition.lat.toString(),whoIsAround.location.lon=selectedPosition.lng.toString()):""!=app.myPosition.coords.latitude&&(whoIsAround.location.lat=app.myPosition.coords.latitude.toString(),whoIsAround.location.lon=app.myPosition.coords.longitude.toString()),null!=whoIsAround.location.lat&&(gui.showLoadingSpinner(),postman.send("RequestOfListOfPeopleAround",whoIsAround))},Application.prototype.establishTLS=function(params){log.debug("starting establishment of TLS "),null!=app.authSocket&&app.authSocket.disconnect(),null!=app.authSocket&&"undefined"!=typeof app.authSocket.TLS&&app.authSocket.TLS.close();var options={forceNew:!0,path:"/tls/socket.io"},url="https://"+config.ipServerSockets+":"+config.portServerSockets;app.authSocket=io.connect(url,options),app.authSocket.on("connect",function(){log.debug("authSocket.on.connect ::: emitting RequestTLSConnection");var request={clientPEMcertificate:app.keys.certificate};app.authSocket.emit("RequestTLSConnection",request)}),app.authSocket.on("reconnect",function(){log.debug("authSocket.on.reconnect"),params.onReconnect()}),app.authSocket.on("ResponseTLSConnection",function(answer){var options={serversPEMcertificate:answer.serversPEM,onConnected:params.onConnected,onClosed:params.onClosed,onTLSmsg:app.onTLSmsg,onDisconnected:params.onDisconnected,onError:params.onError};app.authSocket.TLS=postman.createTLSConnection(options),app.authSocket.TLS.handshake()}),app.authSocket.on("data2Client",function(data){app.authSocket.TLS.process(forge.util.decode64(data))}),app.authSocket.on("disconnect",function(){log.debug("authSocket.on.disconnect"),params.onDisconnected()}),app.authSocket.on("connect_error",function(){log.debug("authSocket.on.connect_error"),params.onError()})},Application.prototype.setLanguage=function(language){switch(language.value="",!0){case/en(?:\-[A-Z]{2}$)|EN$|en$|English$|english$/.test(language.detected):language.value="en";break;case/es(?:\-[A-Z]{2}$)|ES$|es$|espa\u00f1ol$|Espa\u00f1ol$/.test(language.detected):language.value="es";break;case/de(?:\-[A-Z]{2}$)|DE$|de$|deutsch$|Deutsch$/.test(language.detected):language.value="de";break;case/it(?:\-[A-Z]{2}$)|IT$|it$|italiano$|Italiano$/.test(language.detected):language.value="it";break;case/fr(?:\-[A-Z]{2}$)|FR$|fr$|fran\u00e7ais$|Fran\u00e7ais$/.test(language.detected):language.value="fr";break;case/pt(?:\-[A-Z]{2}$)|PT$|pt$|portugu\u00EAs$|Portugu\u00EAs$/.test(language.detected):language.value="pt";break;default:language.value="en"}dictionary.AvailableLiterals.hasOwnProperty(language.value)||(log.debug("app.setLanguage - NOT FOUND",language),language.value="en"),dictionary.Literals=dictionary.AvailableLiterals[language.value].value,gui.setLocalLabels(),Globalize.load(dictionary.Literals.CLDR),gui.formatter=Globalize(language.value)},Application.prototype.setMultimediaAsOpen=function(){app.multimediaWasOpened=!0},AbstractHandler.prototype.getObjById=function(publicClientID){var obj=contactsHandler.getContactById(publicClientID);return obj||(obj=groupsHandler.getGroupById(publicClientID)),obj},AbstractHandler.prototype.setOnDB=function(obj){obj instanceof ContactOnKnet?contactsHandler.setContactOnDB(obj):groupsHandler.setGroupOnDB(obj)},AbstractHandler.prototype.setOnList=function(obj){obj instanceof ContactOnKnet?contactsHandler.setContactOnList(obj):groupsHandler.setGroupOnList(obj)},ContactOnKnet.prototype.set=function(c){this.publicClientID=c.publicClientID?c.publicClientID:this.publicClientID,this.imgsrc="undefined"==typeof c.imgsrc||""==c.imgsrc||null==c.imgsrc?this.imgsrc:c.imgsrc,this.nickName=c.nickName?c.nickName:this.nickName,this.location=c.location?c.location:this.location,this.commentary="undefined"==typeof c.commentary||""==c.commentary?this.commentary:c.commentary,this.lastProfileUpdate=c.lastProfileUpdate?parseInt(c.lastProfileUpdate):this.lastProfileUpdate,this.counterOfUnreadSMS=c.counterOfUnreadSMS?c.counterOfUnreadSMS:this.counterOfUnreadSMS,this.timeLastSMS=c.timeLastSMS?parseInt(c.timeLastSMS):this.timeLastSMS,this.telephone=c.telephone?c.telephone:this.telephone,this.email=c.email?c.email:this.email,this.pubKeyPEM=c.pubKeyPEM?c.pubKeyPEM:this.pubKeyPEM,this.encryptionKeys=c.encryptionKeys?c.encryptionKeys:this.encryptionKeys,this.decryptionKeys=c.decryptionKeys?c.decryptionKeys:this.decryptionKeys,this.lastMsgTruncated="undefined"==typeof c.lastMsgTruncated||null==c.lastMsgTruncated?this.lastMsgTruncated:c.lastMsgTruncated},ContactsHandler.prototype.addNewContactOnDB=function(contact){$("#linkAddNewContact"+contact.publicClientID).attr({class:"icon-list ui-btn ui-btn-icon-notext ui-icon-carat-r"}).unbind("click").on("click",function(){gui.showConversation(contact)});var prompt2show=' <a class="backButton ui-btn-right" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext"></a> <img class="darkink" src="./res/new_contact_added_195x195.png"> <p class="darkink">'+dictionary.Literals.label_15+"</p> ";gui.showDialog(prompt2show),contactsHandler.setContactOnDB(contact)},ContactsHandler.prototype.generateKeys=function(toContact){toContact.encryptionKeys=[forge.random.getBytesSync(32).replace(/['"]/g,"A"),forge.random.getBytesSync(32).replace(/['"]/g,"B"),forge.random.getBytesSync(32).replace(/['"]/g,"C"),forge.random.getBytesSync(32).replace(/['"]/g,"D"),forge.random.getBytesSync(32).replace(/['"]/g,"E"),forge.random.getBytesSync(32).replace(/['"]/g,"F"),forge.random.getBytesSync(32).replace(/['"]/g,"G"),forge.random.getBytesSync(32).replace(/['"]/g,"H"),forge.random.getBytesSync(32).replace(/['"]/g,"I")]},ContactsHandler.prototype.getContactById=function(id){return this.listOfContacts.filter(function(c){return c.publicClientID==id})[0]},ContactsHandler.prototype.processNewContacts=function(input){gui.hideLoadingSpinner();var list=postman.getProcessNewContacts(input);if(null!=list){var page=$.mobile.activePage.attr("id");list.map(function(c){if(c.publicClientID!=user.publicClientID){var contact=contactsHandler.getContactById(c.publicClientID);contact?contactsHandler.setContactOnList(c):(contact=new ContactOnKnet(c),contactsHandler.setContactOnList(contact),gui.showEntryOnMainPage(contact,!0)),/searchResultsPage/.test(page)&&gui.showEntryOnResultsPage(contact,!0),contactsHandler.updateContactOnDB(contact),contactsHandler.sendProfileRequest(contact)}})}},ContactsHandler.prototype.sendKeys=function(contact){var setOfSymKeys={setOfSymKeys:contact.encryptionKeys},masterKey=forge.random.getBytesSync(32).replace(/['"]/g,"J"),iv2use=forge.random.getBytesSync(32).replace(/['"]/g,"K"),publicKeyClient=forge.pki.publicKeyFromPem(contact.pubKeyPEM),masterKeyEncrypted=publicKeyClient.encrypt(masterKey,"RSA-OAEP"),cipher=forge.cipher.createCipher("AES-CBC",masterKey);cipher.start({iv:iv2use}),cipher.update(forge.util.createBuffer(JSON.stringify(setOfSymKeys))),cipher.finish();var data={from:user.publicClientID,to:contact.publicClientID,setOfKeys:{masterKeyEncrypted:masterKeyEncrypted,symKeysEncrypted:{iv2use:iv2use,keysEncrypted:cipher.output.data}}};postman.send("KeysDelivery",data)},ContactsHandler.prototype.setContactOnList=function(contact){var found=!1;this.listOfContacts.map(function(c){if(c.publicClientID==contact.publicClientID)return c.set(contact),void(found=!0)}),0==found&&this.listOfContacts.push(contact)},ContactsHandler.prototype.setContactOnDB=function(contact){try{var singleKeyRange=IDBKeyRange.only(contact.publicClientID),transaction=db.transaction(["contacts"],"readwrite"),store=transaction.objectStore("contacts");store.openCursor(singleKeyRange).onsuccess=function(e){var cursor=e.target.result;cursor?cursor.update(contact):store.add(contact)}}catch(e){log.debug("ContactsHandler.prototype.setContactOnDB",e)}},ContactsHandler.prototype.setEncryptionKeys=function(toContact){contactsHandler.generateKeys(toContact),contactsHandler.setContactOnDB(toContact),contactsHandler.sendKeys(toContact)},ContactsHandler.prototype.sendProfileRequest=function(contact){var profileRetrievalObject={publicClientIDofRequester:user.publicClientID,publicClientID2getImg:contact.publicClientID,lastProfileUpdate:parseInt(contact.lastProfileUpdate)};postman.send("ProfileRetrieval",profileRetrievalObject)},ContactsHandler.prototype.updateContactOnDB=function(contact){try{var singleKeyRange=IDBKeyRange.only(contact.publicClientID),transaction=db.transaction(["contacts"],"readwrite"),store=transaction.objectStore("contacts");store.openCursor(singleKeyRange).onsuccess=function(e){var cursor=e.target.result;cursor&&cursor.update(contact)}}catch(e){log.debug("ContactsHandler.prototype.updateContactOnDB",e)}},easyrtc._init=function(){easyrtc.setStreamAcceptor(function(easyrtcid,stream){log.info("easyRTC setStreamAcceptor trigered"),$("body").pagecontainer("change","#conference-page",{transition:"none"});var conferenceStreamTag=document.getElementById("conferenceTag");clearTimeout(gui.timeoutPickupRTC),easyrtc.setVideoObjectSrc(conferenceStreamTag,stream),$("#callRejectButton").show().unbind("click").on("click",easyrtc._releaseResources),$("#imgConferenceCaller").hide(),$("#conferenceTag").show(),gui.hideLoadingSpinner()}),easyrtc.setOnStreamClosed(function(easyrtcid){log.info("easyRTC setOnStreamClosed trigered"),easyrtc._releaseResources()}),easyrtc.setAcceptChecker(function(easyrtcid,callback){log.info("easyRTC setAcceptChecker trigered"),clearTimeout(gui.timeoutPickupRTC),easyrtc.getConnectionCount()>0?(log.info("Dropping current call and accept new from "+easyrtcid),easyrtc.hangupAll()):log.info("Acceptting incoming call from "+easyrtcid),callback(!0)}),easyrtc.useThisSocketConnection(socket),easyrtc.enableVideoReceive(!0),easyrtc.enableAudio(!0),easyrtc.enableVideo(!0),easyrtc.enableDataChannels(!0)},easyrtc._performCall=function(easyrtcid){app.easyrtcid=easyrtcid,log.debug("easyrtc._performCall, I'm: "+easyrtcid),easyrtc.hangupAll();var acceptedCB=function(accepted,caller){accepted||(easyrtc.showError("CALL-REJECTED","Sorry, your call to was rejected"),$.mobile.back()),gui.hideLoadingSpinner()},successCB=function(){$("#callRejectButton").show(),$("#conferenceTag").show(),gui.hideLoadingSpinner()},failureCB=function(){$.mobile.back(),gui.hideLoadingSpinner()};easyrtc.call(app.otherEasyrtcid,successCB,failureCB,acceptedCB)},easyrtc._req4call=function(easyrtcid){app.easyrtcid=easyrtcid,log.debug("easyrtc._req4call, I'm: "+easyrtcid);var message2send=new Message({to:app.currentChatWith,from:user.publicClientID,messageBody:{messageType:"req4call",easyRTCid:easyrtcid}});postman.sendMsg(message2send)},easyrtc._initMediaResource=function(successCallback){log.debug("easyrtc._initMediaResource "+app.easyrtcid),null==app.easyrtcid||"undefined"==typeof app.easyrtcid?easyrtc.initMediaSource(function(){easyrtc.connect("easyrtc.audioOnly",successCallback,easyrtc._connectFailure)},function(errorCode,errmesg){easyrtc.showError(errorCode,errmesg)}):successCallback(app.easyrtcid)},easyrtc._isAmissedCall=function(msg){var msgTime=new Date(msg.timestamp).getTime(),currentTime=(new Date).getTime();return currentTime-msgTime>config.TIME_WAIT_PICKUP},easyrtc._peerRequest4aCall=function(){easyrtc._initMediaResource(easyrtc._req4call),gui.showConferencePage(function(){},easyrtc._releaseResources),$("#callAcceptButton").hide(),gui.timeoutPickupRTC=setTimeout(easyrtc._releaseResources,config.TIME_WAIT_PICKUP)},easyrtc._connectFailure=function(errorCode,message){easyrtc.showError(errorCode,message)},easyrtc._releaseResources=function(errorCode,message){clearTimeout(gui.timeoutPickupRTC),easyrtc.clearMediaStream(document.getElementById("conferenceTag")),easyrtc.setVideoObjectSrc(document.getElementById("conferenceTag"),""),easyrtc.closeLocalMediaStream(),easyrtc.setRoomOccupantListener(function(){}),$.mobile.back(),gui.hideLoadingSpinner()},easyrtc._sendRejection2peer=function(msg){easyrtc._releaseResources();var message2send=new Message({to:msg.from,from:user.publicClientID,messageBody:{messageType:"res4call",easyRTCid:null}});postman.sendMsg(message2send)},easyrtc._proccessCall=function(msg){$("#callAcceptButton").hide(),app.otherEasyrtcid=msg.messageBody.easyRTCid,easyrtc._initMediaResource(easyrtc._performCall)},Group.prototype.addMember=function(contact){var found=!1;this.listOfMembers.map(function(m){if(m==contact.publicClientID)return void(found=!0)}),0==found&&this.listOfMembers.push(contact.publicClientID)},Group.prototype.assignId=function(){for(var s=[],hexDigits="0123456789abcdef",i=0;i<36;i++)s[i]=hexDigits.substr(Math.floor(16*Math.random()),1);return s[14]="4",s[19]=hexDigits.substr(3&s[19]|8,1),s[8]=s[13]=s[18]=s[23]="-",s.join("")},Group.prototype.removeMember=function(contact){this.listOfMembers=this.listOfMembers.filter(function(id){return id!==contact.publicClientID})},Group.prototype.set=function(g){this.publicClientID=g.publicClientID?g.publicClientID:this.publicClientID,this.imgsrc="undefined"==typeof g.imgsrc||""==g.imgsrc||null==g.imgsrc?this.imgsrc:g.imgsrc,this.nickName=g.nickName?g.nickName:this.nickName,this.commentary="undefined"==typeof g.commentary||""==g.commentary?this.commentary:g.commentary,this.location=g.location?g.location:this.location,this.lastProfileUpdate=g.lastProfileUpdate?parseInt(g.lastProfileUpdate):this.lastProfileUpdate,this.counterOfUnreadSMS=g.counterOfUnreadSMS?g.counterOfUnreadSMS:this.counterOfUnreadSMS,
this.timeLastSMS=g.timeLastSMS?parseInt(g.timeLastSMS):this.timeLastSMS,this.telephone=g.telephone?g.telephone:this.telephone,this.email=g.email?g.email:this.email,this.listOfMembers=g.listOfMembers instanceof Array?g.listOfMembers:this.listOfMembers,this.isAccepted="boolean"==typeof g.isAccepted?g.isAccepted:this.isAccepted,this.isBlocked="boolean"==typeof g.isBlocked?g.isBlocked:this.isBlocked,this.lastMsgTruncated="undefined"==typeof g.lastMsgTruncated||null==g.lastMsgTruncated?this.lastMsgTruncated:g.lastMsgTruncated},GroupsHandler.prototype.getGroupById=function(id){return this.list.filter(function(g){return g.publicClientID==id})[0]},GroupsHandler.prototype.getMembersOfGroup=function(publicClientID){var listOfMembers=[];return this.list.map(function(g){if(g.publicClientID==publicClientID)return void(listOfMembers=g.listOfMembers)}),listOfMembers},GroupsHandler.prototype.sendGroupUpdate=function(group){var updateMsg=new Message({chatWith:group.publicClientID,to:group.publicClientID,from:user.publicClientID,messageBody:{messageType:"groupUpdate",group:group}});postman.sendMsg(updateMsg)},GroupsHandler.prototype.setGroupOnDB=function(group){try{var singleKeyRange=IDBKeyRange.only(group.publicClientID),transaction=db.transaction(["groups"],"readwrite"),store=transaction.objectStore("groups");store.openCursor(singleKeyRange).onsuccess=function(e){var cursor=e.target.result;cursor?cursor.update(group):store.add(group)}}catch(e){log.debug("ContactsHandler.prototype.setGroupOnDB",e)}},GroupsHandler.prototype.setGroupOnList=function(group){var found=!1;this.list.map(function(g){if(g.publicClientID==group.publicClientID)return g.set(group),void(found=!0)}),0==found&&this.list.push(group)},window.shimIndexedDB.__debug(!1),log4javascript.setEnabled(!1);var indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,db,socket,push,user,config=new Config,gui=new GUI,postman=new Postman,mailBox=new MailBox,abstractHandler=new AbstractHandler,contactsHandler=new ContactsHandler,groupsHandler=new GroupsHandler,dictionary=new Dictionary,log=log4javascript.getDefaultLogger(),app=new Application;$.when(app.events.documentReady,app.events.contactsLoaded,app.events.userSettingsLoaded,app.events.deviceReady).done(function(){app.initialized=!0,gui.bindButtonsOnMainPage(),app.sendLogin()}),$(document).ready(function(){FastClick.attach(document.body),app.init(),app.initializeDevice()});
//# sourceMappingURL=sourcemap.map