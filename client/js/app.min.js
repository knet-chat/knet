function UserSettings(a){this.index="undefined"==typeof a.index?0:a.index,this.publicClientID="undefined"==typeof a.publicClientID?null:a.publicClientID,this.myCurrentNick="undefined"==typeof a.myCurrentNick?"":a.myCurrentNick,this.myCommentary="undefined"==typeof a.myCommentary?"":a.myCommentary,this.myPhotoPath="undefined"==typeof a.myPhotoPath?"":a.myPhotoPath,this.myArrayOfKeys="undefined"==typeof a.myArrayOfKeys?null:a.myArrayOfKeys,this.lastProfileUpdate="undefined"==typeof a.lastProfileUpdate?null:parseInt(a.lastProfileUpdate),this.handshakeToken="undefined"==typeof a.handshakeToken?null:a.handshakeToken,this.myTelephone="undefined"==typeof a.myTelephone?"":a.myTelephone,this.myEmail="undefined"==typeof a.myEmail?"":a.myEmail,this.visibility="undefined"==typeof a.visibility?"on":a.visibility,this.keys="undefined"==typeof a.keys?{}:a.keys}function Message(a){this.to=a.to,this.from=a.from,this.msgID=a.msgID?a.msgID:this.assignId(),this.messageBody=a.messageBody,this.size=a.size?a.size:this.calculateSize(),this.timestamp=a.timestamp?parseInt(a.timestamp):(new Date).getTime(),this.markedAsRead="undefined"!=typeof a.markedAsRead&&a.markedAsRead,this.chatWith=a.chatWith?a.chatWith:this.to,this.ACKfromServer="undefined"!=typeof a.ACKfromServer&&a.ACKfromServer,this.ACKfromAddressee="undefined"!=typeof a.ACKfromAddressee&&a.ACKfromAddressee}function Postman(){}function GUI(){this.listOfImages4Gallery=[],this.indexOfImages4Gallery=0,this.inAppBrowser=null,this.photoGallery=null,this.photoGalleryClosed=!0,this.groupOnMenu=null,this.formatter=function(){},this.searchMap=null,this.listOfPlans=null,this.isPlanDisplayed=!1,this.timeoutPickupRTC=null}function MailBox(){}function Application(){this.currentChatWith=null,this.myPosition={coords:{latitude:"",longitude:""}},this.symetricKey2use=null,this.profileIsChanged=!1,this.map=null,this.connecting=!1,this.inBackground=!1,this.initialized=!1,this.tokenSigned=null,this.devicePlatform="",this.indexedDBHandler=null,this.deviceVersion="",this.events={},this.events.documentReady=new $.Deferred,this.events.contactsLoaded=new $.Deferred,this.events.userSettingsLoaded=new $.Deferred,this.events.deviceReady=new $.Deferred,this.isMobile=!0,this.msg2forward=null,this.authSocket=null,this.keys={},this.easyrtcid=null,this.otherEasyrtcid=null}function AbstractHandler(){}function ContactOnKnet(a){this.publicClientID=a.publicClientID,this.imgsrc="undefined"==typeof a.imgsrc||""==a.imgsrc||null==a.imgsrc?"./res/logo_300x300.jpg":a.imgsrc,this.nickName=a.nickName?a.nickName:dictionary.Literals.label_23,this.location=a.location?a.location:{lat:"",lon:""},this.commentary="undefined"==typeof a.commentary||""==a.commentary?dictionary.Literals.label_12:a.commentary,this.lastProfileUpdate=a.lastProfileUpdate?parseInt(a.lastProfileUpdate):config.TIME_UNIX_2015,this.counterOfUnreadSMS=a.counterOfUnreadSMS?a.counterOfUnreadSMS:0,this.timeLastSMS=a.timeLastSMS?parseInt(a.timeLastSMS):0,this.telephone=a.telephone?a.telephone:"",this.email=a.email?a.email:"",this.pubKeyPEM=a.pubKeyPEM?a.pubKeyPEM:null,this.encryptionKeys=a.encryptionKeys?a.encryptionKeys:null,this.decryptionKeys=a.decryptionKeys?a.decryptionKeys:null,this.isAccepted=!!a.isAccepted&&a.isAccepted,this.isBlocked=!!a.isBlocked&&a.isBlocked,this.lastMsgTruncated="undefined"==typeof a.lastMsgTruncated||null==a.lastMsgTruncated?"":a.lastMsgTruncated}function ContactsHandler(){this.listOfContacts=[]}function Group(a){this.publicClientID=a.publicClientID?a.publicClientID:this.assignId(),this.imgsrc="undefined"==typeof a.imgsrc||""==a.imgsrc||null==a.imgsrc?"./res/group_black_195x195.png":a.imgsrc,this.nickName=a.nickName?a.nickName:dictionary.Literals.label_23,this.commentary="undefined"==typeof a.commentary||""==a.commentary?dictionary.Literals.label_12:a.commentary,this.lastProfileUpdate=a.lastProfileUpdate?parseInt(a.lastProfileUpdate):config.TIME_UNIX_2015,this.location=a.location?a.location:{lat:"",lon:""},this.counterOfUnreadSMS=a.counterOfUnreadSMS?a.counterOfUnreadSMS:0,this.timeLastSMS=a.timeLastSMS?parseInt(a.timeLastSMS):0,this.telephone=a.telephone?a.telephone:"",this.email=a.email?a.email:"",this.listOfMembers=a.listOfMembers instanceof Array?a.listOfMembers:[],this.isAccepted=!!a.isAccepted&&a.isAccepted,this.isBlocked=!!a.isBlocked&&a.isBlocked,this.lastMsgTruncated="undefined"==typeof a.lastMsgTruncated||null==a.lastMsgTruncated?"":a.lastMsgTruncated}function GroupsHandler(){this.list=[]}function Dictionary(){var a=this;this.Literals_en={label_1:"Profile",label_2:"Groups",label_3:"Search",label_4:"Account",label_5:"my nick Name:",label_6:"coming soon",label_7:"send",label_8:"who can see me...",label_9:"Anybody",label_10:"should you switch this off, then only your contacts would see you online, is not that boring?",label_11:"Here you are",label_12:"is still thinking on a nice commentary",label_13:"I'm new on Visible!",label_14:"drag & drop",label_15:"new contact saved ! <br> ;-) ",label_16:"new message from:",label_17:"My commentary:",label_18:"Do you really want to exit?",label_19:"Exit",label_20:"No,Yes",label_23:"Name...",label_24:"Commentary...",label_25:"Telephone...",label_26:"e-mail",label_27:"User account Activation",label_28:"License valid for a year",label_29:"License valid for 4 years",label_30:"Back-up functionality",label_31:"Donation for associated NGOs",label_32:"Donation for our Open Source Initiative",label_33:"Total: ",label_34:"Buy",label_35:"Welcome ! we're generating your security channel, this process could take a few minutes, please be patience",label_36:"new Group",label_37:"My Groups",label_38:"create",label_39:"modify",label_40:"Group: ",label_41:"load earlier messages",label_42:"please enable your internet connection",label_43:"block",label_44:"report abuse",label_45:"add contact ",label_46:"yes",label_47:"no",label_48:"report abuse",label_49:"Consent",label_50:"unblock contact?",label_51:"Do you want to block this person?",label_52:"Blocked people",label_58:"reported",label_59:"agree",label_60:"Privacy policy",label_61:"typing",label_62:"Group Info",label_63:"Contact Info",label_64:"around this area",label_65:"create a new plan",label_66:"search people or join a plan",label_67:"today",label_68:"clear",label_69:"close",label_72:"plan",label_75:"join",label_76:"Ask the organizer?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{en:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"en"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"}},"stand-alone":{abbreviated:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"}}},days:{format:{abbreviated:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},narrow:{sun:"S",mon:"M",tue:"T",wed:"W",thu:"T",fri:"F",sat:"S"},short:{sun:"Su",mon:"Mo",tue:"Tu",wed:"We",thu:"Th",fri:"Fr",sat:"Sa"},wide:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"}},"stand-alone":{abbreviated:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},narrow:{sun:"S",mon:"M",tue:"T",wed:"W",thu:"T",fri:"F",sat:"S"},short:{sun:"Su",mon:"Mo",tue:"Tu",wed:"We",thu:"Th",fri:"Fr",sat:"Sa"},wide:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"}}}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"∞",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"‰",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{en:"en-GB"},"plurals-type-cardinal":{en:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, … @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, …"}}}}},this.Literals_de={label_1:"Profil",label_2:"Gruppen",label_3:"Suchen",label_4:"Konto",label_5:"Mein Spitzname:",label_6:"kommt bald",label_7:"Senden",label_8:"Sie sind sichtbar ...",label_9:"Alle",label_10:"sollten Sie dies abschalten, dann werden nur Ihre Kontakte Sie online sehen, ist das nicht langweilig?",label_11:"Hier sind Sie",label_12:"Denkt immer noch an einen schönen Kommentar",label_13:"Ich bin neu auf Visible!",label_14:"Drag & Drop",label_15:"Neuer Kontakt gespeichert! <br> ;-)",label_16:"neue Nachrichten von:",label_17:"Mein Kommentar:",label_18:"Wollen Sie wirklich beenden?",label_19:"Verlassen",label_20:"Abbrechen,Ok",label_23:"Name...",label_24:"Kommentar...",label_25:"Telefon...",label_26:"e-mail",label_27:"Benutzerkonto-Aktivierung",label_28:"Lizenz g&uuml;ltig f&uuml;r ein Jahr",label_29:"Lizenz g&uuml;ltig f&uuml;r 4 Jahre",label_30:"Back-up-Funktionalit&auml;t",label_31:"Spende f&uuml;r assoziierten NGOs",label_32:"Spende f&uuml;r unsere Open Source Initiative",label_33:"Gesamtsumme: ",label_34:"Kaufen",label_35:"Willkommen! Wir machen Ihrer Sicherheitsprotokoll, Dieser Prozess könnte ein paar Minuten dauern, bitte et was Geduld",label_36:"neue Gruppe",label_37:"meine Gruppen",label_38:"kreieren",label_39:"modifizieren",label_40:"Gruppe: ",label_41:"laden fr&uuml;here Nachrichten",label_42:"Bitte aktivieren Sie Ihre Internetverbindung",label_43:"blockieren",label_44:"missbrauch melden",label_45:"Kontakt hinzuf&uuml;gen ",label_46:"ja",label_47:"nein",label_48:"missbrauch melden",label_49:"Zustimmung",label_50:"entsperren Kontakt?",label_51:"Wollen Sie diesen Benutzer blockieren?",label_52:"Blockierte Personen",label_58:"berichtet",label_59:"zustimmen",label_60:"Datenschutzerkl&auml;rung",label_61:"schreiben",label_62:"Gruppeninformationen",label_63:"Kontaktinfos",label_64:"um dieses Gebiet",label_65:"einen neuen Plan erstellen",label_66:"Leute suchen oder einen Plan beitreten",label_67:"heute",label_68:"r&uuml;cksetzen",label_69:"schlie&szlig;en",label_72:"plan",label_75:"teilnehmen",label_76:"Fragen Sie den Veranstalter?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{de:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"de"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"Jan.",2:"Feb.",3:"März",4:"Apr.",5:"Mai",6:"Juni",7:"Juli",8:"Aug.",9:"Sep.",10:"Okt.",11:"Nov.",12:"Dez."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}},"stand-alone":{abbreviated:{1:"Jan",2:"Feb",3:"Mär",4:"Apr",5:"Mai",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Okt",11:"Nov",12:"Dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}}},days:{format:{abbreviated:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}},"stand-alone":{abbreviated:{sun:"So",mon:"Mo",tue:"Di",wed:"Mi",thu:"Do",fri:"Fr",sat:"Sa"},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"∞",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"‰",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{de:"de-DE"},"plurals-type-cardinal":{de:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, … @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, …"}}}}},this.Literals_it={label_1:"Profilo",label_2:"Gruppi",label_3:"Ricerca",label_4:"Account",label_5:"il mio nick name:",label_6:"in arrivo",label_7:"invia",label_8:"Ti visibile per ...",label_9:"Chiunque",label_10:"si dovrebbe passare questa via, allora solo i contatti avrebbero visto voi on-line, non &egrave; che noioso?",label_11:"Ecco a voi",label_12:"È ancora pensando a un bel commento",label_13:"Sono nuovo su Visible!",label_14:"trascinare l'immagine",label_15:"novo contacto guardado! <br>;-)",label_16:"nuovo messaggio:",label_17:"Il mio commento:",label_18:"Sei sicuro di voler uscire?",label_19:"Uscire",label_20:"Annulla,Ok",label_23:"Nome...",label_24:"Commento...",label_25:"Telefono...",label_26:"e-mail",label_27:"Conto di attivazione per l'utente",label_28:"Licenza valida per un anno",label_29:"Licenza valida per 4 anni",label_30:"Funzionalit&agrave; di back-up",label_31:"Donazione per le ONG associate",label_32:"Donazione per la nostra iniziativa Open Source",label_33:"Totale: ",label_34:"Acquistare",label_35:"Benvenuto! generando il vostro protocollo di sicurezza, questo processo potrebbe richiedere alcuni minuti, si prega di essere pazienti",label_36:"nuovo gruppo",label_37:"I miei gruppi",label_38:"creare",label_39:"modificare",label_40:"Gruppi: ",label_41:"caricare i messaggi precedenti",label_42:"si prega di abilitare la connessione a internet",label_43:"bloccare",label_44:"notifica di abuso",label_45:"Aggiungi contatto ",label_46:"certo",label_47:"no",label_48:"notifica di abuso",label_49:"Consenso",label_50:"sbloccare i contatti?",label_51:"Vuoi bloccare questa persona?",label_52:"persone bloccate",label_58:"segnalati",label_59:"concordare",label_60:"Politica sulla riservatezza",label_61:"digitando",label_62:"Info di gruppo",label_63:"Info di contatto",label_64:"intorno a questa zona",label_65:"creare un nuovo piano",label_66:"ricerca gente o aderire a un piano",label_67:"oggi",label_68:"reset",label_69:"chiudere",label_72:"piano",label_75:"partecipare",label_76:"Chiedi l'organizzatore?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{it:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"it"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"Jan.",2:"Feb.",3:"März",4:"Apr.",5:"Mai",6:"Juni",7:"Juli",8:"Aug.",9:"Sep.",10:"Okt.",11:"Nov.",12:"Dez."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}},"stand-alone":{abbreviated:{1:"Jan",2:"Feb",3:"Mär",4:"Apr",5:"Mai",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Okt",11:"Nov",12:"Dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"Januar",2:"Februar",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"}}},days:{format:{abbreviated:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}},"stand-alone":{abbreviated:{sun:"So",mon:"Mo",tue:"Di",wed:"Mi",thu:"Do",fri:"Fr",sat:"Sa"},narrow:{sun:"S",mon:"M",tue:"D",wed:"M",thu:"D",fri:"F",sat:"S"},short:{sun:"So.",mon:"Mo.",tue:"Di.",wed:"Mi.",thu:"Do.",fri:"Fr.",sat:"Sa."},wide:{sun:"Sonntag",mon:"Montag",tue:"Dienstag",wed:"Mittwoch",thu:"Donnerstag",fri:"Freitag",sat:"Samstag"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"∞",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"‰",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{it:"it-IT"},"plurals-type-cardinal":{de:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, … @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, …"}}}}},this.Literals_es={label_1:"Perfil",label_2:"Grupos",label_3:"Buscar",label_4:"Cuenta",label_5:"mi apodo / nick:",label_6:"pr&oacute;ximamente",label_7:"enviar",label_8:"eres visible para...",label_9:"todo el mundo",label_10:"si desactivas esto, entonces solo tus contactos te ver&aacute;n conectado, no te parece aburrido?",label_11:"Aqu&iacute; estas",label_12:"sigue aun pensando en un comentario bonito ;-)",label_13:"soy nuevo en Visible!",label_14:"arrastra una imagen",label_15:"nuevo contacto guardado! <br>;-)",label_16:"mensaje de:",label_17:"Mi comentario:",label_18:"De verdad quieres salir?",label_19:"Salir",label_20:"Cancelar,Ok",label_23:"Nombre...",label_24:"Comentario...",label_25:"Teléfono...",label_26:"e-mail",label_27:"Activaci&oacute;n de cuenta de usuario",label_28:"Licencia v&aacute;lida por un a&ntilde;o",label_29:"Licencia v&aacute;lida por 4 a&ntilde;os",label_30:"Funcionalidad de back-up",label_31:"Donaci&oacute;n para las ONG asociadas",label_32:"Donaci&oacute;n para nuestra Iniciativa Open Source",label_33:"Total: ",label_34:"Comprar",label_35:"¡Bienvenido! generando su canal de seguridad, este proceso podría tardar unos minutos, por favor sea paciente",label_36:"nuevo grupo",label_37:"mis Grupos",label_38:"crear",label_39:"modificar",label_40:"Grupo: ",label_41:"cargar mensajes anteriores",label_42:"Habilite la conexión a Internet por favor",label_43:"bloquear",label_44:"Denunciar abuso",label_45:"guardar contacto ",label_46:"si",label_47:"no",label_48:"Denunciar abuso",label_49:"Consentimiento",label_50:"¿desbloquear contacto?",label_51:"¿Quieres bloquear a esta persona?",label_52:"personas bloqueadas",label_58:"reportado",label_59:"de acuerdo",label_60:"Pol&iacute;tica de privacidad",label_61:"escribiendo",label_62:"Info de grupo",label_63:"Info de contacto",label_64:"en esta zona",label_65:"crear un plan nuevo",label_66:"buscar gente o unirse a un plan",label_67:"hoy",label_68:"reiniciar",label_69:"cerrar",label_72:"plan",label_75:"unirse",label_76:"Preguntar al organizador?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{es:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"es"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"ene.",2:"feb.",3:"mar.",4:"abr.",5:"may.",6:"jun.",7:"jul.",8:"ago.",9:"sept.",10:"oct.",11:"nov.",12:"dic."},wide:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"}},"stand-alone":{abbreviated:{1:"ene.",2:"feb.",3:"mar.",4:"abr.",5:"may.",6:"jun.",7:"jul.",8:"ago.",9:"sept.",10:"oct.",11:"nov.",12:"dic."},wide:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"}}},days:{format:{abbreviated:{sun:"dom.",mon:"lun.",tue:"mar.",wed:"mié.",thu:"jue.",fri:"vie.",sat:"sáb."},short:{sun:"DO",mon:"LU",tue:"MA",wed:"MI",thu:"JU",fri:"VI",sat:"SA"},wide:{sun:"domingo",mon:"lunes",tue:"martes",wed:"miércoles",thu:"jueves",fri:"viernes",sat:"sábado"}},"stand-alone":{abbreviated:{sun:"dom.",mon:"lun.",tue:"mar.",wed:"mié.",thu:"jue.",fri:"vie.",sat:"sáb."},narrow:{sun:"D",mon:"L",tue:"M",wed:"X",thu:"J",fri:"V",sat:"S"},short:{sun:"DO",mon:"LU",tue:"MA",wed:"MI",thu:"JU",fri:"VI",sat:"SA"},wide:{sun:"domingo",mon:"lunes",tue:"martes",wed:"miércoles",thu:"jueves",fri:"viernes",sat:"sábado"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"∞",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"‰",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{es:"es-ES"},"plurals-type-cardinal":{es:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, … @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, …"}}}}},this.Literals_fr={label_1:"Profil",label_2:"Groupes",label_3:"Recherche",label_4:"Compte",label_5:"mon surnom:",label_6:"&agrave; venir",label_7:"envoyer",label_8:"vous visible ...",label_9:"Tout le monde",label_10:"vous devez d&eacute;sactiver cette fonctionnalit&eacute;, seuls vos contacts verriez-vous en ligne, est pas ennuyeux?",label_11:"Ici, vous &ecirc;tes",label_12:"pensée sur une belle commentaires",label_13:"Je suis nouveau sur Visible!",label_14:"glissez-d&eacute;posez",label_15:"nouveau contact sauvegard&eacute;! <br>;-)",label_16:"nouveau message de:",label_17:"Mon commentaire:",label_18:"Voulez-vous vraiment quitter?",label_19:"Quitter",label_20:"Annuler,Ok",label_23:"Nom...",label_24:"Commentaire...",label_25:"Téléphone...",label_26:"e-mail",label_27:"Activation du compte de l'utilisateur",label_28:"licence valide pour un an",label_29:"licence valide pour 4 ans",label_30:"fonctionnalit&eacute; de back-up",label_31:"Don pour les ONG associ&eacute;es",label_32:"Don pour notre Open Source Initiative",label_33:"Total: ",label_34:"Acheter",label_35:"Bienvenue! g&eacute;n&eacute;ration de votre protocole de s&eacute;curit&eacute;, ce processus peut prendre quelques minutes, soyez patient svp",label_36:"nouveau groupe",label_37:"mes Groupes",label_38:"créer",label_39:"modifier",label_40:"Groupe: ",label_41:"charger les messages pr&eacute;c&eacute;dents",label_42:"s'il vous plait activez votre connexion Internet",label_43:"bloquer",label_44:"signaler un abus",label_45:"ajouter le contact ",label_46:"Oui",label_47:"non",label_48:"signaler un abus",label_49:"Consentement",label_50:"d&eacute;bloquer le contact?",label_51:"Voulez-vous bloquer cette personne?",label_52:"personnes bloqu&eacute;es",label_58:"signalé",label_59:"d'accord",label_60:"Politique de confidentialit&eacute;",label_61:"&eacute;crit maintenant",label_62:"Info du groupe",label_63:"Info de contact",label_64:"autour de cette zone",label_65:"cr&eacute;er un nouveau plan",label_66:"recherche de personnes ou de se joindre &agrave; un plan",label_67:"aujourd'hui",label_68:"r&eacute;initialiser",label_69:"fermer",label_72:"plan",label_75:"joindre",label_76:"Demandez &agrave; l'organisateur?",label_77:"Do you want to add this member into your group?",label_78:"Request sent",CLDR:{main:{fr:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"fr"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"janv.",2:"févr.",3:"mars",4:"avr.",5:"mai",6:"juin",7:"juil.",8:"août",9:"sept.",10:"oct.",11:"nov.",12:"déc."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janvier",2:"février",3:"mars",4:"avril",5:"mai",6:"juin",7:"juillet",8:"août",9:"septembre",10:"octobre",11:"novembre",12:"décembre"}},"stand-alone":{abbreviated:{1:"janv.",2:"févr.",3:"mars",4:"avr.",5:"mai",6:"juin",7:"juil.",8:"août",9:"sept.",10:"oct.",11:"nov.",12:"déc."},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janvier",2:"février",3:"mars",4:"avril",5:"mai",6:"juin",7:"juillet",8:"août",9:"septembre",10:"octobre",11:"novembre",12:"décembre"}}},days:{format:{abbreviated:{sun:"dim.",mon:"lun.",tue:"mar.",wed:"mer.",thu:"jeu.",fri:"ven.",sat:"sam."},narrow:{sun:"D",mon:"L",tue:"M",wed:"M",thu:"J",fri:"V",sat:"S"},short:{sun:"di",mon:"lu",tue:"ma",wed:"me",thu:"je",fri:"ve",sat:"sa"},wide:{sun:"dimanche",mon:"lundi",tue:"mardi",wed:"mercredi",thu:"jeudi",fri:"vendredi",sat:"samedi"}},"stand-alone":{abbreviated:{sun:"dim.",mon:"lun.",tue:"mar.",wed:"mer.",thu:"jeu.",fri:"ven.",sat:"sam."},narrow:{sun:"D",mon:"L",tue:"M",wed:"M",thu:"J",fri:"V",sat:"S"},short:{sun:"di",mon:"lu",tue:"ma",wed:"me",thu:"je",fri:"ve",sat:"sa"},wide:{sun:"dimanche",mon:"lundi",tue:"mardi",wed:"mercredi",thu:"jeudi",fri:"vendredi",sat:"samedi"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"∞",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"‰",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{fr:"fr-FR"},"plurals-type-cardinal":{fr:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, … @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, …"}}}}},this.Literals_pt={label_1:"Perfil",label_2:"Grupos",label_3:"Pesquisa",label_4:"Conta",label_5:"meu nick name:",label_6:"em breve",label_7:"enviar",label_8:"voc&ecirc; vis&iacute;vel para ...",label_9:"Qualquer um",label_10:"voc&ecirc; deve desligar esta op&ccedil;&atilde;o, ent&atilde;o apenas seus contatos iria v&ecirc;-lo on-line, n&atilde;o &eacute; t&atilde;o chato?",label_11:"Aqui est&aacute;",label_12:"ainda est&aacute; pensando em um coment&aacute;rio agrad&aacute;vel",label_13:"Eu sou novo no Visible!",label_14:"arrastar e solta",label_15:"novo contacto guardado! <br>;-)",label_16:"mensagens novas de: ",label_17:"Meu coment&aacute;rio:",label_18:"Voce realmente deseja sair?",label_19:"Sair",label_20:"Cancelar,Ok",label_23:"Nome ...",label_24:"Comentario...",label_25:"Telefone...",label_26:"e-mail",label_27:"Ativa&ccedil;&atilde;o de Conta de Usu&aacute;rio",label_28:"Licen&ccedil;a v&aacute;lida por um ano",label_29:"licen&ccedil;a v&aacute;lida por 4 anos",label_30:"back-up funcionalidade",label_31:"Doa&ccedil;&atilde;o para as ONGs associadas",label_32:"Doa&ccedil;&atilde;o para o nosso Iniciativa Open Source",label_33:"Total: ",label_34:"Comprar",label_35:"Bem-vindo! gerando seu protocolo de segurança, esse processo pode levar alguns minutos, por favor, seja paciente",label_36:"novo grupo",label_37:"meus Grupos",label_38:"criar",label_39:"modificar",label_40:"Grupo: ",label_41:"carregar mensagens anteriores",label_42:"Por favor, ative sua conexão de internet",label_43:"bloquear",label_44:"Denunciar abuso",label_45:"adicionar contato ",label_46:"sim",label_47:"n&atilde;o",label_48:"Denunciar abuso",label_49:"Consentimento",label_50:"desbloquear o contato?",label_51:"Voc&ecirc; deseja bloquear esta pessoa?",label_52:"pessoas bloqueadas",label_58:"relatado",label_59:"concordar",label_60:"Pol&iacute;tica de Privacidade",label_61:"digitando",label_62:"Info do grupo",label_63:"Info de contato",label_64:"em torno desta &aacute;rea",
label_65:"criar um novo plano",label_66:"busca de pessoas ou aderir a um plano",label_67:"hoje",label_68:"restabelecer",label_69:"fechar",label_72:"plan",label_75:"juntar-se",label_76:"Pe&ccedil;a o organizador?",label_77:"Do you want to add this member into your group?",CLDR:{main:{pt:{identity:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},generation:{_date:"$Date: 2014-03-13 22:27:12 -0500 (Thu, 13 Mar 2014) $"},language:"pt"},dates:{calendars:{gregorian:{months:{format:{abbreviated:{1:"jan",2:"fev",3:"mar",4:"abr",5:"mai",6:"jun",7:"jul",8:"ago",9:"set",10:"out",11:"nov",12:"dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janeiro",2:"fevereiro",3:"mar�o",4:"abril",5:"maio",6:"junho",7:"julho",8:"agosto",9:"setembro",10:"outubro",11:"novembro",12:"dezembro"}},"stand-alone":{abbreviated:{1:"jan",2:"fev",3:"mar",4:"abr",5:"mai",6:"jun",7:"jul",8:"ago",9:"set",10:"out",11:"nov",12:"dez"},narrow:{1:"J",2:"F",3:"M",4:"A",5:"M",6:"J",7:"J",8:"A",9:"S",10:"O",11:"N",12:"D"},wide:{1:"janeiro",2:"fevereiro",3:"mar�o",4:"abril",5:"maio",6:"junho",7:"julho",8:"agosto",9:"setembro",10:"outubro",11:"novembro",12:"dezembro"}}},days:{format:{abbreviated:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"s�b"},narrow:{sun:"D",mon:"S",tue:"T",wed:"Q",thu:"Q",fri:"S",sat:"S"},short:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"s�b"},wide:{sun:"domingo",mon:"segunda-feira",tue:"ter�a-feira",wed:"quarta-feira",thu:"quinta-feira",fri:"sexta-feira",sat:"s�bado"}},"stand-alone":{abbreviated:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"s�b"},narrow:{sun:"D",mon:"S",tue:"T",wed:"Q",thu:"Q",fri:"S",sat:"S"},short:{sun:"dom",mon:"seg",tue:"ter",wed:"qua",thu:"qui",fri:"sex",sat:"s�b"},wide:{sun:"domingo",mon:"segunda-feira",tue:"ter�a-feira",wed:"quarta-feira",thu:"quinta-feira",fri:"sexta-feira",sat:"s�bado"}}},dayPeriods:{format:{wide:{am:"AM","am-alt-variant":"am",noon:"noon",pm:"PM","pm-alt-variant":"pm"}}},dateFormats:{medium:"d/M/y"},timeFormats:{medium:"HH:mm"},dateTimeFormats:{medium:"{1} {0}"}}},fields:{second:{displayName:"Second","relative-type-0":"now","relativeTime-type-future":{"relativeTimePattern-count-one":"in {0} second","relativeTimePattern-count-other":"in {0} seconds"},"relativeTime-type-past":{"relativeTimePattern-count-one":"{0} second ago","relativeTimePattern-count-other":"{0} seconds ago"}}}},numbers:{currencies:{USD:{symbol:"$"}},defaultNumberingSystem:"latn","symbols-numberSystem-latn":{decimal:".",exponential:"E",group:",",infinity:"∞",minusSign:"-",nan:"NaN",percentSign:"%",perMille:"‰",plusSign:"+",timeSeparator:":"},"decimalFormats-numberSystem-latn":{standard:"#,##0.###"},"currencyFormats-numberSystem-latn":{currencySpacing:{beforeCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "},afterCurrency:{currencyMatch:"[:^S:]",surroundingMatch:"[:digit:]",insertBetween:" "}},standard:"#,##0.00"}}}},supplemental:{version:{_cldrVersion:"25",_number:"$Revision: 91 $"},currencyData:{fractions:{DEFAULT:{_rounding:"0",_digits:"2"}}},likelySubtags:{pt:"pt-PT"},"plurals-type-cardinal":{pt:{"pluralRule-count-one":"i = 1 and v = 0 @integer 1","pluralRule-count-other":" @integer 0, 2~16, 100, 1000, 10000, 100000, 1000000, … @decimal 0.0~1.5, 10.0, 100.0, 1000.0, 10000.0, 100000.0, 1000000.0, …"}}}}},this.AvailableLiterals={en:{value:a.Literals_en},de:{value:a.Literals_de},it:{value:a.Literals_it},es:{value:a.Literals_es},fr:{value:a.Literals_fr},pt:{value:a.Literals_pt}},this.Literals=this.AvailableLiterals.en.value}UserSettings.prototype.updateUserSettings=function(){var a=db.transaction(["usersettings"],"readwrite"),b=a.objectStore("usersettings");b.put(user)},Message.prototype.assignId=function(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")},Message.prototype.calculateSize=function(){var a=0;return"text"==this.messageBody.messageType?a=this.messageBody.text.length:"multimedia"==this.messageBody.messageType&&(a=this.messageBody.src.length),a},Message.prototype.convertToUTF=function(){this.messageBody.text=encodeURI(this.messageBody.text)},Message.prototype.getMsgID=function(){return this.msgID},Message.prototype.getTruncatedMsg=function(){var a="";return"multimedia"==this.messageBody.messageType?a="&#x1f4f7;":"text"==this.messageBody.messageType&&(a=decodeURI(gui._sanitize(this.messageBody.text)).substring(0,config.MAX_LENGTH_TRUNCATED_SMS)),a},Message.prototype.setChatWith=function(a){this.chatWith=a},Message.prototype.setACKfromServer=function(a){this.ACKfromServer=a},Message.prototype.setACKfromAddressee=function(a){this.ACKfromAddressee=a},Postman.prototype._isUUID=function(a){return"string"==typeof a&&/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(a)},Postman.prototype.createCertificate=function(a){var b="client",c=forge.pki.createCertificate();c.serialNumber="01",c.validity.notBefore=new Date,c.validity.notBefore.setFullYear(c.validity.notBefore.getFullYear()-1),c.validity.notAfter=new Date,c.validity.notAfter.setFullYear(c.validity.notAfter.getFullYear()+1);var d=[{name:"commonName",value:b},{name:"countryName",value:"ES"},{shortName:"ST",value:"Madrid"},{name:"localityName",value:"Madrid"},{name:"organizationName",value:"instaltic"},{shortName:"OU",value:"instaltic"}];return c.setSubject(d),c.setIssuer(d),c.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"subjectAltName",altNames:[{type:7,ip:"217.127.199.47"}]}]),c.publicKey=a.publicKey,c.sign(a.privateKey),log.debug('createcertificate created for "'+b+'": \n'+forge.pki.certificateToPem(c)),c},Postman.prototype.generateKeyPair=function(){var a=$.Deferred(),b={};if(b.bits=2048,b.e=65537,$.browser.chrome){var c=window.location.href.replace(/\\/g,"/").replace(/\/[^\/]*$/,""),d=['var base_url = "'+c+'";'+$("#worker_1").html()],e=new Blob(d,{type:"text/javascript"});b.workerScript=window.URL.createObjectURL(e),log.debug("$.browser.chrome true")}else log.debug("$.browser.chrome false"),b.workerScript="js/prime.worker.js";if("undefined"!=typeof Worker)forge.pki.rsa.generateKeyPair(b,function(b,c){a.resolve(c)});else{var f=forge.pki.rsa.generateKeyPair(b);a.resolve(f)}return a.promise()},Postman.prototype.createTLSConnection=function(a){var b=forge.tls.createConnection({server:!1,caStore:[a.serversPEMcertificate],sessionCache:{},cipherSuites:[forge.tls.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA,forge.tls.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA],virtualHost:"authknetserver",verify:function(a,b,c,d){return log.debug('TLS Client verifying certificate w/CN: "'+d[0].subject.getField("CN").value+'", verified: '+b+"..."),b},connected:function(b){log.info("TLS Client connected..."),setTimeout(function(){b.prepareHeartbeatRequest("heartbeat")},1),a.onConnected()},getCertificate:function(a,b){return log.info("TLS Client getting certificate ..."),app.keys.certificate},getPrivateKey:function(a,b){return forge.pki.privateKeyToPem(app.keys.privateKey)},tlsDataReady:function(a){try{var b=a.tlsData.getBytes();app.authSocket.emit("data2Server",forge.util.encode64(b))}catch(a){log.debug("TLS Client data2Server ::: exception"+a)}},dataReady:function(b){var c=b.data.getBytes();log.info("TLS Client received",c),a.onTLSmsg(c)},heartbeatReceived:function(a,b){log.debug("TLS Client received heartbeat: "+b.getBytes())},closed:function(b){log.debug("TLS Client connection closed."),a.onClosed()},error:function(b,c){log.error("TLS Client error: "+c.message),a.onError()}});return b},Postman.prototype.encrypt=function(a){try{var b=forge.cipher.createCipher("AES-CBC",app.symetricKey2use),c=Math.floor(7*Math.random()+0);b.start({iv:user.myArrayOfKeys[c]}),b.update(forge.util.createBuffer(JSON.stringify(a))),b.finish();var d=c+b.output.data;return d}catch(a){return log.debug("Postman.prototype.encrypt",a),null}},Postman.prototype.encryptHandshake=function(a){try{var b=forge.cipher.createCipher("AES-CBC",app.symetricKey2use);b.start({iv:app.symetricKey2use}),b.update(forge.util.createBuffer(JSON.stringify(a))),b.finish();var c=b.output.data;return c}catch(a){return log.debug("Postman.prototype.encryptHandshake",a),null}},Postman.prototype.encryptMsgBody=function(a){try{var b=contactsHandler.getContactById(a.to);null==b.encryptionKeys&&contactsHandler.setEncryptionKeys(b);var c=Math.floor(7*Math.random()+0),d=Math.floor(7*Math.random()+0),e=b.encryptionKeys[c],f=b.encryptionKeys[d],g=forge.cipher.createCipher("AES-CBC",e);g.start({iv:f}),g.update(forge.util.createBuffer(JSON.stringify(a.messageBody))),g.finish();var h={index4Key:c,index4iv:d,encryptedMsg:g.output.data};return h}catch(a){return log.debug("Postman.prototype.encryptMsgBody",a),null}},Postman.prototype.decrypt=function(a){try{var b=forge.cipher.createDecipher("AES-CBC",app.symetricKey2use),c=parseInt(a.substring(0,1));return b.start({iv:user.myArrayOfKeys[c]}),b.update(forge.util.createBuffer(a.substring(1))),b.finish(),KJUR.jws.JWS.readSafeJSONString(b.output.data)}catch(a){return log.debug("Postman.prototype.decrypt",a),null}},Postman.prototype.decryptHandshake=function(a){try{var b=forge.cipher.createDecipher("AES-CBC",app.symetricKey2use),c=app.symetricKey2use;return b.start({iv:c}),b.update(forge.util.createBuffer(a)),b.finish(),KJUR.jws.JWS.readSafeJSONString(b.output.data)}catch(a){return log.debug("Postman.prototype.decryptHandshake",a),null}},Postman.prototype.decryptMsgBody=function(a){try{var b=contactsHandler.getContactById(a.from);if("undefined"==typeof b||null==b.decryptionKeys)return postman.send("KeysRequest",{from:user.publicClientID,to:b.publicClientID}),mailBox.storeMessage(a),null;var c=b.decryptionKeys[parseInt(a.messageBody.index4iv)],d=b.decryptionKeys[parseInt(a.messageBody.index4Key)],e=forge.cipher.createDecipher("AES-CBC",d);return e.start({iv:c}),e.update(forge.util.createBuffer(a.messageBody.encryptedMsg)),e.finish(),KJUR.jws.JWS.readSafeJSONString(e.output.data)}catch(a){return log.debug("Postman.prototype.decryptMsgBody",a),null}},Postman.prototype.getParameterByName=function(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},Postman.prototype.getListOfHeaders=function(a){try{var b=Postman.prototype.decrypt(a).list;if(0==Array.isArray(b))return null;for(var c=0;c<b.length;c++)if("string"!=typeof b[c].msgID||"number"!=typeof b[c].size||2!=Object.keys(b[c]).length)return null;return b}catch(a){return null}},Postman.prototype.getPlanImgFromServer=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||0==Postman.prototype._isUUID(b.planId)||"string"!=typeof b.imgsrc||2!=Object.keys(b).length?(log.debug("getPlanImgFromServer - type check",b),null):b}catch(a){return log.debug("getPlanImgFromServer - type check",a),null}},Postman.prototype.getPlansAround=function(a){try{var b=Postman.prototype.decrypt(a).list;if(0==Array.isArray(b))return null;for(var c=0;c<b.length;c++)if(0==Postman.prototype._isUUID(b[c].planId)||0==Postman.prototype._isUUID(b[c].organizer)||"string"!=typeof b[c].nickName||"string"!=typeof b[c].commentary||"string"!=typeof b[c].location.lat||"string"!=typeof b[c].location.lon||2!=Object.keys(b[c].location).length||"string"!=typeof b[c].meetingInitDate||"string"!=typeof b[c].meetingInitTime.hour||"string"!=typeof b[c].meetingInitTime.mins||2!=Object.keys(b[c].meetingInitTime).length)return log.debug(b[c]),null;return b}catch(a){return null}},Postman.prototype.getProcessNewContacts=function(a){try{var b=Postman.prototype.decrypt(a).list;if(0==Array.isArray(b))return log.debug("Postman.prototype.getProcessNewContacts - type check 1",b),null;for(var c=0;c<b.length;c++)if("string"!=typeof b[c].publicClientID||"string"!=typeof b[c].nickName&&null!=b[c].nickName||"string"!=typeof b[c].commentary&&null!=b[c].commentary||"object"!=typeof b[c].location||"string"!=typeof b[c].pubKeyPEM||5!=Object.keys(b[c]).length)return log.debug("Postman.prototype.getProcessNewContacts - type check 2",b),null;return b}catch(a){return log.debug("Postman.prototype.getProcessNewContacts - type check 3",b),null}},Postman.prototype.getDeliveryReceipt=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||"string"!=typeof b.msgID||"string"!=typeof b.typeOfACK||"string"!=typeof b.to||3!=Object.keys(b).length?null:b}catch(a){return log.debug("Postman.prototype.getDeliveryReceipt",a),null}},Postman.prototype.getProfileRequest=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||"number"!=typeof b.lastProfileUpdate||1!=Object.keys(b).length?(log.debug("Postman.prototype.getProfileRequest - type check",b),null):b}catch(a){return log.debug("Postman.prototype.getProfileRequest - type check",a),null}},Postman.prototype.getProfileFromServer=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||"string"!=typeof b.publicClientID||null==b.publicClientID||"string"!=typeof b.nickName||null==b.nickName||"string"!=typeof b.commentary||null==b.commentary||"string"!=typeof b.imgsrc||null==b.imgsrc||"string"!=typeof b.telephone||null==b.telephone||"string"!=typeof b.email||null==b.email?(log.debug("Postman.prototype.getProfileFromServer - type check",b),null):b}catch(a){return log.debug("Postman.prototype.getProfileFromServer - type check",a),null}},Postman.prototype.getLocationFromServer=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||"object"!=typeof b||"object"!=typeof b.coords?(log.debug("Postman.prototype.getLocationFromServer - type check",b),null):b}catch(a){return log.debug("Postman.prototype.getLocationFromServer - type check",a),null}},Postman.prototype.getKeysDelivery=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||0==Postman.prototype._isUUID(b.to)||0==Postman.prototype._isUUID(b.from)||"object"!=typeof b.setOfKeys||3!=Object.keys(b).length?(log.debug("Postman.prototype.getKeysDelivery - type check",b),null):b}catch(a){return log.debug("Postman.prototype.getKeysDelivery - type check",a),null}},Postman.prototype.getKeysRequest=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||0==Postman.prototype._isUUID(b.to)||0==Postman.prototype._isUUID(b.from)||2!=Object.keys(b).length?(log.debug("Postman.prototype.getKeysRequest - type check",b),null):b}catch(a){return log.debug("Postman.prototype.getKeysRequest - type check",a),null}},Postman.prototype.getMessageFromClient=function(a){try{if(a.messageBody=Postman.prototype.decryptMsgBody(a),null==a.messageBody||0==Postman.prototype._isUUID(a.to)||0==Postman.prototype._isUUID(a.from)||0==Postman.prototype._isUUID(a.msgID))return log.error("Postman.prototype.getMessageFromClient - type check",a),null;var b=new Message(a);return b.setACKfromServer(!0),b.setACKfromAddressee(!0),b}catch(a){return log.error("Postman.prototype.getMessageFromClient - type check",a),null}},Postman.prototype.getWhoIsOnline=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||0==Postman.prototype._isUUID(b.idWhoIsOnline)||1!=Object.keys(b).length?(log.debug("Postman.prototype.getWhoIsOnline - type check",b),null):b}catch(a){return log.debug("Postman.prototype.getWhoIsOnline - type check",a),null}},Postman.prototype.getWhoIsWriting=function(a){try{var b=Postman.prototype.decrypt(a);return null==b||0==Postman.prototype._isUUID(b.idWhoIsWriting)||0==Postman.prototype._isUUID(b.toWhoIsWriting)||2!=Object.keys(b).length?(log.debug("Postman.prototype.getWhoIsWriting - type check",b),null):b}catch(a){return log.debug("Postman.prototype.getWhoIsWriting - type check",a),null}},Postman.prototype.onMsgFromClient=function(a){var b=postman.getMessageFromClient(a);if(null!=b){var c={to:b.to,from:b.from,msgID:b.msgID,typeOfACK:"ACKfromAddressee"};if(postman.send("MessageDeliveryACK",c),"multimedia"==b.messageBody.messageType||"text"==b.messageBody.messageType||"inclusionRequest"==b.messageBody.messageType){var d;d=b.to!=b.chatWith?b.chatWith:b.from;var e=abstractHandler.getObjById(d);if("undefined"==typeof e)return;if(e.isBlocked)return;b.setChatWith(d),mailBox.storeMessage(b),app.currentChatWith==d?gui.showMsgInConversation(b,{isReverse:!1,withFX:!0}):(e.counterOfUnreadSMS++,gui.refreshCounterOfChat(e)),e.timeLastSMS=b.timestamp,e.lastMsgTruncated=b.getTruncatedMsg(),gui.setTimeLastSMS(e),abstractHandler.setOnList(e),abstractHandler.setOnDB(e),gui.showEntryOnMainPage(e,!1),gui.showLocalNotification(b),gui.showLastMsgTruncated(e)}else if("groupUpdate"==b.messageBody.messageType){var f=new Group(b.messageBody.group);groupsHandler.setGroupOnList(f),groupsHandler.setGroupOnDB(f),gui.showGroupsOnGroupMenu(),gui.showEntryOnMainPage(f,!1),f.listOfMembers.map(function(a){if(user.publicClientID!=a){var b=contactsHandler.getContactById(a);"undefined"!=typeof b&&null!=b||(b=new ContactOnKnet({publicClientID:a}),contactsHandler.setContactOnList(b),contactsHandler.setContactOnDB(b),contactsHandler.sendProfileRequest(b))}})}else if("req4call"==b.messageBody.messageType){if(easyrtc._isAmissedCall(b))return;app.currentChatWith=b.from;var g=function(){easyrtc._proccessCall(b)},h=function(){easyrtc._sendRejection2peer(b)};gui.showConferencePage(g,h),$("#callAcceptButton").show()}else if("res4call"==b.messageBody.messageType){if(easyrtc._isAmissedCall(b))return;if(null==b.messageBody.easyRTCid)return void easyrtc._releaseResources()}}},Postman.prototype.send=function(a,b){if("string"!=typeof a||"object"!=typeof b||null==b)return log.debug("Postman.prototype.send - type check",b),null;try{"undefined"!=typeof socket&&1==socket.connected&&socket.emit(a,Postman.prototype.encrypt(b))}catch(a){log.debug("Postman.prototype.send - type check",a)}},Postman.prototype.sendMsg=function(a){try{if(null==a.messageBody)return log.debug("Postman.prototype.sendMsg ::: type check failed"),void mailBox.removeMessage(a);var b=abstractHandler.getObjById(a.chatWith);b.timeLastSMS=a.timestamp,b.lastMsgTruncated=a.getTruncatedMsg(),gui.setTimeLastSMS(b),abstractHandler.setOnList(b),abstractHandler.setOnDB(b),gui.showEntryOnMainPage(b,!1),gui.showLastMsgTruncated(b);var c=[],d=groupsHandler.getMembersOfGroup(a.chatWith);d.length>0?d.map(function(b){if(user.publicClientID!=b){var d=new Message(a);d.to=b,c.push(d)}}):c.push(a),c.map(function(a){a.messageBody=postman.encryptMsgBody(a),"undefined"!=typeof socket&&1==socket.connected&&socket.emit("message2client",a)})}catch(a){log.debug("Postman.prototype.sendMsg",a)}},Postman.prototype.signToken=function(a){try{var b=JSON.stringify(a),c={alg:"HS512",typ:"JWT"},d=JSON.stringify(c),e="";return e=KJUR.jws.JWS.sign("HS512",d,b,app.symetricKey2use)}catch(a){return null}},GUI.prototype._parseLinks=function(a){var b={};b.mediaLinks=[];var c=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/g;return b.htmlOfContent=a.replace(c,function(a){var c=gui._testUrlForMedia(a);return c?b.mediaLinks.push(c):"http"!=a.substring(1,4)&&(a="http://"+a),"<a href='"+a+"'>"+a+"</a>"}),b},GUI.prototype._sanitize=function(a){var b,c="(?:[^\"'>]|\"[^\"]*\"|'[^']*')*",d=new RegExp("<(?:!--(?:(?:-*[^->])*--+|-?)|script\\b"+c+">[\\s\\S]*?</script\\s*|style\\b"+c+">[\\s\\S]*?</style\\s*|/?[a-z]"+c+")>","gi");do b=a,a=a.replace(d,"");while(a!==b);return a.replace(/</g,"&lt;")},GUI.prototype._sortChats=function(){var a=$("ul#listOfContactsInMainPage"),b=a.children("li");b.detach().sort(function(a,b){return parseInt($(a).data("sortby"))<parseInt($(b).data("sortby"))}),a.empty(),a.append(b),$("#listOfContactsInMainPage").listview().listview("refresh")},GUI.prototype._testUrlForMedia=function(a){var b=!1,c={},d=/https?:\/\/(?:www\.)?(?:(?:youtu\.be\/)|(?:(?:(?:youtube-nocookie\.com\/|youtube\.com\/|youtu\.be\/).*)(?:(?:v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))))([^#\&\?]*).*/,e=a.match(d);if(e)c.type="youtube",c.id=e[1].split(" ")[0],c.url=a,b=!0;else{var f=/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/,e=a.match(f);e&&(c.type="vimeo",c.id=e[3],c.url=a,b=!0)}return!!b&&c},GUI.prototype.bindButtonsOnMainPage=function(){(app.isMobile&&app.devicePlatform.indexOf("iOS")>-1||$.browser.ipad||$.browser.iphone||$.browser.ipod||app.isMobile&&("WinCE"==app.devicePlatform||"Win32NT"==app.devicePlatform))&&($("#link2activateAccount").remove().trigger("updatelayout"),$("#mypanel-list").listview().listview("refresh"),$("#mypanel").trigger("updatelayout")),$("#link2panel").on("click",function(){$("#mypanel").panel("open")}),$(".button2mainPage").on("click",function(){$("body").pagecontainer("change","#MainPage",{transition:"none"})}),$("#mapButtonInMainPage").on("click",function(){""!=app.myPosition.coords.latitude&&$("body").pagecontainer("change","#map-page",{transition:"none"})})},GUI.prototype.bindDOMevents=function(){function a(){window.history.forward()}window.onload=a(),window.onpageshow=function(b){b.persisted&&a()},$("body").on("pagecontainertransition",function(a,b){if("#MainPage"==b.options.target?($("#chat-page-content").empty(),$("#ProfileOfContact-page").empty(),app.currentChatWith=null,gui.listOfImages4Gallery=null,gui.listOfImages4Gallery=[],gui.indexOfImages4Gallery=0,gui.onProfileUpdate(),$.mobile.silentScroll(0),"WinCE"==app.devicePlatform||"Win32NT"==app.devicePlatform?document.removeEventListener("backbutton",gui.onBackButton,!1):document.addEventListener("backbutton",gui.onBackButton,!1)):document.addEventListener("backbutton",gui.onBackButton,!1),"#map-page"==b.options.target&&gui.loadMaps(),"#ProfileOfContact-page"==b.options.target,"#chat-page"==b.options.target&&$("#ProfileOfContact-page").remove(),"#profile"==b.options.target&&gui.loadProfile(),"#createGroup"==b.options.target&&gui.loadGroupMenu(),"#forwardMenu"==b.options.target&&gui.loadTargetsOnForwardMenu(),"#searchPage"==b.options.target&&gui.loadMapSearch(),"#searchResultsPage"==b.options.target){$("#listInResultsPage").empty();var c=gui.searchMap.currentMarker,d=c.getLatLng();app.sendRequest4Neighbours(d),app.sendRequest4Plans(d),gui.loadMapPlanPage("mapResultPage")}"#createPlanPage"==b.options.target&&(gui.loadGroupInPlanPage(),gui.loadImgPkrInPlanPage(),gui.loadMapPlanPage("mapPlanPage"),gui.loadDatePkrInPlanPage()),gui.hideLoadingSpinner()}),$(document).on("pageshow","#emoticons",function(a){$("#chat-input").emojiPicker("toggle")}),$(document).on("pageshow","#chat-page",function(a,b){$.mobile.silentScroll($(document).height()),$("#chat-input").emojiPicker("hide"),"emoticons"==b.prevPage.attr("id")&&$("#chat-input").focus()}),$(document).on("pageshow","#profile",function(a){""==user.myCurrentNick?$("#nickNameInProfile").html(user.publicClientID):$("#nickNameInProfile").html(user.myCurrentNick),$("#profileNameField").val(user.myCurrentNick),$("#commentaryInProfile").html(user.myCommentary),$("#profileCommentary").val(user.myCommentary),$("#profileTelephone").val(user.myTelephone),$("#profileEmail").val(user.myEmail),$("#flip-visible").val(user.visibility).slider("refresh"),$("#label_id_profile").html("&#x1F511; "+user.publicClientID)}),$("#chat-input").css({width:.7*$(window).width(),height:54}).emojiPicker({width:$(window).width(),height:$(window).height(),button:!1}).on("input",function(){var a=$("#chat-input").val();""==a?($("#chat-multimedia-image").attr("src","res/multimedia_50x37.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showImagePic)):($("#chat-multimedia-image").attr("src","res/smile_50x37.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showEmojis))}).keyup(function(a){13==a.keyCode&&gui.onChatInput();var b=(new Date).getTime(),c=parseInt($(a.target).data("lastkeyup"));if(b-5*config.TIME_FADE_WRITING>c){$(a.target).data("lastkeyup",b);var d=[],e=groupsHandler.getMembersOfGroup(app.currentChatWith);e.length>0?e.map(function(a){user.publicClientID!=a&&d.push(a)}):d.push(app.currentChatWith);var f={idWhoIsWriting:user.publicClientID,toWhoIsWriting:app.currentChatWith,listOfReceivers:d};postman.send("WhoIsWriting",f)}}).focus(function(){$("#chat-multimedia-image").attr("src","res/smile_50x37.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showEmojis)}).click(function(){$("#chat-multimedia-image").attr("src","res/smile_50x37.png"),$("#chat-multimedia-button").unbind().bind("click",gui.showEmojis)}),$("#chat-multimedia-button").bind("click",gui.showImagePic),$(".backButton").on("click",function(){gui.onBackButton()}),$("#nickNameInProfile").on("click",function(){$("#profileNameField").focus()}),$("#profileNameField").on("input",function(){user.myCurrentNick=$("#profileNameField").val(),$("#nickNameInProfile").text(user.myCurrentNick),app.profileIsChanged=!0}).on("focus",function(){user.myCurrentNick==user.publicClientID&&($("#nickNameInProfile").html(""),$("#profileNameField").val(""))}),$("#commentaryInProfile").on("click",function(){$("#profileCommentary").focus()}),$("#profileCommentary").on("input",function(){user.myCommentary=$("#profileCommentary").val(),$("#commentaryInProfile").text(user.myCommentary),app.profileIsChanged=!0}),$("#nickNameGroup").on("click",function(){$("#nickNameGroupField").focus()}),$("#nickNameGroupField").on("input",function(){gui.groupOnMenu.nickName=$("#nickNameGroupField").val(),$("#nickNameGroup").text(gui.groupOnMenu.nickName)}).on("focus",function(){dictionary.Literals.label_23==$("#nickNameGroupField").val()&&($("#nickNameGroup").html(""),$("#nickNameGroupField").val(""))}),$("#commentaryGroup").on("click",function(){$("#commentaryGroupField").focus()}),$("#commentaryGroupField").on("input",function(){gui.groupOnMenu.commentary=$("#commentaryGroupField").val(),$("#commentaryGroup").text(gui.groupOnMenu.commentary)}).on("focus",function(){dictionary.Literals.label_12==$("#commentaryGroupField").val()&&($("#commentaryGroup").html(""),$("#commentaryGroupField").val(""))}),$("#nickNamePlan").on("click",function(){$("#nickNamePlanField").focus()}),$("#nickNamePlanField").on("input",function(){gui.groupOnMenu.nickName=$("#nickNamePlanField").val(),$("#nickNamePlan").text(gui.groupOnMenu.nickName)}).on("focus",function(){dictionary.Literals.label_23==$("#nickNamePlanField").val()&&($("#nickNamePlan").html(""),$("#nickNamePlanField").val(""))}),$("#commentaryPlan").on("click",function(){$("#commentaryPlanField").focus()}),$("#commentaryPlanField").on("input",function(){gui.groupOnMenu.commentary=$("#commentaryPlanField").val(),$("#commentaryPlan").text(gui.groupOnMenu.commentary)}).on("focus",function(){dictionary.Literals.label_12==$("#commentaryPlanField").val()&&($("#commentaryPlan").html(""),$("#commentaryPlanField").val(""))}),$("#profileTelephone").on("input",function(){user.myTelephone=$("#profileTelephone").val(),app.profileIsChanged=!0}),$("#profileEmail").on("input",function(){user.myEmail=$("#profileEmail").val(),app.profileIsChanged=!0}),$("#flip-visible").on("change",function(){user.visibility=$("#flip-visible").val(),app.profileIsChanged=!0}),$("#mapButtonInChatPage").on("click",function(){""!=app.myPosition.coords.latitude&&gui.photoGalleryClosed&&$("body").pagecontainer("change","#map-page",{transition:"none"})}),$("#buyButton").on("click",app.onProcessPayment),$("input[name='license-choice']").on("change",gui.refreshPurchasePrice),$("#NGOdonation").on("change",gui.refreshPurchasePrice),$("#FSIdonation").on("change",gui.refreshPurchasePrice),$("#groupsButton").on("click",gui.onGroupsButton).text(dictionary.Literals.label_38).data("action","create"),$(window).on("debouncedresize",function(a){$("#chat-input").css({width:.7*$(window).width(),height:54}).emojiPicker("reset")}),$("#link2profileOfContact").bind("click",function(){gui.showProfile()}),app.events.documentReady.resolve(),$("input, textarea").off("touchstart mousedown").on("touchstart mousedown",function(a){a.stopPropagation()}),$("#label_60").on("click",function(){gui.showTermsAndConditions()}),$("#label_65").unbind("click").bind("click",function(){$("body").pagecontainer("change","#createPlanPage",{transition:"none"})}),$("#label_66").unbind("click").bind("click",function(){$("body").pagecontainer("change","#searchResultsPage",{transition:"none"})}),$("#planSubmitButton").on("click",gui.onPlanSubmit).text(dictionary.Literals.label_38).data("action","create"),history.pushState(null,null,null),window.addEventListener("popstate",function(a){history.pushState(null,null,null)}),$("#performCall").on("click",function(){easyrtc._peerRequest4aCall()})},GUI.prototype.bindPagination=function(a){var b='<button id="paginationButton">'+dictionary.Literals.label_41+"</button>";$("#chat-page-content").prepend(b).trigger("create"),$("#paginationButton").unbind("click").bind("click",function(){gui.showLoadingSpinner(),$("#paginationButton").remove(),mailBox.retrieveMessages(app.currentChatWith,a).done(function(a){a.map(function(a){gui.showMsgInConversation(a,{isReverse:!0,withFX:!1})}),gui.hideLoadingSpinner();var b=a.length;b==config.MAX_SMS_RETRIEVAL&&gui.bindPagination(a[b-1].timestamp)}),gui.hideLoadingSpinner()})},GUI.prototype.forwardMsg=function(a){mailBox.getMessageByID(app.msg2forward).done(function(b){return"undefined"==typeof b||null==b?void logger.debug("GUI.prototype.forwardMsg - ",b):void app.forwardMsg(b,a)}),$("body").pagecontainer("change","#chat-page",{transition:"none"})},GUI.prototype.getPurchaseDetails=function(){var a={};return a.licenseDurationChoosen=$("input[name='license-choice']:checked").val(),a.isNGOdonationChecked=$("#NGOdonation").is(":checked"),a.isFSIdonationChecked=$("#FSIdonation").is(":checked"),a},GUI.prototype.hideLoadingSpinner=function(){$(".mask-color").fadeOut("fast")},GUI.prototype.hideLocalNotifications=function(){app.isMobile&&"Android"==app.devicePlatform&&cordova.plugins.notification.local.clearAll(function(){log.info("GUI.prototype.hideLocalNotifications - notification cleared")},this)},GUI.prototype.loadAsideMenuMainPage=function(){var a="";a+='<div data-role="panel" id="mypanel" data-display="overlay">',a+='  <ul id="mypanel-list" data-role="listview" data-inset="true" data-divider-theme="b">',a+='\t\t<li id="link2profile" data-icon="false">',a+="\t\t\t<a>",a+='\t\t\t\t<img src="res/profile_black_195x195.png" >',a+='\t\t\t\t<h2 id="label_1">Profile</h2>',a+="\t\t\t</a>",a+="\t\t</li>",a+='\t\t<li id="link2createGroup" data-icon="false">',a+="\t\t\t<a>",a+='\t\t\t\t<img src="res/group_black_195x195.png" >',a+='\t\t\t\t<h2 id="label_2" >Groups</h2>',a+="\t\t\t</a>",a+="\t\t</li>",a+='\t\t<li id="link2searchPage" data-icon="false">',a+="\t\t\t<a>",a+='\t\t\t\t<img src="res/visibles_black_195x195.png" >',a+='\t\t\t\t<h2 id="label_3">Search</h2>',a+="\t\t\t</a>",a+="\t\t</li>",a+='\t\t<li id="link2activateAccount" data-icon="false">',a+="\t\t\t<a>",a+='\t\t\t\t<img src="res/account_black_195x195.png" >',a+='\t\t\t\t<h2 id="label_4">Account</h2>',a+="\t\t\t</a>",a+="\t\t</li>",a+="  </ul>",a+="</div><!-- /panel -->",$("#MainPage").append(a),$("#link2profile").click(function(){$("body").pagecontainer("change","#profile",{transition:"none"})}),$("#link2createGroup").click(function(){$("body").pagecontainer("change","#createGroup",{transition:"none"})}),$("#link2searchPage").click(function(){""!=app.myPosition.coords.latitude&&$("body").pagecontainer("change","#searchPage",{transition:"none"})}),$("#link2activateAccount").click(function(){$("body").pagecontainer("change","#activateAccount",{transition:"none"})}),$("#MainPage").trigger("create")},GUI.prototype.loadBody=function(){var a="";a+=' \t<div data-role="page" data-theme="a" id="searchPage">',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t  <div class="ui-grid-d" >',a+='\t\t\t    <div class="ui-block-a">',a+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',
a+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',a+="\t\t    \t\t</a>",a+="\t    \t\t</div>",a+='\t\t\t    <div class="ui-block-b"></div>',a+='\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t    <div class="ui-block-d"></div>',a+='\t\t\t    <div class="ui-block-e"></div>',a+="\t\t\t  </div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div role="main" id="searchMap" >',a+="\t\t        \t<!-- map loads here...  -->",a+="\t\t  \t</div>",a+='\t\t\t<div data-role="content" data-theme="a">',a+=' \t\t\t<a id="label_65" class="ui-btn ui-corner-all ui-shadow ui-btn-b" > create a plan</a>',a+=' \t\t\t<a id="label_66" class="ui-btn ui-corner-all ui-shadow ui-btn-b" > find people or join a plan </a>',a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page searchPage-->",a+=' \t<div data-role="page" data-theme="a" id="createPlanPage">',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t  <div class="ui-grid-d" >',a+='\t\t\t    <div class="ui-block-a">',a+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',a+="\t\t    \t\t</a>",a+="\t\t    \t</div>",a+='\t\t\t    <div class="ui-block-b"></div>',a+='\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t    <div class="ui-block-d"></div>',a+='\t\t\t    <div class="ui-block-e"></div>',a+="\t\t\t  </div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div data-role="content" data-theme="a"> ',a+='\t\t\t\t<div class="container" id="main">',a+='\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="sidebar">',a+='\t\t\t\t\t\t\t\t<div class="user">',a+='\t\t\t\t\t\t\t\t\t<div id="imagePlanContainer" class="text-center" data-role="none" >',a+='\t\t\t\t\t\t\t\t\t\t<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="image4Plan" class="picedit_box">',a+="\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t<div class="user-head">',a+='\t\t\t\t\t\t\t\t\t\t<h1  id="nickNamePlan" ></h1>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',a+='\t\t\t\t\t\t\t\t\t\t<h5 id="commentaryPlan" ></h5>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',a+="\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="content">',a+='\t\t\t\t\t\t\t\t<div class="main-content">',a+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',a+='\t\t\t\t\t\t\t\t\t\t<h1 id="label_72"> Plan </h1>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-left"></div>',a+="\t\t\t\t\t\t\t\t\t\t<p></p>",a+='\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="nickNamePlanField" class="form-control input-lg" placeholder="Name..."> ',a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<textarea id="commentaryPlanField" class="form-control input-lg" placeholder="Description..."> </textarea>',a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t          \t\t\t\t<div id="mapPlanPage" class="mapPlanPage">',a+="\t\t\t\t\t          \t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t\t\t\t<p></p>",a+="\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_70" data-role="none"  class="myDatePicker form-control input-lg " placeholder=""> ',a+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_71" data-role="none"  class="form-control input-lg myTimePicker" placeholder=""> ',a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t<button id="planSubmitButton">create</button>',a+="\t\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+="\t\t\t\t\t</div>",a+="\t\t\t\t</div>",a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page createPlanPage-->",a+=' \t<div data-role="page" data-theme="a" id="searchResultsPage">',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t  <div class="ui-grid-d" >',a+='\t\t\t    <div class="ui-block-a">',a+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',a+="\t\t    \t\t</a>",a+="\t\t    \t</div>",a+='\t\t\t    <div class="ui-block-b"></div>',a+='\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t    <div class="ui-block-d"></div>',a+='\t\t\t    <div class="ui-block-e"></div>',a+="\t\t\t  </div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div data-role="content" data-theme="a"> ',a+='\t\t\t\t<div class="container" id="main">',a+='\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="sidebar">',a+='\t\t\t\t\t\t\t\t<div class="user">',a+='\t\t\t\t\t          \t\t<div id="mapResultPage" class="mapPlanPage">',a+="\t\t\t\t\t          \t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="content">',a+='\t\t\t\t\t\t\t\t<div class="main-content">',a+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',a+='\t\t\t\t\t\t\t\t\t\t<ul id="listInResultsPage" data-role="listview" data-inset="true" data-divider-theme="b">',a+="\t\t\t\t\t\t\t\t\t\t</ul>",a+="\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+="\t\t\t\t\t</div>",a+="\t\t\t\t</div>",a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page searchResultsPage-->",a+='\t\t<div data-role="page" data-theme="a" id="createGroup">',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t  <div class="ui-grid-d" >',a+='\t\t\t    <div class="ui-block-a">',a+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',a+="\t\t    \t\t</a>",a+="\t\t    \t</div>",a+='\t\t\t    <div class="ui-block-b"></div>',a+='\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t    <div class="ui-block-d"></div>',a+='\t\t\t    <div class="ui-block-e"></div>',a+="\t\t\t  </div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div data-role="content" data-theme="a"> ',a+='\t\t\t\t<div class="container" id="main">',a+='\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="sidebar">',a+='\t\t\t\t\t\t\t\t<div class="user">',a+='\t\t\t\t\t\t\t\t\t<div id="imageGroupContainer" class="text-center" data-role="none" >',a+='\t\t\t\t\t\t\t\t\t\t<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="imageGroup" class="picedit_box">',a+="\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t<div class="user-head">',a+='\t\t\t\t\t\t\t\t\t\t<h1  id="nickNameGroup" ></h1>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',a+='\t\t\t\t\t\t\t\t\t\t<h5 id="commentaryGroup" ></h5>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',a+="\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="content">',a+='\t\t\t\t\t\t\t\t<div class="main-content">',a+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',a+='\t\t\t\t\t\t\t\t\t\t<h1 id="label_21">New Group</h1>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-left"></div>',a+="\t\t\t\t\t\t\t\t\t\t<p></p>",a+='\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="nickNameGroupField" class="form-control input-lg" placeholder="Name..."> ',a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="commentaryGroupField" class="form-control input-lg" placeholder="Commentary...">',a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t<button id="groupsButton">create</button>',a+="\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t<ul id="contacts4Group" data-role="listview" data-inset="true" data-divider-theme="a"></ul>',a+='\t\t\t\t\t\t\t\t\t\t\t<h1 id="label_37">My Groups</h1>',a+='\t\t\t\t\t\t\t\t\t\t\t<ul id="listOfGroups" data-role="listview" data-inset="true" data-divider-theme="a"></ul>',a+='\t\t\t\t\t\t\t\t\t\t\t<h1 id="label_52">Blocked people</h1>',a+='\t\t\t\t\t\t\t\t\t\t\t<ul id="listOfBlocked" data-role="listview" data-inset="true" data-divider-theme="a"></ul>',a+="\t\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+="\t\t\t\t\t</div>",a+="\t\t\t\t</div>",a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page createGroup-->",a+='\t\t<div data-role="page" data-theme="a" id="profile">',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t  <div class="ui-grid-d" >',a+='\t\t\t    <div class="ui-block-a">',a+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',a+="\t\t    \t\t</a>",a+="\t    \t\t</div>",a+='\t\t\t    <div class="ui-block-b"></div>';a+='\t\t\t    <div class="ui-block-c"></div>';a+='\t\t\t    <div class="ui-block-d"></div>',a+='\t\t\t    <div class="ui-block-e"></div>',a+="\t\t\t  </div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div data-role="content" data-theme="a">',a+='\t\t\t\t<div class="container" id="main">',a+='\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="sidebar">',a+='\t\t\t\t\t\t\t\t<div class="user">',a+='\t\t\t\t\t\t\t\t\t<div class="text-center" data-role="none" >',a+='\t\t\t\t\t\t\t\t\t\t<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="imageProfile" class="picedit_box">',a+="\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t<div class="user-head">',a+='\t\t\t\t\t\t\t\t\t\t<h1  id="nickNameInProfile" ></h1>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',a+='\t\t\t\t\t\t\t\t\t\t<h5 id="commentaryInProfile" ></h5>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',a+="\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',a+='\t\t\t\t\t\t\t<div id="content">',a+='\t\t\t\t\t\t\t\t<div class="main-content">',a+='\t\t\t\t\t\t\t\t\t<div class="timeline-panel">',a+='\t\t\t\t\t\t\t\t\t\t<h1 id="label_22">Profile</h1>',a+='\t\t\t\t\t\t\t\t\t\t<div class="hr-left"></div>',a+="\t\t\t\t\t\t\t\t\t\t<p></p>",a+='\t\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileNameField" class="form-control input-lg" placeholder="Name..."> ',a+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileCommentary" class="form-control input-lg" placeholder="Commentary...">',a+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileTelephone" class="form-control input-lg" placeholder="telephone...">',a+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',a+='\t\t\t\t\t\t\t\t\t\t\t\t\t<input id="profileEmail" class="form-control input-lg" placeholder="e-mail...">',a+="\t\t\t\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<h2 id="label_8"> you visible for...</h2>',a+='\t\t\t\t\t\t\t\t\t\t\t\t<h3 id="label_9">Anybody</h3>',a+='\t\t\t\t\t\t\t\t\t\t\t\t<p id="label_10">should you switch this off, then only your contacts would see you online, is not that boring?</p>\t',a+='\t\t\t\t\t\t\t\t\t\t\t\t<select name="flip-visible" id="flip-visible" data-role="slider" >',a+='\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="on">on</option>',a+='\t\t\t\t\t\t\t\t\t\t\t\t\t<option value="off">off</option>',a+="\t\t\t\t\t\t\t\t\t\t\t\t</select>",a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t\t\t\t\t\t<div class="row">',a+='\t\t\t\t\t\t\t\t\t\t\t\t<a><h2 id="label_60"> Privacy Policy</h2></a>',a+="\t\t\t\t\t\t\t\t\t\t\t</div>",a+='\t\t\t\t\t\t          \t\t\t<div class="col-md-12">',a+='\t\t\t\t\t    \t      \t\t\t\t<abbr title="id" id="label_id_profile">  </abbr> ',a+="\t\t\t\t\t        \t  \t\t\t</div>",a+="\t\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t\t</div>",a+="\t\t\t\t\t\t</div>",a+="\t\t\t\t\t</div>",a+="\t\t\t\t</div>",a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page profile-->",a+='\t\t<div data-role="page" data-cache="false" id="map-page" data-url="map-page">',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t  <div class="ui-grid-d" >',a+='\t\t\t    <div class="ui-block-a">',a+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',a+="\t\t    \t\t</a> ",a+="\t    \t\t</div>",a+='\t\t\t    <div class="ui-block-b"></div>',a+='\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t    <div class="ui-block-e"><a data-role="button" class="ui-nodisc-icon icon-list"><img src="res/bubble_36x36.png" class="button2mainPage button ui-li-icon ui-corner-none "></a></div>',a+='\t\t\t    <div class="ui-block-e"><a id="mapButtonInmap-page" data-role="button" class="ui-nodisc-icon icon-list"><img src="res/mundo_36x36.png" class="ui-li-icon ui-corner-none "></a></div>',a+="\t\t\t  </div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div role="main" id="map-canvas" >',a+="\t\t        \t<!-- map loads here...  -->",a+="\t\t  \t</div>",a+='\t\t\t<div data-role="content" data-theme="a">',a+='\t\t\t\t<ul id="listOfContactsInMapPage" data-role="listview" data-inset="true" data-divider-theme="b">',a+="\t\t\t\t</ul>",a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page map-page-->",a+='\t\t<div data-role="page" id="chat-page" data-url="chat-page" >',a+='\t\t\t<div id="chat-page-header" data-role="header" data-position="fixed">',a+='\t\t\t\t<div class="ui-grid-d">',a+='\t\t\t\t\t<div class="ui-block-a"><a data-role="button" class="backButton ui-nodisc-icon icon-list"><img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none "></a></div>',a+='\t\t\t\t    <div class="ui-block-b">',a+='\t\t\t\t\t   \t<a id="link2profileOfContact" data-role="button" class="imgOfChat-page" data-inline="false">',a+='\t\t\t\t       \t\t<img id="imgOfChat-page-header" src="" class="imgOfChat-page-header">',a+="\t\t\t\t   \t\t</a>",a+="\t\t\t       \t</div>",a+='\t\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t\t    <div id="performCall" class="ui-block-d"><a data-role="button" class="ui-nodisc-icon icon-list"><img src="res/conference.png" alt="lists" class="button ui-li-icon ui-corner-none max-nav-button"></a></div>',a+='\t\t\t\t    <div class="ui-block-e"><a id="mapButtonInChatPage" data-role="button" class="ui-nodisc-icon icon-list"><img src="res/mundo_36x36.png" alt="lists" class="ui-li-icon ui-corner-none "></a></div>',a+="\t\t\t  \t</div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div id="chat-page-content" role="main" class="ui-content">',a+="\t\t\t</div><!-- /content -->",a+='\t\t\t<div data-role="footer" data-position="fixed">\t\t\t\t',a+='\t\t\t\t<div id="chat-multimedia-button" class="ui-block-20percent" >\t\t\t\t\t',a+='\t\t\t\t\t<a data-role="button" ><img id="chat-multimedia-image" src="res/multimedia_50x37.png"> </a>',a+="\t\t\t\t </div>",a+='\t\t\t\t<div class="ui-block-80percent">\t\t\t\t\t\t\t',a+='\t\t\t\t\t<textarea data-role="none" id="chat-input" data-lastkeyup="0" class="textarea-chat ui-input-text ui-body-inherit ui-textinput-autogrow"> </textarea> \t\t\t\t   \t\t\t\t\t\t\t\t',a+="\t\t\t\t</div>",a+="\t\t\t</div><!-- /footer -->",a+="\t\t</div><!-- /page chat-page-->\t\t",a+='\t\t<div data-role="page" id="activateAccount" data-url="activateAccount" >',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t\t<div class="ui-grid-d">',a+='\t\t\t\t\t<div class="ui-block-a"><a data-role="button" class="backButton ui-nodisc-icon icon-list"><img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none "></a></div>',a+='\t\t\t\t    <div class="ui-block-b"></div>',a+='\t\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t\t    <div class="ui-block-d"></div>',a+='\t\t\t\t    <div class="ui-block-e"></div>',a+="\t\t\t  \t</div>",a+="\t\t\t</div><!-- /header -->",a+='\t\t\t<div id="activateAccount-content" role="main" class="ui-content">',a+='\t\t\t\t<h1 id="label_27" class="darkink"> User account Activation  </h1>          ',a+='\t\t\t\t<div class="ui-field-contain">',a+='    \t\t\t\t<fieldset data-role="controlgroup">',a+='        \t\t\t\t<input type="radio" name="license-choice" id="radio-choice-v-1a" value="oneYear" checked="checked">',a+='        \t\t\t\t<label id="label_28" for="radio-choice-v-1a">License valid for a year</label>',a+='        \t\t\t\t<input type="radio" name="license-choice" id="radio-choice-v-1b" value="fourYears">',a+='        \t\t\t\t<label id="label_29" for="radio-choice-v-1b">License valid for 4 years</label>',a+='        \t\t\t\t<input type="checkbox" name="NGOdonation" id="NGOdonation">',a+='        \t\t\t\t<label id="label_31" for="NGOdonation">Donation for associated NGOs</label>',a+='        \t\t\t\t<input type="checkbox" name="FSIdonation" id="FSIdonation">',a+='        \t\t\t\t<label id="label_32" for="FSIdonation">Donation for our Open Source Initiative</label>',a+="    \t\t\t\t</fieldset>",a+="\t\t\t\t</div>",a+='\t\t\t\t<h3 class="darkink"> <spam id="label_33"> Total :</spam> <spam id="price"> 1 &euro;</spam></h3>',a+='\t\t\t\t<button id="buyButton">Buy</button>',a+='\t\t\t\t<div class="paypalButton"><img id="paypal" src="res/AM_mc_vs_dc_ae.jpg" ></div>',a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /activateAccount page-->",a+='\t\t<div data-role="page" data-theme="a" id="emoticons">',a+='\t\t\t<div role="main" class="ui-content">',a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page emoticons-->",a+='\t\t<div data-role="page" data-theme="a" id="multimedia">',a+='\t\t\t<div id="multimedia-content" role="main" class="ui-content">',a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page emoticons-->",a+='\t\t<div data-role="page" data-theme="a" id="forwardMenu">',a+='\t\t\t<div data-role="header" data-position="fixed">',a+='\t\t\t  <div class="ui-grid-d" >',a+='\t\t\t    <div class="ui-block-a">',a+='\t\t\t    \t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',a+="\t\t    \t\t</a>",a+="\t    \t\t</div>",a+='\t\t\t    <div class="ui-block-b"></div>',a+='\t\t\t    <div class="ui-block-c"></div>',a+='\t\t\t    <div class="ui-block-d"></div>',a+='\t\t\t    <div class="ui-block-e"></div>',a+="\t\t\t  </div>",a+="\t\t\t</div><!-- /header --> \t",a+='\t\t\t<div data-role="content" data-theme="a">',a+='\t\t\t\t<div class="container" id="forwardMenuContainer">',a+="\t\t\t\t</div><!-- /container-->",a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page forwardMenu-->",a+='\t\t<div data-role="page" data-theme="a" id="conference-page" > ',a+='\t\t\t<div  data-theme="a"  class="ui-height-100percent">',a+='\t\t\t\t<div class="ui-height-70percent">',a+='\t\t\t\t\t<video id="conferenceTag" class="video-center"></video>',a+="\t\t\t\t </div>",a+='\t\t\t\t<div class="conferenceCallBox">',a+='\t\t\t    \t<a id="callAcceptButton" data-role="button" class="ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/conference_play.png" alt="lists" class="button ui-li-icon ui-corner-none max-nav-button">',a+="\t\t    \t\t</a>",a+='\t\t\t    \t<a id="callRejectButton" data-role="button" class="ui-nodisc-icon icon-list">',a+='\t\t\t    \t\t<img src="res/conference_stop.png" alt="lists" class="button ui-li-icon ui-corner-none max-nav-button">',a+="\t\t    \t\t</a>",a+="\t\t\t\t</div>",a+="\t\t\t</div><!-- /content -->",a+="\t\t</div><!-- /page forwardMenu-->",$("body").append(a)},GUI.prototype.loadContactsOnMapPage=function(){IDBKeyRange.only("publicClientID");db.transaction(["contacts"],"readonly").objectStore("contacts").openCursor(null,"nextunique").onsuccess=function(a){var b=a.target.result;b&&(gui.showContactOnMapPage(b.value),b.continue())}},GUI.prototype.loadDatePkrInPlanPage=function(){var a=Object.keys(dictionary.Literals.CLDR.main)[0],b=dictionary.Literals.CLDR.main[a].dates.calendars.gregorian.months.format.wide,c=dictionary.Literals.CLDR.main[a].dates.calendars.gregorian.months.format.abbreviated,d=dictionary.Literals.CLDR.main[a].dates.calendars.gregorian.days.format.wide,e=dictionary.Literals.CLDR.main[a].dates.calendars.gregorian.days.format.abbreviated,f={monthsFull:[b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12]],monthsShort:[c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12]],weekdaysFull:[d.sun,d.mon,d.tue,d.wed,d.thu,d.fri,d.sat],weekdaysShort:[e.sun,e.mon,e.tue,e.wed,e.thu,e.fri,e.sat],today:dictionary.Literals.label_67,clear:dictionary.Literals.label_68,close:dictionary.Literals.label_69,firstDay:1,formatSubmit:"yyyy/mm/dd",onOpen:function(){$("#imagePlanContainer").css("visibility","hidden"),$("#planSubmitButton").css("visibility","hidden")},onClose:function(){$("#imagePlanContainer").css("visibility","visible"),$("#planSubmitButton").css("visibility","visible")}},g=$(".myDatePicker").pickadate(f),h=g.pickadate("picker");h.set("select",new Date);var i=$("#label_71").pickatime({clear:dictionary.Literals.label_68,onOpen:function(){$("#imagePlanContainer").css("visibility","hidden"),$("#planSubmitButton").css("visibility","hidden")},onClose:function(){$("#imagePlanContainer").css("visibility","visible"),$("#planSubmitButton").css("visibility","visible")}}),h=i.pickatime("picker");h.set("select",new Date)},GUI.prototype.loadGalleryInDOM=function(){if("WinCE"!=app.devicePlatform&&"Win32NT"!=app.devicePlatform){$("#gallery").remove();var a="";a+='<div id="gallery" data-role="none" class="pswp" tabindex="-1" role="dialog" hidden>',a+='\t\t<div  data-role="none" class="pswp__bg"></div>',a+='\t\t<div data-role="none" class="pswp__scroll-wrap">',a+='\t\t\t<div data-role="none" class="pswp__container">',a+='\t\t\t\t<div data-role="none" class="pswp__item"></div>',a+='\t\t\t\t<div data-role="none" class="pswp__item"></div>',a+='\t\t\t\t<div data-role="none" class="pswp__item"></div>',a+="          </div>",a+='          <div data-role="none" class="pswp__ui pswp__ui--hidden">',a+='\t\t\t\t<div data-role="none" class="pswp__top-bar">',a+='\t\t\t\t\t<div data-role="none" class="pswp__counter"></div>',a+='\t\t\t\t<button data-role="none" class="pswp__button pswp__button--close" title="Close (Esc)"></button>',a+='\t\t\t\t<button data-role="none" class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>',a+='\t\t\t\t<button data-role="none" class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>',a+='\t\t\t\t<div class="pswp__preloader">',a+='\t\t\t\t\t<div class="pswp__preloader__icn">',a+='\t\t\t\t\t  <div class="pswp__preloader__cut">',a+='\t\t\t\t\t    <div class="pswp__preloader__donut"></div>',a+="\t\t\t\t\t  </div>",a+="\t\t\t\t\t</div>",a+="\t\t\t\t</div>",a+='            </div>\t<div class="pswp__loading-indicator"><div class="pswp__loading-indicator__line"></div></div> ',a+="\t        </div>",a+='            <button data-role="none" class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>',a+='            <button data-role="none" class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>',a+='            <div class="pswp__caption">',a+='              <div class="pswp__caption__center">',a+="              </div>",a+="            </div>",a+="          </div>",a+="        </div>",a+="    </div>";var b=$.mobile.activePage.attr("id");$("#"+b).append(a)}},GUI.prototype.loadGroupInPlanPage=function(){null==gui.groupOnMenu&&(gui.groupOnMenu=new Group({}),gui.groupOnMenu.addMember(user));var a=gui.searchMap.currentMarker,b=a.getLatLng();gui.groupOnMenu.location.lat=b.lat.toString(),gui.groupOnMenu.location.lon=b.lng.toString(),$("#commentaryPlanField").val(gui.groupOnMenu.commentary),$("#commentaryPlan").text(gui.groupOnMenu.commentary),$("#nickNamePlanField").val(gui.groupOnMenu.nickName),$("#nickNamePlan").text(gui.groupOnMenu.nickName),$("#planSubmitButton").on("click",gui.onPlanSubmit).text(dictionary.Literals.label_38).data("action","create")},GUI.prototype.loadImgPkrInPlanPage=function(){var a='<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="image4Plan" class="picedit_box">';$("#imagePlanContainer").empty().append(a),$("#image4Plan").picEdit({maxWidth:config.MAX_WIDTH_IMG_PROFILE,maxHeight:config.MAX_HEIGHT_IMG_PROFILE,minWidth:config.MIN_WIDTH_IMG_PROFILE,minHeight:config.MIN_HEIGHT_IMG_PROFILE,navToolsEnabled:!0,isMobile:app.isMobile,defaultImage:gui.groupOnMenu.imgsrc,imageUpdated:function(a){gui.groupOnMenu.imgsrc=a.src},onNativeCameraInit:app.onNativeCameraInit})},GUI.prototype.loadProfile=function(){var a=user.myPhotoPath;$("#imageProfile").picEdit({maxWidth:config.MAX_WIDTH_IMG_PROFILE,maxHeight:config.MAX_HEIGHT_IMG_PROFILE,minWidth:config.MIN_WIDTH_IMG_PROFILE,minHeight:config.MIN_HEIGHT_IMG_PROFILE,navToolsEnabled:!0,defaultImage:a,isMobile:app.isMobile,imageUpdated:function(a){user.myPhotoPath=a.src,user.lastProfileUpdate=(new Date).getTime(),app.profileIsChanged=!0},onNativeCameraInit:app.onNativeCameraInit})},GUI.prototype.loadGroupMenu=function(a){a?(gui.groupOnMenu=a,$("#groupsButton").text(dictionary.Literals.label_39).data("action","modify"),$("#label_21").text(dictionary.Literals.label_40)):(gui.groupOnMenu=new Group({}),gui.groupOnMenu.addMember(user),$("#label_21").text(dictionary.Literals.label_36),$("#groupsButton").text(dictionary.Literals.label_38).data("action","create")),$("#commentaryGroupField").val(gui.groupOnMenu.commentary),$("#commentaryGroup").text(gui.groupOnMenu.commentary),$("#nickNameGroupField").val(gui.groupOnMenu.nickName),$("#nickNameGroup").text(gui.groupOnMenu.nickName),gui.showContactsOnGroupMenu(),gui.showGroupsOnGroupMenu(),gui.showListOfBlocked();var b='<input data-role="none" type="file" accept="image/*;capture=camera" name="image" id="imageGroup" class="picedit_box">';$("#imageGroupContainer").empty().append(b),$("#imageGroup").picEdit({maxWidth:config.MAX_WIDTH_IMG_PROFILE,maxHeight:config.MAX_HEIGHT_IMG_PROFILE,minWidth:config.MIN_WIDTH_IMG_PROFILE,minHeight:config.MIN_HEIGHT_IMG_PROFILE,navToolsEnabled:!0,isMobile:app.isMobile,defaultImage:gui.groupOnMenu.imgsrc,imageUpdated:function(a){gui.groupOnMenu.imgsrc=a.src},onNativeCameraInit:app.onNativeCameraInit})},GUI.prototype.loadLoadingSpinner=function(){var a="";a+='<div class="mask-color">',a+='    <div id="preview-area">',a+='    <div class="spinner">',a+='      <div class="dot1"></div>',a+='      <div class="dot2"></div>',a+="    </div>",a+="</div>",a+="</div>",$("body").prepend(a),$(".mask-color").fadeOut("fast")},GUI.prototype.loadMaps=function(){null!=app.map&&(app.map.remove(),$("#listOfContactsInMapPage").empty()),app.map=L.map("map-canvas"),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(app.map),app.map.setView([app.myPosition.coords.latitude.toString(),app.myPosition.coords.longitude.toString()],14);var a=L.latLng(app.myPosition.coords.latitude,app.myPosition.coords.longitude);L.marker(a).addTo(app.map).bindPopup(dictionary.Literals.label_11).openPopup(),L.circle(a,200).addTo(app.map),app.map.addEventListener("load",gui.loadContactsOnMapPage())},GUI.prototype.loadMapOnProfile=function(a){var b;if(b=a?a:contactsHandler.getContactById(app.currentChatWith),"undefined"==typeof b)return void $("#mapProfile").remove();gui.mapOfContact=null,gui.mapOfContact=L.map("mapProfile"),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(gui.mapOfContact),gui.mapOfContact.setView([b.location.lat,b.location.lon],14);var c=L.latLng(b.location.lat,b.location.lon);L.marker(c).addTo(gui.mapOfContact).bindPopup(b.nickName),L.circle(c,200).addTo(gui.mapOfContact)},GUI.prototype.loadMapPlanPage=function(a){var b=gui.searchMap.currentMarker,c=b.getLatLng();null!=gui.searchMap&&gui.searchMap.remove(),gui.searchMap=null,gui.searchMap=L.map(a),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(gui.searchMap),gui.searchMap.setView(c,14),gui.searchMap.currentMarker=new L.marker(c).addTo(gui.searchMap).bindPopup(dictionary.Literals.label_64).openPopup(),gui.searchMap.currentCircle=new L.circle(c,1e3).addTo(gui.searchMap)},GUI.prototype.loadMapSearch=function(){null!=gui.searchMap&&gui.searchMap.remove(),gui.searchMap=null,gui.searchMap=L.map("searchMap"),L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> &copy; <a href="http://mapbox.com">Mapbox</a>',id:"instaltic.lbgoad0c",accessToken:"pk.eyJ1IjoiaW5zdGFsdGljIiwiYSI6IlJVZDVjMU0ifQ.8UXq-7cwuk4i7-Ri2HI3xg",trackResize:!0}).addTo(gui.searchMap),gui.searchMap.setView([app.myPosition.coords.latitude.toString(),app.myPosition.coords.longitude.toString()],11);var a=L.latLng(app.myPosition.coords.latitude,app.myPosition.coords.longitude);gui.searchMap.currentMarker=new L.marker(a).addTo(gui.searchMap).bindPopup(dictionary.Literals.label_64).openPopup(),gui.searchMap.currentCircle=new L.circle(a,5e3).addTo(gui.searchMap),gui.searchMap.on("click",function(a){gui.searchMap.removeLayer(gui.searchMap.currentMarker),gui.searchMap.removeLayer(gui.searchMap.currentCircle),gui.searchMap.currentMarker=new L.marker(a.latlng).addTo(gui.searchMap).bindPopup(dictionary.Literals.label_64).openPopup(),gui.searchMap.currentCircle=new L.circle(a.latlng,5e3).addTo(gui.searchMap)})},GUI.prototype.loadTargetsOnForwardMenu=function(){$("#forwardMenuContainer").empty();var a='<ul id="listOfContactsInForwardMenu" data-role="listview" data-inset="true" data-divider-theme="a"> </ul>';$("#forwardMenuContainer").append(a),$("#forwardMenuContainer").trigger("create");IDBKeyRange.only("publicClientID");db.transaction(["contacts"],"readonly").objectStore("contacts").openCursor(null,"nextunique").onsuccess=function(a){
var b=a.target.result;b&&(gui.showTargetOnForwardMenu(b.value),b.continue())};IDBKeyRange.only("publicClientID");db.transaction(["groups"],"readonly").objectStore("groups").openCursor(null,"nextunique").onsuccess=function(a){var b=a.target.result;if(b){var c=new Group(b.value);gui.showTargetOnForwardMenu(c),b.continue()}}},GUI.prototype.onAddContact2Group=function(a){gui.showAddContact2Group(a),gui.groupOnMenu.addMember(a)},GUI.prototype.onAppBrowserLoad=function(a){log.info("GUI.prototype.onAppBrowserLoad - begin"),null!==a.url.match("successPayment")&&(gui.inAppBrowser.removeEventListener("exit",gui.onAppBrowserExit),gui.inAppBrowser.removeEventListener("loadstop",gui.onAppBrowserLoad),app.transactionID=decodeURI(postman.getParameterByName("transactionID",a.url)),app.licenseDurationChoosen=decodeURI(postman.getParameterByName("licenseDurationChoosen",a.url)),app.isNGOdonationChecked=decodeURI(postman.getParameterByName("isNGOdonationChecked",a.url)),app.isFSIdonationChecked=decodeURI(postman.getParameterByName("isFSIdonationChecked",a.url)),setTimeout(function(){gui.inAppBrowser.close},config.TIME_WAIT_HTTP_POST)),null!==a.url.match("cancelPayment")&&(gui.inAppBrowser.removeEventListener('navigator.notification.alert("Are',gui.onAppBrowserExit),gui.inAppBrowser.removeEventListener("loadstop",gui.onAppBrowserLoad),navigator.notification.alert("the Payment was cancelled :-(",null,"Uh oh!"),setTimeout(function(){gui.inAppBrowser.close},config.TIME_WAIT_HTTP_POST))},GUI.prototype.onAppBrowserExit=function(a){gui.inAppBrowser.removeEventListener("loadstop",gui.onAppBrowserLoad),gui.inAppBrowser.removeEventListener("exit",gui.onAppBrowserExit)},GUI.prototype.onBackButton=function(){var a=$.mobile.activePage.attr("id");switch(!0){case/MainPage/.test(a):$(".ui-popup-active").length>0?$("#popupDiv").popup("close"):"undefined"!=typeof cordova&&null!=cordova&&$.when(app.events.deviceReady,app.events.documentReady).done(function(){function a(a){2==a&&(cordova.plugins.notification.local.cancelAll(function(){},this),navigator.app.exitApp())}navigator.notification.confirm(dictionary.Literals.label_18,a,dictionary.Literals.label_19,dictionary.Literals.label_20)});break;case/chat-page/.test(a):null!=gui.photoGallery&&gui.photoGallery.close(),$(".ui-popup-active").length>0?$("#popupDivMultimedia").popup("close"):$("body").pagecontainer("change","#MainPage",{transition:"none"});break;case/emoticons/.test(a):$("body").pagecontainer("change","#chat-page",{transition:"none"});break;case/ProfileOfContact/.test(a):gui.isPlanDisplayed?($("body").pagecontainer("change","#searchResultsPage",{transition:"none"}),gui.isPlanDisplayed=!1):$("body").pagecontainer("change","#chat-page",{transition:"none"}),gui.removeImgFromGallery(gui.indexOfImages4Gallery);break;case/forwardMenu/.test(a):$("body").pagecontainer("change","#chat-page",{transition:"none"});break;case/createPlanPage/.test(a):$("body").pagecontainer("change","#searchPage",{transition:"none"});break;case/searchResultsPage/.test(a):$("body").pagecontainer("change","#searchPage",{transition:"none"});break;default:$("body").pagecontainer("change","#MainPage",{transition:"none"})}},GUI.prototype.onChatInput=function(){var a=$("#chat-input").val();if(a=a.replace(/\n/g,""),document.getElementById("chat-input").value="",""!=a){var b=new Message({to:app.currentChatWith,from:user.publicClientID,messageBody:{messageType:"text",text:gui._sanitize(a)}});b.convertToUTF();var c=new Message(b);mailBox.storeMessage(c),gui.showMsgInConversation(c,{isReverse:!1,withFX:!0}),postman.sendMsg(b),$("#chat-multimedia-image").attr("src","res/multimedia_50x37.png"),$("#chat-multimedia-button").unbind("click",gui.showEmojis),$("#chat-multimedia-button").bind("click",gui.showImagePic);var d=abstractHandler.getObjById(app.currentChatWith);d.isAccepted||gui.onConsentButton()}},GUI.prototype.onConsentButton=function(){$("#consent-menu").remove();var a=abstractHandler.getObjById(app.currentChatWith);"undefined"!=typeof a&&(a.isAccepted=!0,a.isBlocked=!1,abstractHandler.setOnList(a),abstractHandler.setOnDB(a))},GUI.prototype.onGroupsButton=function(){var a=gui.groupOnMenu,b=$("#groupsButton").data("action"),c=$("#nickNameGroupField").val();if(""==c||c==dictionary.Literals.label_23){var d="";return d+='<div role="main" class="ui-content">',d+=' <h1 class="ui-title" role="heading" aria-level="1"> oops!</h1><p> </p>',d+="\t<h1> </h1><h2> remember to set a name for the Group</h2><h1> </h1>",d+="</div>",gui.showDialog(d),void gui.loadGroupMenu()}"create"==b?($("#groupsButton").data("action","modify").text(dictionary.Literals.label_39),groupsHandler.setGroupOnList(a),groupsHandler.setGroupOnDB(a),groupsHandler.sendGroupUpdate(a),gui.showGroupsOnGroupMenu(),gui.showEntryOnMainPage(a,!1)):(groupsHandler.setGroupOnList(a),groupsHandler.setGroupOnDB(a),groupsHandler.sendGroupUpdate(a))},GUI.prototype.onPlanSubmit=function(){gui.showLoadingSpinner();var a=$("#planSubmitButton").data("action"),b=$("#nickNamePlanField").val();if(""==b||b==dictionary.Literals.label_23){var c="";return c+='<div role="main" class="ui-content">',c+=' <h1 class="ui-title" role="heading" aria-level="1"> oops!</h1><p> </p>',c+="\t<h1> </h1><h2> remember to set a name for the Plan</h2><h1> </h1>",c+="</div>",gui.showDialog(c),void gui.hideLoadingSpinner()}var d=$(".myDatePicker"),e=d.pickadate("picker"),f=$("#label_71"),g=f.pickatime("picker"),h=e.get("select").pick,i={hour:g.get("select").hour.toString(),mins:g.get("select").mins.toString()};gui.groupOnMenu.meetingInitDate=h,gui.groupOnMenu.meetingInitTime=i;var j=gui.groupOnMenu,k={planId:j.publicClientID,organizer:user.publicClientID,imgsrc:"./res/group_black_195x195.png"==j.imgsrc?"":j.imgsrc,nickName:j.nickName,commentary:j.commentary,location:j.location,meetingInitDate:j.meetingInitDate,meetingInitTime:j.meetingInitTime,organizerObj:{publicClientID:user.publicClientID,nickName:user.myCurrentNick,commentary:user.myCommentary,location:{lat:app.myPosition.coords.latitude.toString(),lon:app.myPosition.coords.longitude},pubKeyPEM:user.keys.publicKey}},c="";c+='<div role="main" class="ui-content">',c+=' <h1 class="ui-title" role="heading" aria-level="1"> done yeah!</h1><p> </p>',c+="</div>","create"==a?(postman.send("PlanCreation",k),$("#planSubmitButton").data("action","modify").text(dictionary.Literals.label_39)):postman.send("PlanModification",k),groupsHandler.setGroupOnList(j),groupsHandler.setGroupOnDB(j),gui.showDialog(c),gui.hideLoadingSpinner(),gui.showEntryOnMainPage(j,!1)},GUI.prototype.onProfileUpdate=function(){app.profileIsChanged&&(user.lastProfileUpdate=(new Date).getTime(),app.profileIsChanged=!1,app.sendProfileUpdate(),user.updateUserSettings())},GUI.prototype.onRemoveContactFromGroup=function(a){gui.showRemoveContactFromGroup(a),gui.groupOnMenu.removeMember(a)},GUI.prototype.onReportAbuse=function(){$("#consent-menu").remove();var a=abstractHandler.getObjById(app.currentChatWith);"undefined"!=typeof a&&(a.isAccepted=!1,a.isBlocked=!0,abstractHandler.setOnList(a),abstractHandler.setOnDB(a),gui.showReportAbuse())},GUI.prototype.onReportBlock=function(){$("#consent-menu").remove();var a=abstractHandler.getObjById(app.currentChatWith);"undefined"!=typeof a&&(a.isAccepted=!1,a.isBlocked=!0,abstractHandler.setOnList(a),abstractHandler.setOnDB(a),$("#"+a.publicClientID).remove())},GUI.prototype.orderEntriesOnMainPage=function(){$("#listOfContactsInMainPage").listview().listview("refresh")},GUI.prototype.printMessagesOf=function(a,b,c,d){mailBox.getAllMessagesOf(a,b,c).done(function(e){var f=d.concat(e);f.length>0||b<config.TIME_UNIX_2015?(f.map(function(a){gui.showMsgInConversation(a,{isReverse:!1,withFX:!0})}),gui.printOldMessagesOf(a,b-config.TIME_UNIX_MONTH,b)):(b-=config.TIME_UNIX_MONTH,c-=config.TIME_UNIX_MONTH,gui.printMessagesOf(a,b,c,f))})},GUI.prototype.printOldMessagesOf=function(a,b,c){mailBox.getAllMessagesOf(a,b,c).done(function(d){d.reverse().map(function(a){gui.showMsgInConversation(a,{isReverse:!0,withFX:!1})}),b>config.TIME_UNIX_2015?(b-=config.TIME_UNIX_MONTH,c-=config.TIME_UNIX_MONTH,gui.printOldMessagesOf(a,b,c)):(gui.hideLoadingSpinner(),$(".blue-r-by-end").delay(config.TIME_FADE_ACK).fadeTo(config.TIME_FADE_ACK,0))})},GUI.prototype.removeImgFromGallery=function(a){gui.listOfImages4Gallery.splice(parseInt(a)-1,1),gui.indexOfImages4Gallery=gui.indexOfImages4Gallery-1},GUI.prototype.setImgIntoGallery=function(a,b,c){var d=new Image;d.src=b,d.onload=function(){var e=d.height,f=d.width;gui.listOfImages4Gallery[a]={src:b,w:f,h:e,msgId:c}},gui.indexOfImages4Gallery=gui.indexOfImages4Gallery+1},GUI.prototype.setLocalLabels=function(){document.getElementById("label_1").innerHTML=dictionary.Literals.label_1,document.getElementById("label_2").innerHTML=dictionary.Literals.label_2,document.getElementById("label_3").innerHTML=dictionary.Literals.label_3,document.getElementById("label_4").innerHTML=dictionary.Literals.label_4,document.getElementById("label_8").innerHTML=dictionary.Literals.label_8,document.getElementById("label_9").innerHTML=dictionary.Literals.label_9,document.getElementById("label_10").innerHTML=dictionary.Literals.label_10,document.getElementById("label_21").innerHTML=dictionary.Literals.label_36,document.getElementById("label_22").innerHTML=dictionary.Literals.label_1,document.getElementById("profileNameField").placeholder=dictionary.Literals.label_23,document.getElementById("profileCommentary").placeholder=dictionary.Literals.label_24,document.getElementById("profileTelephone").placeholder=dictionary.Literals.label_25,document.getElementById("profileEmail").placeholder=dictionary.Literals.label_26,document.getElementById("label_27").innerHTML=dictionary.Literals.label_27,document.getElementById("label_28").innerHTML=dictionary.Literals.label_28,document.getElementById("label_29").innerHTML=dictionary.Literals.label_29,document.getElementById("label_31").innerHTML=dictionary.Literals.label_31,document.getElementById("label_32").innerHTML=dictionary.Literals.label_32,document.getElementById("label_33").innerHTML=dictionary.Literals.label_33,document.getElementById("buyButton").innerHTML=dictionary.Literals.label_34,document.getElementById("label_37").innerHTML=dictionary.Literals.label_37,document.getElementById("groupsButton").innerHTML=dictionary.Literals.label_38,document.getElementById("label_52").innerHTML=dictionary.Literals.label_52,document.getElementById("label_60").innerHTML=dictionary.Literals.label_60,document.getElementById("label_65").innerHTML=dictionary.Literals.label_65,document.getElementById("label_66").innerHTML=dictionary.Literals.label_66,document.getElementById("label_72").innerHTML=dictionary.Literals.label_72},GUI.prototype.setTimeLastSMS=function(a){$("#"+a.publicClientID).data("sortby",a.timeLastSMS)},GUI.prototype.showAddContact2Group=function(a){$("#buttonAddContact2Group"+a.publicClientID).attr({class:"icon-list ui-btn ui-btn-icon-notext ui-icon-check"}),$("#contacts4Group").find("#divAddContact2Group"+a.publicClientID).unbind("click").on("click",function(){gui.onRemoveContactFromGroup(a)}),$("#contacts4Group").listview().listview("refresh")},GUI.prototype.showBlockSomebodyPrompt=function(){var a=abstractHandler.getObjById(app.currentChatWith),b="";b+='<div id="block-confirm" role="main" class="ui-content">',b+=' <h1 id="label_51" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_51+"</h1><p> </p>",b+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+a.imgsrc+'" class="imgInMainPage"/>  \t <h2>'+a.nickName+"</h2>   \t <p>"+a.commentary+"</p>    </a>  </li>",b+=' <a id="label_56" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",b+=' <a id="label_57" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",b+="</div>",gui.showDialog(b),$("#label_56").unbind("click").on("click",function(){gui.onReportBlock(),$("#popupDiv").remove()}),$("#label_57").unbind("click").on("click",function(){$("#popupDiv").remove()})},GUI.prototype.showConferencePage=function(a,b){$("body").pagecontainer("change","#conference-page",{transition:"none"}),$("#callRejectButton").unbind("click").on("click",b),$("#callAcceptButton").unbind("click").on("click",a),$("#conferenceTag").hide(),$("#imgConferenceCaller").remove();var c=contactsHandler.getContactById(app.currentChatWith);"undefined"!=typeof c&&null!=c&&($(".ui-height-70percent").prepend($("<img>",{id:"imgConferenceCaller",src:c.imgsrc,class:"vertical-center"})),gui.showLoadingSpinner())},GUI.prototype.showConsentMenu=function(){var a="";a+='<div data-role="none" id="consent-menu" class="ui-dialog-contain" > ',a+=" <h3></h3>",a+=' <a id="label_43" class="ui-btn ui-shadow ui-corner-all ui-btn-b">'+dictionary.Literals.label_43+"</a>",a+=' <a id="label_44" class="ui-btn ui-shadow ui-corner-all ui-btn-b">'+dictionary.Literals.label_44+"</a>",a+=' <a id="label_45" class="ui-btn ui-shadow ui-corner-all ui-btn-a">'+dictionary.Literals.label_45+"</a>",a+="</div>",$("#chat-page-content").append(a),$("#label_43").unbind("click").bind("click",function(){gui.showBlockSomebodyPrompt()}),$("#label_44").unbind("click").bind("click",function(){gui.onReportAbuse()}),$("#label_45").unbind("click").bind("click",function(){gui.onConsentButton()})},GUI.prototype.showConversation=function(a,b){gui.listOfImages4Gallery=null,gui.listOfImages4Gallery=[],gui.indexOfImages4Gallery=0,app.currentChatWith=a.publicClientID,$("body").pagecontainer("change","#chat-page"),gui.showLoadingSpinner(),$("#imgOfChat-page-header").attr("src",a.imgsrc),mailBox.retrieveMessages(a.publicClientID).done(function(c){c.length==config.MAX_SMS_RETRIEVAL&&gui.bindPagination(c[0].timestamp),c.reverse().map(function(a){gui.showMsgInConversation(a,{isReverse:!1,withFX:!0})}),gui.hideLoadingSpinner(),a.isAccepted||gui.showConsentMenu(),b&&b()}),a.counterOfUnreadSMS>0&&(a.counterOfUnreadSMS=0,abstractHandler.setOnList(a),abstractHandler.setOnDB(a),gui.refreshCounterOfChat(a)),a instanceof ContactOnKnet&&contactsHandler.sendProfileRequest(a),document.getElementById("css/jquery.emojipicker.tw.css")||(app.loadjscssfile("css/jquery.emojipicker.tw.css","css"),log.info("gui.showConversation - loadjscssfile called"))},GUI.prototype.showContactsOnGroupMenu=function(){$("#contacts4Group").empty(),contactsHandler.listOfContacts.map(function(a){var b='<li id="divAddContact2Group'+a.publicClientID+'"> <a>  <img src="'+a.imgsrc+'" class="imgInMainPage"/>  <h2>'+a.nickName+"</h2>   <p>"+a.commentary+'</p> </a> <a id="buttonAddContact2Group'+a.publicClientID+'" data-role="button" class="icon-list" data-inline="true"> </a></li>';$("#contacts4Group").append(b),gui.groupOnMenu.listOfMembers.indexOf(a.publicClientID)!=-1?gui.showAddContact2Group(a):gui.showRemoveContactFromGroup(a)})},GUI.prototype.showContactOnMapPage=function(a){var b='<li id="'+a.publicClientID+'-inMap"> <a>    <img id="profilePhoto'+a.publicClientID+'" src="'+a.imgsrc+'" class="imgInMainPage"/>  <h2>'+a.nickName+"</h2>   <p>"+a.commentary+"</p></a> <a></a></li>";$("#listOfContactsInMapPage").append(b).listview().listview("refresh").find("#"+a.publicClientID+"-inMap").first().on("click",function(){gui.showConversation(a)});var c=L.latLng(a.location.lat,a.location.lon);marker=new L.marker(c).bindPopup(a.nickName).addTo(app.map)},GUI.prototype.showDialog=function(a){$("#popupDiv").remove();var b='<div id="popupDiv" data-role="popup"> '+a+"</div>",c=$.mobile.activePage.attr("id");$("#"+c).append(b),$("#"+c).trigger("create"),$(".backButton").unbind("click").bind("click",function(){gui.onBackButton()}),$("#popupDiv").popup("open")},GUI.prototype.showEmojis=function(){$("body").pagecontainer("change","#emoticons",{transition:"none"})},GUI.prototype.showEntryOnMainPage=function(a,b){if($("#"+a.publicClientID).length)return $("#listOfContactsInMainPage").prepend($("#"+a.publicClientID)),$("#listOfContactsInMainPage").listview().listview("refresh"),void gui.refreshProfileInfo(a);if(!a.isBlocked){var c="";b&&(c+=' data-role="button" class="icon-list" data-icon="plus" data-iconpos="notext" data-inline="true" ');var d="";d=a.counterOfUnreadSMS>0?'<span id="counterOf_'+a.publicClientID+'" class="ui-li-count" style="border-color: #FF9720;">'+a.counterOfUnreadSMS+"</span>":'<span id="counterOf_'+a.publicClientID+'" class="" style="border-color: #FF9720;"></span>';var e='<li id="'+a.publicClientID+'" data-sortby='+a.timeLastSMS+' >\t<a id="link2go2ChatWith_'+a.publicClientID+'">\t\t<img id="profilePhoto'+a.publicClientID+'" src="'+a.imgsrc+'" class="imgInMainPage"/>\t\t<h2>'+a.nickName+"</h2> \t\t<p>"+a.commentary+"</p>"+d+' \t</a>\t<a id="linkAddNewContact'+a.publicClientID+'" '+c+" ></a></li>";$("#listOfContactsInMainPage").prepend(e).find("#link2go2ChatWith_"+a.publicClientID).on("click",function(){gui.showConversation(a)}),b?$("#linkAddNewContact"+a.publicClientID).on("click",function(){contactsHandler.addNewContactOnDB(a)}):$("#linkAddNewContact"+a.publicClientID).on("click",function(){gui.showConversation(a)}),$("#listOfContactsInMainPage").listview().listview("refresh"),gui.showLastMsgTruncated(a)}},GUI.prototype.showEntryOnResultsPage=function(a,b){var c=$("#listInResultsPage").find("#results_"+a.publicClientID);if(0==c.length&&!a.isBlocked){var d="";b&&(d+=' data-role="button" class="icon-list" data-icon="plus" data-iconpos="notext" data-inline="true" ');var e='<li id="results_'+a.publicClientID+'" >\t<a id="resultGo2Chat_'+a.publicClientID+'">\t\t<img id="profilePhoto'+a.publicClientID+'" src="'+a.imgsrc+'" class="imgInMainPage"/>\t\t<h2>'+a.nickName+"</h2> \t\t<p>"+a.commentary+'</p> \t</a>\t<a id="linkAddNewContact'+a.publicClientID+'" '+d+" ></a></li>";$("#listInResultsPage").prepend(e).find("#resultGo2Chat_"+a.publicClientID).on("click",function(){gui.showConversation(a)}),b?$("#linkAddNewContact"+a.publicClientID).on("click",function(){contactsHandler.addNewContactOnDB(a)}):$("#linkAddNewContact"+a.publicClientID).on("click",function(){gui.showConversation(a)}),$("#listInResultsPage").listview().listview("refresh")}},GUI.prototype.showGallery=function(a){if("WinCE"!=app.devicePlatform&&"Win32NT"!=app.devicePlatform){gui.loadGalleryInDOM();var b=document.querySelectorAll(".pswp")[0],c={};c.index=parseInt(a),c.mainClass="pswp--minimal--dark",c.barsSize={top:0,bottom:0},c.captionEl=!1,c.fullscreenEl=!1,c.shareEl=!0,c.bgOpacity=.85,c.tapToClose=!1,c.tapToToggleControls=!1,c.shareButtons=[],gui.photoGalleryClosed=!1,gui.photoGallery=new PhotoSwipe(b,PhotoSwipeUI_Default,gui.listOfImages4Gallery,c),gui.photoGallery.init(),gui.photoGallery.listen("destroy",function(){setTimeout(function(){gui.photoGalleryClosed=!0},config.TIME_SILENT_SCROLL)})}},GUI.prototype.showGroupsOnGroupMenu=function(){$("#listOfGroups").empty(),groupsHandler.list.map(function(a){var b='<li id="divGroupOnMenu'+a.publicClientID+'"> <a>  <img src="'+a.imgsrc+'" class="imgInMainPage"/>  <h2>'+a.nickName+"</h2>   <p>"+a.commentary+"</p> </a></li>";$("#listOfGroups").append(b).listview().listview("refresh").find("#divGroupOnMenu"+a.publicClientID).unbind("click").on("click",function(){gui.loadGroupMenu(a)})})},GUI.prototype.showJoinPlanPrompt=function(a){var b=abstractHandler.getObjById(a.organizerObj.publicClientID);if("undefined"!=typeof b&&null!=b){var c="";c+='<div id="block-confirm" role="main" class="ui-content">',c+=' <h1 id="label_76" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_76+"</h1><p> </p>",c+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+b.imgsrc+'" class="imgInMainPage"/>  \t <h2>'+b.nickName+"</h2>   \t <p>"+b.commentary+"</p>    </a>  </li>",c+=' <a id="label_56" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",c+=' <a id="label_57" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",c+="</div>",gui.showDialog(c),$("#label_56").unbind("click").on("click",function(){gui.showConversation(b,function(){var c=new Message({to:b.publicClientID,from:user.publicClientID,messageBody:{messageType:"inclusionRequest",planId:a.planId}});log.debug("forwardMsg ",c,a),app.forwardMsg(c,b)}),$("#popupDiv").remove()}),$("#label_57").unbind("click").on("click",function(){$("#popupDiv").remove()})}},GUI.prototype.showImagePic=function(){var a='<div id="popupDivMultimedia" data-role="popup" data-overlay-theme="a"> \t<a class="backButton ui-btn-right" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" ></a>\t<input data-role="none" hidden type="file" name="image" id="picPopupDivMultimedia" class="picedit_box">\t\t </div>';$("#multimedia-content").append(a),$("#multimedia-content").trigger("create"),$(".backButton").unbind("click").bind("click",function(){gui.onBackButton()}),$("#popupDivMultimedia").bind({popupafterclose:function(a,b){$("#popupDivMultimedia").remove()}}),$("#picPopupDivMultimedia").picEdit({maxWidth:config.MAX_WIDTH_IMG>.7*$(window).width()?.7*$(window).width():config.MAX_WIDTH_IMG,maxHeight:config.MAX_HEIGHT_IMG>.6*$(window).height()?.6*$(window).height():config.MAX_HEIGHT_IMG,displayWidth:.7*$(window).width(),displayHeight:.6*$(window).height(),navToolsEnabled:!1,isMobile:app.isMobile,onImageCreation:function(){$("#popupDivMultimedia").popup("close")},onNativeCameraInit:app.onNativeCameraInit,imageUpdated:function(a){app.sendMultimediaMsg({receiver:app.currentChatWith,src:a.src})}}),$("#popupDivMultimedia").popup("open")},GUI.prototype.showLastMsgTruncated=function(a){var b=$("#link2go2ChatWith_"+a.publicClientID).children().closest("p");if(""!=a.lastMsgTruncated){var c="";config.MAX_LENGTH_TRUNCATED_SMS-4<a.lastMsgTruncated.length&&(c=" ..."),b.html(decodeURIComponent(a.lastMsgTruncated)+c)}else b.html(decodeURIComponent(a.commentary))},GUI.prototype.showListOfBlocked=function(){$("#listOfBlocked").empty();var a=[];groupsHandler.list.map(function(b){b.isBlocked&&a.push(b)}),contactsHandler.listOfContacts.map(function(b){b.isBlocked&&a.push(b)}),a.map(function(a){var b='<li id="divBlockedPeople'+a.publicClientID+'"> <a>  <img src="'+a.imgsrc+'" class="imgInMainPage"/>  <h2>'+a.nickName+"</h2>   <p>"+a.commentary+'</p> </a> <a id="buttonUnblock'+a.publicClientID+'" data-role="button" class="icon-list ui-icon-forbidden" data-inline="true"> </a></li>';$("#listOfBlocked").append(b).listview().listview("refresh").find("#divBlockedPeople"+a.publicClientID).unbind("click").on("click",function(){gui.showUnblockSomebodyPrompt(a)})})},GUI.prototype.showLoadingSpinner=function(a){$(".mask-color").fadeIn("fast")},GUI.prototype.showLocalNotification=function(a){if(app.isMobile&&(app.inBackground||a.from!=app.currentChatWith)&&"Android"==app.devicePlatform){var b=contactsHandler.getContactById(a.from),c=b?b.nickName:dictionary.Literals.label_16,d="";"multimedia"==a.messageBody.messageType?d="multimedia":"text"==a.messageBody.messageType&&(d=decodeURI(gui._sanitize(a.messageBody.text)).substring(0,config.MAX_LENGTH_TRUNCATED_SMS));var e={id:0,title:c,text:d};"Android"==app.devicePlatform&&(e.smallIcon="res://icon.png"),cordova.plugins.notification.local.isPresent(0,function(a){a?cordova.plugins.notification.local.update(e):cordova.plugins.notification.local.schedule(e)})}},GUI.prototype.showMsgInConversation=function(a,b){var c,d="";if(a.from==user.publicClientID)c=" ",d="red-no-rx-by-srv",1==a.markedAsRead?d="blue-r-by-end":1==a.ACKfromAddressee?d="green-rx-by-end":1==a.ACKfromServer&&(d="amber-rx-by-srv");else{var e=contactsHandler.getContactById(a.from);if("undefined"==typeof e||null==e)return;if(c=e.nickName,0==a.markedAsRead){var f={to:a.to,from:a.from,msgID:a.msgID,typeOfACK:"ReadfromAddressee"};postman.send("MessageDeliveryACK",f),a.markedAsRead=!0,mailBox.storeMessage(a)}}var g="",h="";if("text"==a.messageBody.messageType){g=this._sanitize(a.messageBody.text),g=decodeURI(g);var i=this._parseLinks(g);g=i.htmlOfContent,g=twemoji.parse(g,function(a,b,c){return"./js/"+b.size+"/"+a+".png"}),i.mediaLinks.map(function(a){var b=null;b="youtube"==a.type?"http://www.youtube.com/embed/"+a.id:"https://player.vimeo.com/video/"+a.id,null!=b&&(h+='<div class="youtube-preview"><iframe width="100%" height="100%" src='+b+' frameborder="0" allowfullscreen=""></iframe><div class="tool-bar"> <div data-role="none" class="pswp__button pswp__button--share" ></div> </div></div>')})}else if("multimedia"==a.messageBody.messageType)g='<div class="image-preview">  <a>  <img class="image-embed" src="'+a.messageBody.src+'" data-index="'+gui.indexOfImages4Gallery+'"> </a> <div class="tool-bar"> <div data-role="none" class="pswp__button pswp__button--share" ></div> </div></div>',gui.setImgIntoGallery(gui.indexOfImages4Gallery,a.messageBody.src,a.msgID);else if("inclusionRequest"==a.messageBody.messageType){var j=groupsHandler.getGroupById(a.messageBody.planId),k="undefined"==typeof j||null==j?a.messageBody.planId:j.nickName,l="undefined"==typeof j||null==j?"./res/new_contact_added_195x195.png":j.imgsrc,m="",n="",e=null,o="",p=!1;if(a.from==user.publicClientID)m=l,o=dictionary.Literals.label_78;else{var e=contactsHandler.getContactById(a.from);n="undefined"==typeof e||null==e?a.from:e.nickName,m="undefined"==typeof e||null==e?"./res/new_contact_added_195x195.png":e.imgsrc,o=dictionary.Literals.label_77,j.listOfMembers.map(function(a){a==e.publicClientID&&(p=!0)})}g="",g+='<div id="block-confirm" role="main" class="ui-content">',g+=' <h1 id="label_77" class="ui-title" role="heading" aria-level="1">'+o+"</h1><p> </p>",g+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+m+'" class="imgInMainPage"/>  \t <h2>'+n+"</h2>   \t <h2>"+dictionary.Literals.label_40+k+"</h2>    </a>  </li>",a.from!=user.publicClientID&&0==p&&(g+=' <a id="label_56" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",g+=' <a id="label_57" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",g+="</div>")}var q=new Date(a.timestamp),r='<div class="activity">\t<span class="posted_at">  \t\t<div id="messageStateColor_'+a.msgID+'" class="'+d+'"></div>'+gui.formatter.formatDate(q,{datetime:"medium"})+'\t</span>\t<div class="readable">\t\t<span class="user">'+c+'</span>\t\t<span class="content">'+g+h+"</span>\t</div></div>",s=$(r);"multimedia"==a.messageBody.messageType?(s.find(".pswp__button").unbind("click").on("click",function(){app.msg2forward=a.msgID,$("body").pagecontainer("change","#forwardMenu",{transition:"none"})}),s.find(".image-embed").unbind("click").on("click",function(a){gui.showGallery($(a.target).data("index"))})):"inclusionRequest"==a.messageBody.messageType&&s.find("#label_56").unbind("click").on("click",function(b){var c=contactsHandler.getContactById(a.from),d=groupsHandler.getGroupById(a.messageBody.planId);d.addMember(c),groupsHandler.setGroupOnList(d),groupsHandler.setGroupOnDB(d),groupsHandler.sendGroupUpdate(d);var e="";e+='<div role="main" class="ui-content">',e+=' <h1 class="ui-title" role="heading" aria-level="1"> done yeah!</h1><p> </p>',e+="</div>",gui.showDialog(e)}),a.from!=user.publicClientID&&s.css("background","#FFFFE0"),b.isReverse?$("#chat-page-content").prepend(s):($("#chat-page-content").append(s),$("#chat-page-content").trigger("create")),b.withFX&&($(".blue-r-by-end").delay(config.TIME_FADE_ACK).fadeTo(config.TIME_FADE_ACK,0),setTimeout(function(){$.mobile.silentScroll($(document).height())},config.TIME_SILENT_SCROLL))},GUI.prototype.showPlanImgInResultsPage=function(a){""!=a.imgsrc&&$("#profilePhotoResults_"+a.planId).attr("src",a.imgsrc)},GUI.prototype.showPlansInResultsPage=function(a){a.map(function(a){var b=$("#listInResultsPage").find("#results_"+a.planId);if(0==b.length){var c=' data-role="button" class="icon-list" data-icon="plus" data-iconpos="notext" data-inline="true" ',d='<li id="results_'+a.planId+'" >\t<a id="resultsGo2Chat_'+a.planId+'">\t\t<img id="profilePhotoResults_'+a.planId+'" src="./res/group_black_195x195.png" class="imgInMainPage"/>\t\t<h2>'+a.nickName+"</h2> \t\t<p>"+a.commentary+'</p> \t</a>\t<a id="linkAddNewContact'+a.planId+'" '+c+" ></a></li>";$("#listInResultsPage").prepend(d).find("#resultsGo2Chat_"+a.planId).on("click",function(){gui.showProfile(a)}).find("#linkAddNewContact"+a.planId).on("click",function(){gui.showProfile(a)}),$("#listInResultsPage").listview().listview("refresh"),postman.send("ReqPlanImg",{planId:a.planId})}}),a.map(function(a){if(a.organizerObj.publicClientID!=user.publicClientID){var b=contactsHandler.getContactById(a.organizerObj.publicClientID);"undefined"!=typeof b&&null!=b||(b=new ContactOnKnet(a.organizerObj),contactsHandler.setContactOnList(b),contactsHandler.sendProfileRequest(b))}})},GUI.prototype.showProfile=function(a){var b,c=!1,d=!1,e=!1;if(a)b=a,e=!0,gui.isPlanDisplayed=!0;else{if(b=abstractHandler.getObjById(app.currentChatWith),"undefined"==typeof b)return;b instanceof ContactOnKnet?d=!0:c=!0}$("#ProfileOfContact-page").remove();var f="";if(f+='\t\t<div data-role="page" data-cache="false" id="ProfileOfContact-page" >',f+='\t\t\t<div data-role="header" data-position="fixed">\t\t\t\t\t\t\t',f+='\t\t\t  <div class="ui-grid-d" >',f+='\t\t\t    <div class="ui-block-a">',f+='\t\t\t\t\t<a data-role="button" class="backButton ui-nodisc-icon icon-list">',f+='\t\t\t\t\t <img src="res/arrow-left_22x36.png" alt="lists" class="button ui-li-icon ui-corner-none ">',f+="\t\t\t\t\t</a>",f+="\t    \t\t</div>",f+='\t\t\t    <div class="ui-block-b"></div>',f+='\t\t\t    <div class="ui-block-c"></div>',f+='\t\t\t    <div class="ui-block-e"></div>',f+='\t\t\t    <div class="ui-block-e"></div>',f+="\t\t\t  </div>",f+="\t\t\t</div><!-- /header -->",f+='\t\t\t<div data-role="content" data-theme="a"> ',f+='\t\t\t\t<div class="container" id="main">',f+='\t\t\t\t\t<div class="row">',f+='\t\t\t\t\t\t<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">',f+='\t\t\t\t\t\t\t<div id="sidebar">',f+='\t\t\t\t\t\t\t\t<div class="user">',f+='\t\t\t\t\t\t\t\t\t<div class="text-center">',""==b.imgsrc&&e&&(b.imgsrc="./res/group_black_195x195.png"),f+='\t\t\t\t\t\t\t\t\t\t<img src="'+b.imgsrc+'" class="img-circle" data-index=\''+gui.indexOfImages4Gallery+"'>",f+="\t\t\t\t\t\t\t\t\t</div>",f+='\t\t\t\t\t\t\t\t\t<div class="user-head">',f+="\t\t\t\t\t\t\t\t\t\t<h1>"+b.nickName+"</h1>",f+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>',(c||d)&&(f+="\t\t\t\t\t\t\t\t\t\t<h5>"+b.commentary+"</h5>",f+='\t\t\t\t\t\t\t\t\t\t<div class="hr-center"></div>'),f+="\t\t\t\t\t\t\t\t\t</div>",f+="\t\t\t\t\t\t\t\t</div>",f+="\t\t\t\t\t\t\t</div>",f+="\t\t\t\t\t\t</div>",f+='\t\t\t\t\t\t<div class="col-lg-9 col-md-9 col-sm-8 col-xs-12">',f+='\t\t\t\t\t\t\t<div id="content">',f+='\t\t\t\t\t\t\t\t<div class="main-content"> ',f+='\t\t\t\t\t          \t\t<div class="timeline-panel">',f+=d?"\t\t\t\t\t        \t\t<h1>"+dictionary.Literals.label_63+"</h1>":"\t\t\t\t\t        \t\t<h1>"+dictionary.Literals.label_62+"</h1>",f+='\t\t\t\t\t    \t      \t\t<div class="hr-left"></div>',f+='\t\t\t\t\t        \t  \t\t<div class="row" id="contact">',f+='\t\t\t\t\t          \t\t\t\t<div class="col-md-12">',f+="\t\t\t\t\t\t\t\t\t\t\t\t<strong>"+b.nickName+"</strong><br>",e&&(f+="\t\t\t\t\t\t\t\t\t\t\t<p>"+b.commentary+"</p>",f+='\t\t\t\t\t\t\t\t\t\t\t<div class="form-group">',f+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_73" data-role="none"  class="myDatePicker form-control input-lg " placeholder="" readonly> ',f+='\t\t\t\t\t\t\t\t\t\t\t\t<input id="label_74" data-role="none"  class="form-control input-lg myTimePicker" placeholder="" readonly> ',f+="\t\t\t\t\t\t\t\t\t\t\t</div>"),d&&(f+="\t\t\t\t\t          \t\t\t\t\t<address>",f+='\t\t\t\t\t\t\t\t\t\t\t  \t\t<abbr title="Phone"> &#9742 &nbsp;'+b.telephone+"</abbr>",f+="\t\t\t\t\t\t\t\t\t\t\t\t</address>",f+="\t\t\t\t\t\t\t\t\t\t\t\t<email>",f+='\t\t\t\t\t\t\t\t\t\t\t\t  \t<abbr title="email"> &#9993; &nbsp;'+b.email+"</abbr>",
f+="\t\t\t\t\t\t\t\t\t\t\t\t</email>"),(c||d)&&(f+="\t\t\t\t\t\t\t\t\t\t\t\t<address>",f+='\t\t\t\t\t\t\t\t\t\t\t\t  \t<abbr title="id"> &#x1f511; &nbsp;'+b.publicClientID+"</abbr>",f+="\t\t\t\t\t\t\t\t\t\t\t\t</address>",f+="\t\t\t\t\t\t          \t\t\t</div>",f+='\t\t\t\t\t\t          \t\t\t<div class="col-md-12"><br>'),c){f+='<ul id="contacts4Profile">';var g=[];b.listOfMembers.map(function(a){var b=contactsHandler.getContactById(a);("undefined"!=typeof b||null!=b&&b.publicClientID!=user.publicClientID)&&g.push(b)}),g.map(function(a){f+='<li id="contact4Profile_'+a.publicClientID+'">',f+=" <a>",f+='  <img src="'+a.imgsrc+'" class="imgInMainPage"/>',f+="  <h2>"+a.nickName+"</h2> ",f+="  <p>"+a.commentary+"</p>",f+=" </a>",f+=' <a id="buttonAddContact2Group'+a.publicClientID+'" data-role="button" class="icon-list" data-inline="true">',f+=" </a>",f+="</li>"}),f+="</ul>"}if(f+="\t\t\t\t\t        \t  \t\t\t</div>",f+="\t\t\t\t\t          \t\t\t</div>",f+='\t\t\t\t\t          \t\t\t<div id="mapProfile" class="mapPlanPage">',f+="\t\t\t\t\t          \t\t\t</div>",(c||d)&&(f+='\t\t\t\t\t\t\t\t\t\t<div class="col-md-12">',f+='\t\t\t\t\t          \t\t\t\t<h1 id="label_49">'+dictionary.Literals.label_49+"</h1>",f+="\t\t\t\t\t          \t\t\t\t<h1></h1>",f+='\t\t\t\t\t\t\t\t\t\t\t<button id="label_54">'+dictionary.Literals.label_43+"</button>",f+='\t\t\t\t\t\t\t\t\t\t\t<button id="label_55">'+dictionary.Literals.label_48+"</button>",f+="\t\t\t\t\t          \t\t\t</div>"),e){if(b.organizerObj.publicClientID==user.publicClientID)return gui.groupOnMenu=new Group(b),gui.groupOnMenu.publicClientID=b.planId,$("body").pagecontainer("change","#createPlanPage",{transition:"none"}),void $("#planSubmitButton").delay(config.TIME_SILENT_SCROLL).data("action","modify").text(dictionary.Literals.label_39);f+="\t\t\t\t\t          \t<h1></h1>",f+='\t\t\t\t\t\t\t\t<button id="label_75">'+dictionary.Literals.label_75+"</button>"}if(f+="\t\t\t\t\t    \t      \t</div>",f+="\t\t\t\t\t\t\t\t</div>",f+="\t\t\t\t\t\t\t</div>",f+="\t\t\t\t\t\t</div>",f+="\t\t\t\t\t</div>",f+="\t\t\t\t</div>",f+="\t\t\t</div><!-- /content -->",f+="\t\t</div><!-- / ProfileOfContact-page-->",$("body").append(f).find(".img-circle").unbind("click").on("click",function(a){gui.showGallery($(a.target).data("index"))}),$("#contacts4Profile").listview().listview("refresh").find('[id^="contact4Profile_"]').on("click",function(a){var b=$(this).attr("id"),c=b.substring(16,b.length),d=contactsHandler.getContactById(c);"undefined"!=typeof d&&null!=d&&gui.showConversation(d)}),$("body").pagecontainer("change","#ProfileOfContact-page",{transition:"none"}),gui.setImgIntoGallery(gui.indexOfImages4Gallery,b.imgsrc,""),$(".backButton").unbind("click").bind("click",function(){gui.onBackButton()}),$("#label_54").unbind("click").bind("click",function(){gui.showBlockSomebodyPrompt()}),$("#label_55").unbind("click").bind("click",function(){gui.onReportAbuse()}),e){gui.loadMapOnProfile(b);var h=new Date(parseInt(b.meetingInitDate));h=gui.formatter.formatDate(h,{datetime:"medium"}),h=h.substring(0,h.length-5),$("#label_73").val(h);var i=gui.formatter.formatDate(new Date(2e3,10,10,b.meetingInitTime.hour,b.meetingInitTime.mins),{time:"medium"});$("#label_74").val(i),$("#label_75").unbind("click").bind("click",function(){gui.showJoinPlanPrompt(b)})}else gui.loadMapOnProfile()},GUI.prototype.showRemoveContactFromGroup=function(a){$("#buttonAddContact2Group"+a.publicClientID).attr({class:"icon-list ui-btn ui-btn-icon-notext ui-icon-plus"}),$("#contacts4Group").find("#divAddContact2Group"+a.publicClientID).unbind("click").on("click",function(){gui.onAddContact2Group(a)}),$("#contacts4Group").listview().listview("refresh")},GUI.prototype.showReportAbuse=function(){var a="";a+='<div id="block-confirm" role="main" class="ui-content">',a+=' <h1 id="label_58" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_58+"</h1><p> </p>",a+="</div>",gui.showDialog(a)},GUI.prototype.showTargetOnForwardMenu=function(a){var b='<li id="'+a.publicClientID+'-inForwardMenu"> <a>    <img id="profilePhoto'+a.publicClientID+'" src="'+a.imgsrc+'" class="imgInMainPage"/>  <h2>'+a.nickName+"</h2>   <p>"+a.commentary+"</p></a> <a></a></li>";$("#listOfContactsInForwardMenu").append(b).listview().listview("refresh").find("#"+a.publicClientID+"-inForwardMenu").first().on("click",function(){gui.forwardMsg(a)})},GUI.prototype.showTermsAndConditions=function(){var a="";a+='<h1>Terms and Conditions ("Terms")</h1>',a+='<p>Please read these Terms and Conditions carefully before using either the knet mobile app or the http://www.instaltic.com/knet website (the "Service") operated by InstalTIC S.L. ("us", "we", or "our").</p>',a+="<p>Your access to and use of the Service is conditioned on your acceptance of and compliance with these Terms. These Terms apply to all visitors, users and others who access or use the Service.</p>",a+="<p>By accessing or using the Service you agree to be bound by these Terms. If you disagree with any part of the terms then you may not access the Service.</p>",a+="<p><strong> privacy policy </strong></p>",a+="<p>We do not request any personal data from you. Your identity is just a random number for us. However you can always set your details in your profile if you want to share them with other users. </p>",a+="<p>We do not collect your messages. The only message data stored on our servers is the data that is currently in transit, and even this data is encrypted with end-to-end encryption, we can not read it. </p>",a+="<p>We do not any financial data of yours. </p>",a+="<p>There are some data knet uses in order to provide the service: </p>",a+="<p>your IP-address, or the IP-Address of a router when you are in a network using NAT,</p>",a+="<p>your public keys, </p>",a+="<p>your client identifier, which is a random number, </p>",a+="<p>your chosen nickname, avatar, telephone and email, if and only is you decided to put it into your profile. </p>",a+="<p><strong>Accounts</strong></p>",a+="<p>We may terminate your account, without previous warning if you breach the Terms. We will immediately block your account if we detect an inappropriate use of the service. </p>",a+="<p><strong>Links To Other Web Sites</strong></p>",a+="<p>Our Service may contain links to third-party web sites or services that are not owned or controlled by knet.</p>",a+="<p>knet has no control over, and assumes no responsibility for, the content, privacy policies, or practices of any third party web sites or services. You further acknowledge and agree that knet shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with use of or reliance on any such content, goods or services available on or through any such web sites or services.</p>",a+="<p>We strongly advise you to read the terms and conditions and privacy policies of any third-party web sites or services that you visit.</p>",a+="<p><strong>Termination</strong></p>",a+="<p>We may terminate or suspend access to our Service immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms.</p>",a+="<p>All provisions of the Terms which by their nature should survive termination shall survive termination, including, without limitation, ownership provisions, warranty disclaimers, indemnity and limitations of liability.</p>",a+="<p>We may terminate or suspend your account immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms.</p>",a+="<p>Upon termination, your right to use the Service will immediately cease. If you wish to terminate your account, you may simply discontinue using the Service.</p>",a+="<p>All provisions of the Terms which by their nature should survive termination shall survive termination, including, without limitation, ownership provisions, warranty disclaimers, indemnity and limitations of liability.</p>",a+="<p><strong>Governing Law</strong></p>",a+="<p>These Terms shall be governed and construed in accordance with the laws of Spain, without regard to its conflict of law provisions.</p>",a+="<p>Our failure to enforce any right or provision of these Terms will not be considered a waiver of those rights. If any provision of these Terms is held to be invalid or unenforceable by a court, the remaining provisions of these Terms will remain in effect. These Terms constitute the entire agreement between us regarding our Service, and supersede and replace any prior agreements we might have between us regarding the Service.</p>",a+="<p><strong>Changes</strong></p>",a+="<p>We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material we will try to provide at least 15 days notice prior to any new terms taking effect. What constitutes a material change will be determined at our sole discretion.</p>",a+="<p>By continuing to access or use our Service after those revisions become effective, you agree to be bound by the revised terms. If you do not agree to the new terms, please stop using the Service.</p>",a+="<p><strong>Contact Us</strong></p>",a+="<p>If you have any questions about these Terms, please contact us. The easiest way to contact us is to email us to support@instaltic.com</p>",a+="<p><strong></strong></p>",a+="<p><strong><br></strong></p>",a+='<a id="label_59" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_59+"</a>",a+="<p><strong><br></strong></p>",gui.showDialog(a),$("#label_59").click(function(){$("#popupDiv").popup("close"),$("#popupDiv").remove()})},GUI.prototype.showUnblockSomebodyPrompt=function(a){var b="";b+='<div role="main" class="ui-content">',b+=' <h1 id="label_50" class="ui-title" role="heading" aria-level="1">'+dictionary.Literals.label_50+"</h1><p> </p>",b+=' <ul data-role="listview" data-inset="true" data-divider-theme="a">  <li> \t<a data-role="none" class="ui-btn">  \t <img src="'+a.imgsrc+'" class="imgInMainPage"/>  \t <h2>'+a.nickName+"</h2>   \t <p>"+a.commentary+"</p>    </a>  </li>",b+='  <a id="label_46" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_46+"</a>",b+='  <a id="label_47" class="ui-btn ui-corner-all ui-shadow ui-btn-b" >'+dictionary.Literals.label_47+"</a>",b+=" </ul>",b+="</div>",gui.showDialog(b),gui.loadGroupMenu(),$("#label_46").unbind("click").on("click",function(){a.isBlocked=!1,abstractHandler.setOnList(a),abstractHandler.setOnDB(a),$("#popupDiv").remove(),gui.loadGroupMenu(),gui.showEntryOnMainPage(a)}),$("#label_47").unbind("click").on("click",function(){$("#popupDiv").remove()})},GUI.prototype.showWelcomeMessage=function(a){a&&$.mobile.loading("show",{text:a,textVisible:!0,theme:$.mobile.loader.prototype.options.theme,textonly:!0,html:""})},GUI.prototype.showPeerIsOnline=function(a){var b=abstractHandler.getObjById(a.idWhoIsOnline);if("undefined"!=typeof b&&null!=b){var c=$("#link2go2ChatWith_"+b.publicClientID).children().closest("p");"on"!=c.data("typing")&&(c.html('<font color="orange"><b> online</b></font>'),c.delay(config.TIME_FADE_ONLINE_NOTICE).fadeOut(config.TIME_FADE_ONLINE_NOTICE).fadeIn(config.TIME_FADE_ONLINE_NOTICE).fadeOut(config.TIME_FADE_ONLINE_NOTICE).fadeIn(config.TIME_FADE_ONLINE_NOTICE,function(){var b=abstractHandler.getObjById(a.idWhoIsOnline);gui.showLastMsgTruncated(b)}))}},GUI.prototype.showPeerIsTyping=function(a){var b=abstractHandler.getObjById(a.idWhoIsWriting);if("undefined"!=typeof b&&null!=b){var c=$("#link2go2ChatWith_"+b.publicClientID).children().closest("p");"on"!=c.data("typing")&&(c.html('<font color="orange"><b> '+dictionary.Literals.label_61+" ... </b></font>"),c.data("typing","on"),c.delay(config.TIME_FADE_WRITING).fadeOut(config.TIME_FADE_WRITING).fadeIn(config.TIME_FADE_WRITING).fadeOut(config.TIME_FADE_WRITING).fadeIn(config.TIME_FADE_WRITING,function(){c.data("typing","off");var b=abstractHandler.getObjById(a.idWhoIsWriting);gui.showLastMsgTruncated(b)}))}},GUI.prototype.refreshCounterOfChat=function(a){a.counterOfUnreadSMS>0?($("#counterOf_"+a.publicClientID).text(a.counterOfUnreadSMS),$("#counterOf_"+a.publicClientID).attr("class","ui-li-count")):($("#counterOf_"+a.publicClientID).text(""),$("#counterOf_"+a.publicClientID).attr("class","")),$("#listOfContactsInMainPage").listview().listview("refresh")},GUI.prototype.refreshProfileInfo=function(a){var b=abstractHandler.getObjById(a.publicClientID);if("undefined"!=typeof b&&null!=b){b.lastProfileUpdate=(new Date).getTime(),abstractHandler.setOnList(b),abstractHandler.setOnDB(b),$("#profilePhoto"+b.publicClientID).attr("src",b.imgsrc),app.currentChatWith==b.publicClientID&&$("#imgOfChat-page-header").attr("src",b.imgsrc);var c=$("#link2go2ChatWith_"+b.publicClientID).children();""!=b.imgsrc&&c.find("img").attr("src",b.imgsrc),""!=b.nickName&&c.closest("h2").html(b.nickName),""!=b.commentary&&c.closest("p").html(b.commentary)}},GUI.prototype.refreshPurchasePrice=function(){var a=gui.getPurchaseDetails(),b=0;"fourYears"==a.licenseDurationChoosen&&(b+=3),"oneYear"==a.licenseDurationChoosen&&(b+=1),a.isNGOdonationChecked&&(b+=1),a.isFSIdonationChecked&&(b+=1),$("#price").html(b+"€")},MailBox.prototype.getAllMessagesOf=function(a,b,c){var d=IDBKeyRange.bound(b,c),e=$.Deferred(),f=[];return db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(d).onsuccess=function(b){var c=b.target.result;if(c){if(c.value.chatWith==a){var d=new Message(c.value);f.push(d)}c.continue()}else e.resolve(f)},e.promise()},MailBox.prototype.getMessageByID=function(a){var b=IDBKeyRange.only(a),c=$.Deferred();return db.transaction(["messages"],"readonly").objectStore("messages").openCursor(b).onsuccess=function(a){var b,d=a.target.result;if(d){b=d.value;var e=new Message(b);c.resolve(e)}},c.promise()},MailBox.prototype.getMessagesSentOffline=function(a,b){var c=IDBKeyRange.bound(a,b),d=$.Deferred(),e=[];return db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(c).onsuccess=function(a){var b=a.target.result;if(b){if(0==b.value.ACKfromServer){var c=new Message(b.value);e.push(c)}b.continue()}else d.resolve(e)},d.promise()},MailBox.prototype.retrieveMessages=function(a,b){"undefined"==typeof b&&(b=(new Date).getTime());var c=config.TIME_UNIX_2015,d=IDBKeyRange.bound(c,b),e=$.Deferred(),f=[],g=0;return db.transaction(["messages"],"readonly").objectStore("messages").index("timestamp").openCursor(d,"prev").onsuccess=function(b){var c=b.target.result;if(c&&g<config.MAX_SMS_RETRIEVAL){if(c.value.chatWith==a){var d=new Message(c.value);f.push(d),g+=1}c.continue()}else e.resolve(f)},e.promise()},MailBox.prototype.sendOfflineMessages=function(a,b,c){mailBox.getMessagesSentOffline(a,b).done(function(d){c.length>config.MAX_SEND_OFFLINE_SMS||a<config.TIME_UNIX_2015?c.map(function(a){postman.sendMsg(a)}):(a-=config.TIME_UNIX_MONTH,b-=config.TIME_UNIX_MONTH,mailBox.sendOfflineMessages(a,b,c.concat(d)))})},MailBox.prototype.storeMessage=function(a){try{var b=IDBKeyRange.only(a.msgID),c=db.transaction(["messages"],"readwrite"),d=c.objectStore("messages");d.openCursor(b).onsuccess=function(b){var c=b.target.result;c?c.update(a):d.add(a)}}catch(a){log.debug("MailBox.prototype.storeMessage",a)}},MailBox.prototype.removeMessage=function(a){try{var b=db.transaction(["messages"],"readwrite"),c=b.objectStore("messages");c.delete(a.msgID).onsuccess=function(a){log.debug("removeMessage ::: succesfully removed")}}catch(a){log.debug("MailBox.prototype.storeMessage",a)}},MailBox.prototype.unwrapMessagesOf=function(a){try{var b=IDBKeyRange.only(a.publicClientID),c=db.transaction(["messages"],"readonly"),d=c.objectStore("messages");d.index("publicclientid").openCursor(b).onsuccess=function(a){var b=a.target.result;b&&b.value.messageBody.hasOwnProperty("index4Key")&&(postman.onMsgFromClient(b.value),log.info("MailBox.prototype.unwrapMessagesOf"))}}catch(a){log.debug("MailBox.prototype.unwrapMessagesOf",a)}},Application.prototype.bindDeviceEvents=function(){document.addEventListener("deviceready",this.onDeviceReady,!1),document.addEventListener("backbutton",gui.onBackButton,!1),document.addEventListener("menubutton",function(){},!1),document.addEventListener("searchbutton",function(){},!1),document.addEventListener("startcallbutton",function(){},!1),document.addEventListener("endcallbutton",function(){},!1),document.addEventListener("pause",function(){app.inBackground=!0},!1),document.addEventListener("resume",this.onResumeCustom,!1),document.addEventListener("online",this.onOnlineCustom,!1)},Application.prototype.bindPushEvents=function(){var a=PushNotification.init(config.pushOptions);a.on("registration",function(a){app.sendPushRegistrationId(a.registrationId)}),a.on("notification",function(a){}),a.on("error",function(a){console.log("Application.prototype.bindPushEvents - error")})},Application.prototype.connect2paypal=function(a){$.ajax({url:"http://"+config.ipServerSockets+":"+config.portServerSockets+"/payment",method:"POST",data:{handshakeToken:user.handshakeToken,purchase:a},dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!1}}).done(function(a){1==a.OK&&(gui.inAppBrowser=window.open(a.URL,"_blank","location=yes"),gui.inAppBrowser.addEventListener("loadstop",gui.onAppBrowserLoad),gui.inAppBrowser.addEventListener("exit",gui.onAppBrowserExit))}).fail(function(){log.info("Application.prototype.connect2paypal - failed")}).always(function(){gui.hideLoadingSpinner()})},Application.prototype.connect2server=function(a){app.symetricKey2use=user.myArrayOfKeys[a.index];var b=postman.decrypt(a.challenge).challenge,c={handshakeToken:user.handshakeToken,challenge:encodeURI(postman.encrypt({challengeClear:b}))};app.tokenSigned=postman.signToken(c);var d=postman.decrypt(a.server2connect);null!=d&&(config.ipServerSockets=d.ipServerSockets,config.portServerSockets=d.portServerSockets),"undefined"!=typeof socket&&socket.disconnect(),log.info("remoteServer",d);var e="https://"+config.ipServerSockets+":"+config.portServerSockets,f={forceNew:!0,secure:!0,reconnection:!0,query:"token="+app.tokenSigned+"&version="+config.SW_VERSION,path:"/wss/socket.io"};socket=io.connect(e,f),socket.on("connect",function(){app.connecting=!1,log.info("socket.on.connect");var a=(new Date).getTime(),b=new Date(a-config.TIME_UNIX_MONTH).getTime();mailBox.sendOfflineMessages(b,a,[]),app.isMobile&&app.bindPushEvents();var c=[];contactsHandler.listOfContacts.map(function(a){c.push(a.publicClientID)});var d={idWhoIsOnline:user.publicClientID,listOfReceivers:c};postman.send("WhoIsOnline",d),log.info("send ... WhoIsOnline"),easyrtc._init()}),socket.on("disconnect",function(){log.info("socket.on.disconnect, sendLogin in ",config.TIME_WAIT_WAKEUP),setTimeout(function(){app.sendLogin()},config.TIME_WAIT_WAKEUP),app.easyrtcid=null}),socket.on("reconnect_attempt",function(){log.info("socket.on.reconnect_attempt"),app.connecting=!0}),socket.on("reconnect_failed",function(){log.info("socket.on.reconnect_failed"),app.connecting=!1,app.sendLogin()}),socket.on("reconnect",function(){log.info("socket.on.reconnect"),app.connecting=!1,postman.send("reconnectNotification",{publicClientID:user.publicClientID});var a=(new Date).getTime(),b=new Date(a-config.TIME_UNIX_MONTH).getTime();mailBox.sendOfflineMessages(b,a,[])}),socket.on("MessageDeliveryReceipt",function(a){log.info("MessageDeliveryReceipt ");var b=postman.getDeliveryReceipt(a);null!=b&&setTimeout(function(){mailBox.getMessageByID(b.msgID).done(function(a){"undefined"!=typeof a&&null!=a&&("ACKfromServer"==b.typeOfACK&&0==a.ACKfromServer&&(a.ACKfromServer=!0,$("#messageStateColor_"+b.msgID).toggleClass("amber-rx-by-srv")),"ACKfromAddressee"==b.typeOfACK&&0==a.ACKfromAddressee&&(a.ACKfromServer=!0,a.ACKfromAddressee=!0,$("#messageStateColor_"+b.msgID).toggleClass("green-rx-by-end")),"ReadfromAddressee"==b.typeOfACK&&(a.ACKfromServer=!0,a.ACKfromAddressee=!0,a.markedAsRead=!0,$("#messageStateColor_"+b.msgID).toggleClass("blue-r-by-end"),$(".blue-r-by-end").delay(config.TIME_FADE_ACK).fadeTo(config.TIME_FADE_ACK,0)),mailBox.storeMessage(a))})},config.TIME_WAIT_DB)}),socket.on("ServerReplytoDiscoveryHeaders",function(a){var b=postman.getListOfHeaders(a);if(null!=b){log.info("socket.on.ServerReplytoDiscoveryHeaders",b);var c=setInterval(function(){if(b.length>0){var a=b.pop(),d={msgID:a.msgID};postman.send("messageRetrieval",d)}else clearInterval(c)},config.TIME_WAIT_MAILBOX_POLLING)}}),socket.on("RequestForProfile",function(a){var b=postman.getProfileRequest(a);null!=b&&b.lastProfileUpdate<user.lastProfileUpdate&&app.sendProfileUpdate()}),socket.on("ProfileFromServer",function(a){var b=postman.getProfileFromServer(a);if(null!=b){var c=contactsHandler.getContactById(b.publicClientID);if("undefined"!=typeof c&&null!=c){c.lastProfileUpdate=(new Date).getTime(),contactsHandler.setContactOnList(b),contactsHandler.updateContactOnDB(c),$("#profilePhoto"+c.publicClientID).attr("src",c.imgsrc),app.currentChatWith==c.publicClientID&&$("#imgOfChat-page-header").attr("src",c.imgsrc);var d=$("#link2go2ChatWith_"+c.publicClientID).children();""!=c.imgsrc&&d.find("img").attr("src",c.imgsrc),""!=c.nickName&&d.closest("h2").html(c.nickName),""!=c.commentary&&d.closest("p").html(c.commentary)}}}),socket.on("locationFromServer",function(a){var b=postman.getLocationFromServer(a);log.info("locationFromServer ::: "+JSON.stringify(b)),b&&null!=b&&""==app.myPosition.coords.latitude&&(app.myPosition.coords.latitude=parseFloat(b.coords.latitude),app.myPosition.coords.longitude=parseFloat(b.coords.longitude)),app.sendRequest4Neighbours()}),socket.on("notificationOfNewContact",contactsHandler.processNewContacts),socket.on("KeysDelivery",function(a){log.info("socket.on.KeysDelivery - receiving something");var b=postman.getKeysDelivery(a);if(null!=b)if(b.from==user.publicClientID)log.info("socket.on.KeysDelivery - discard my own delivery");else try{var c=contactsHandler.getContactById(b.from);if("undefined"!=typeof c&&null!=c||(c=new ContactOnKnet({publicClientID:b.from}),contactsHandler.setContactOnList(c),gui.showEntryOnMainPage(c,!1)),null==c.decryptionKeys){var d=app.keys.privateKey.decrypt(b.setOfKeys.masterKeyEncrypted,"RSA-OAEP"),e=forge.cipher.createDecipher("AES-CBC",d);e.start({iv:b.setOfKeys.symKeysEncrypted.iv2use}),e.update(forge.util.createBuffer(b.setOfKeys.symKeysEncrypted.keysEncrypted)),e.finish(),c.decryptionKeys=KJUR.jws.JWS.readSafeJSONString(e.output.data).setOfSymKeys,contactsHandler.setContactOnList(c),contactsHandler.setContactOnDB(c),contactsHandler.sendProfileRequest(c),mailBox.unwrapMessagesOf(c)}}catch(a){return log.debug("socket.on.KeysDelivery",c),null}}),socket.on("KeysRequest",function(a){var b=postman.getKeysRequest(a);if(null!=b)if(b.from==user.publicClientID)log.info("socket.on.KeysRequest - discard my own Request");else try{var c=contactsHandler.getContactById(b.from);contactsHandler.sendKeys(c)}catch(a){return log.debug("socket.on.KeysRequest",a),null}}),socket.on("MessageFromClient",function(a){postman.onMsgFromClient(a)}),socket.on("WhoIsOnline",function(a){var b=postman.getWhoIsOnline(a);null!=b&&gui.showPeerIsOnline(b)}),socket.on("WhoIsWriting",function(a){var b=postman.getWhoIsWriting(a);null!=b&&gui.showPeerIsTyping(b)}),socket.on("PlansAround",function(a){var b=postman.getPlansAround(a);null!=b&&(gui.listOfPlans=b,gui.showPlansInResultsPage(b))}),socket.on("ImgOfPlanFromServer",function(a){var b=postman.getPlanImgFromServer(a);null!=b&&(gui.listOfPlans.map(function(a){a.planId==b.planId&&(a.imgsrc=b.imgsrc)}),gui.showPlanImgInResultsPage(b))})},Application.prototype.detectLanguage=function(){var a={};a.detected=null,a.value=null,"undefined"==typeof cordova||null==cordova?(a.detected=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,app.setLanguage(a)):$.when(app.events.documentReady,app.events.deviceReady).done(function(){navigator.globalization.getPreferredLanguage(function(b){a.detected=b.value,app.setLanguage(a)},function(){a.detected="English",app.setLanguage(a)})})},Application.prototype.detectPosition=function(){function a(a){app.myPosition=a,app.sendRequest4Neighbours()}function b(a){log.info("detectPosition ::: failed "+JSON.stringify(a))}"undefined"==typeof cordova||null==cordova?navigator.geolocation&&navigator.geolocation.getCurrentPosition(a,b,{maximumAge:1e5,enableHighAccuracy:!0,timeout:6e4}):$.when(app.events.deviceReady).done(function(){function a(a){app.myPosition=a,app.sendRequest4Neighbours()}function b(a){console.log("DEBUG ::: detectPosition ::: failed")}navigator.geolocation.watchPosition(a,b,{maximumAge:1e5,enableHighAccuracy:!1,timeout:6e4})})},Application.prototype.forwardMsg=function(a,b){a.from=user.publicClientID,a.to=b.publicClientID,a.chatWith=b.publicClientID,a.timestamp=(new Date).getTime(),a.msgID=a.assignId();var c=new Message(a);c.msgID=a.msgID,mailBox.storeMessage(c),gui.showMsgInConversation(c,{isReverse:!1,withFX:!0}),postman.sendMsg(a)},Application.prototype.registrationProcess=function(){gui.hideLoadingSpinner(),gui.showWelcomeMessage(dictionary.Literals.label_35),postman.generateKeyPair().done(function(a){app.keys=a;var b=postman.createCertificate(app.keys);app.keys.certificate=forge.pki.certificateToPem(b);var c={onConnected:function(){var a=forge.pki.publicKeyToPem(app.keys.publicKey),b={event:"register",data:{clientPEMpublicKey:a}},c=JSON.stringify(b);log.debug("registrationProcess ::: preparing"+c),app.authSocket.TLS.prepare(c)},onClosed:function(){},onDisconnected:function(){},onError:function(){gui.showWelcomeMessage(dictionary.Literals.label_42)},onReconnect:function(){}};app.establishTLS(c)})},Application.prototype.init=function(){gui.loadBody(),gui.loadAsideMenuMainPage(),gui.bindDOMevents(),app.detectPosition(),app.detectLanguage(),app.loadPersistentData(),app.loadContactsBook(),app.loadMyNumber()},Application.prototype.initializeDevice=function(){Application.prototype.bindDeviceEvents(),"undefined"!=typeof cordova&&null!=cordova||(app.events.deviceReady.resolve(),app.isMobile=!1)},Application.prototype.loadContacts=function(){IDBKeyRange.only("publicClientID");db.transaction(["contacts"],"readonly").objectStore("contacts").openCursor(null,"nextunique").onsuccess=function(a){var b=a.target.result;if(b){var c=new ContactOnKnet(b.value);contactsHandler.setContactOnList(c),gui.showEntryOnMainPage(c,!1),b.continue()}else gui.orderEntriesOnMainPage(),app.events.contactsLoaded.resolve()}},Application.prototype.loadContactsBook=function(){"undefined"!=typeof cordova&&null!=cordova&&$.when(app.events.deviceReady,app.events.documentReady).done(function(){})},Application.prototype.loadGroups=function(){IDBKeyRange.only("publicClientID");db.transaction(["groups"],"readonly").objectStore("groups").openCursor(null,"nextunique").onsuccess=function(a){var b=a.target.result;if(b){var c=new Group(b.value);groupsHandler.list.push(c),gui.showEntryOnMainPage(c,!1),b.continue()}}},Application.prototype.loadjscssfile=function(a,b){if("js"==b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",a),c.setAttribute("id",a)}else if("css"==b){var c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",a),c.setAttribute("id",a)}"undefined"!=typeof c&&document.getElementsByTagName("head")[0].appendChild(c)},Application.prototype.loadMyNumber=function(){"undefined"!=typeof cordova&&null!=cordova&&$.when(app.events.deviceReady,app.events.documentReady).done(function(){window.plugins.sim.getSimInfo(app.loadMyNumberSuccess,app.loadMyNumberError)})},Application.prototype.loadMyNumberError=function(a){},Application.prototype.loadMyNumberSuccess=function(a){if(""==user.myTelephone||null==user.myTelephone){var b=JSON.parse(a);user.myTelephone=""+b.mcc+b.mnc,user.updateUserSettings()}},Application.prototype.loadPersistentData=function(){"undefined"==typeof cordova||null==cordova?$.when(app.events.documentReady).done(function(){app.loadStoredData()}):$.when(app.events.deviceReady,app.events.documentReady).done(function(){app.loadStoredData()})},Application.prototype.loadStoredData=function(){this.indexedDBHandler=indexedDB.open("com.instaltic.knet",5),this.indexedDBHandler.onupgradeneeded=function(a){var b=a.target.result;if(!b.objectStoreNames.contains("usersettings"))var c=b.createObjectStore("usersettings",{keyPath:"index"});if(!b.objectStoreNames.contains("messages")){var c=b.createObjectStore("messages",{keyPath:"msgID"});c.createIndex("timestamp","timestamp",{unique:!1}),c.createIndex("publicclientid","publicclientid",{unique:!1})}if(!b.objectStoreNames.contains("contacts"))var c=b.createObjectStore("contacts",{keyPath:"publicClientID"});if(!b.objectStoreNames.contains("groups"))var c=b.createObjectStore("groups",{keyPath:"publicClientID"})},this.indexedDBHandler.onsuccess=function(a,b){db=a.target.result,app.loadUserSettings(),app.loadGroups(),app.loadContacts()},this.indexedDBHandler.onerror=function(a){log.debug("indexedDBHandler.onerror",a)},this.indexedDBHandler.onblocked=function(){log.debug("indexedDBHandler.onblocked")}},Application.prototype.loadUserSettings=function(){var a=IDBKeyRange.only(0);try{db.transaction(["usersettings"],"readonly").objectStore("usersettings").openCursor(a).onsuccess=function(a){var b=a.target.result;return b&&"undefined"!=typeof b.value.publicClientID?(user=new UserSettings(b.value),app.keys.privateKey=forge.pki.privateKeyFromPem(user.keys.privateKey),app.keys.publicKey=forge.pki.publicKeyFromPem(user.keys.publicKey),app.keys.certificate=user.keys.certificate,gui.loadLoadingSpinner(),void app.events.userSettingsLoaded.resolve()):void app.registrationProcess()}}catch(a){log.debug("Application.prototype.loadUserSettings",a)}},Application.prototype.onDeviceReady=function(){try{app.devicePlatform=device.platform,app.deviceVersion=device.version,"WinCE"==app.devicePlatform||"Win32NT"==app.devicePlatform?document.removeEventListener("backbutton",gui.onBackButton,!1):document.addEventListener("backbutton",gui.onBackButton,!1),app.events.deviceReady.resolve()}catch(a){log.debug("Application.prototype.onDeviceReady",a)}},Application.prototype.onNativeCameraInit=function(a,b){app.setMultimediaAsOpen();var c={quality:50,encodingType:Camera.EncodingType.JPEG};"PHOTOLIBRARY"==a?(c.sourceType=navigator.camera.PictureSourceType.PHOTOLIBRARY,c.destinationType=navigator.camera.DestinationType.FILE_URI):"CAMERA"==a&&(c.sourceType=navigator.camera.PictureSourceType.CAMERA,c.destinationType=navigator.camera.DestinationType.FILE_URI),navigator.camera.getPicture(function(a){b(a)},function(a){console.log("DEBUG ::: Application.prototype.onNativeCameraInit failed")},c)},Application.prototype.onOnlineCustom=function(){$.when(app.events.documentReady,app.events.contactsLoaded,app.events.userSettingsLoaded,app.events.deviceReady).done(function(){setTimeout(function(){app.sendLogin()},2*config.TIME_WAIT_WAKEUP)})},Application.prototype.onProcessPayment=function(){gui.showLoadingSpinner(),$.when(app.events.deviceReady).done(function(){var a=gui.getPurchaseDetails();app.connect2paypal(a)})},Application.prototype.onResumeCustom=function(){0==app.multimediaWasOpened&&(gui.hideLocalNotifications(),setTimeout(function(){app.sendLogin()},config.TIME_WAIT_WAKEUP)),app.inBackground=!1,app.multimediaWasOpened=!1,postman.send("reconnectNotification",{publicClientID:user.publicClientID})},Application.prototype.onTLSmsg=function(a){var b=JSON.parse(a),c=b.event;switch(c){case"registration":app.userRegistration(b.data);break;case"LoginResponse":app.connect2server(b.data),gui.hideLoadingSpinner();break;default:log.debug("onTLSmsg ::: any other event...")}},Application.prototype.userRegistration=function(a){if(log.debug("userRegistration ::: registration..."),"undefined"==typeof a||null==a||"undefined"==typeof a.publicClientID||null==a.publicClientID||"undefined"==typeof a.handshakeToken||null==a.handshakeToken)log.debug("userRegistration ::: something went wrong...");else{
user=new UserSettings(a),user.myCurrentNick=user.publicClientID,user.lastProfileUpdate=(new Date).getTime(),user.keys.privateKey=forge.pki.privateKeyToPem(app.keys.privateKey),user.keys.publicKey=forge.pki.publicKeyToPem(app.keys.publicKey),user.keys.certificate=app.keys.certificate;var b=db.transaction(["usersettings"],"readwrite"),c=b.objectStore("usersettings");c.add(user);$.mobile.loading("hide"),gui.showTermsAndConditions(),app.events.userSettingsLoaded.resolve()}},Application.prototype.sendLogin=function(){if(1==app.connecting||0==app.initialized||"undefined"!=typeof socket&&1==socket.connected)return void log.info("sendLogin returned");log.info("sendLogin"),app.connecting=!0,gui.showLoadingSpinner();var a={onConnected:function(){var a={event:"login",data:{handshakeToken:user.handshakeToken}},b=JSON.stringify(a);log.debug("callback ::: establishTLS ::: onConnected : "+b),app.authSocket.TLS.prepare(b),gui.hideLoadingSpinner()},onClosed:function(){log.info("callback ::: establishTLS ::: onClosed"),"undefined"!=typeof app.authSocket.TLS&&app.authSocket.TLS.close()},onDisconnected:function(){log.info("callback ::: establishTLS ::: onDisconnected")},onReconnect:function(){log.info("callback ::: establishTLS ::: onReconnect")},onError:function(){app.connecting=!1,log.info("callback ::: establishTLS ::: onError"),setTimeout(function(){app.sendLogin()},2*config.TIME_WAIT_HTTP_POST)},onConnect_error:function(){app.connecting=!1,log.info("callback ::: establishTLS ::: onConnect_error "),setTimeout(function(){app.sendLogin()},3*config.TIME_WAIT_HTTP_POST)}};app.establishTLS(a)},Application.prototype.sendMultimediaMsg=function(a){var b=new Message({to:a.receiver,from:user.publicClientID,messageBody:{messageType:"multimedia",src:a.src}}),c=new Message(b);mailBox.storeMessage(c),gui.showMsgInConversation(c,{isReverse:!1,withFX:!0}),postman.sendMsg(b)},Application.prototype.sendProfileUpdate=function(){var a={publicClientIDofSender:user.publicClientID,img:user.myPhotoPath,commentary:user.myCommentary,nickName:user.myCurrentNick,telephone:user.myTelephone,email:user.myEmail,visibility:user.visibility};postman.send("profileUpdate",a)},Application.prototype.sendPushRegistrationId=function(a){var b={publicClientID:user.publicClientID,token:a};postman.send("PushRegistration",b)},Application.prototype.sendRequest4Plans=function(a){var b={location:{lat:null,lon:null}};a&&(b.location.lat=a.lat.toString(),b.location.lon=a.lng.toString()),null!=b.location.lat&&postman.send("Request4Plans",b)},Application.prototype.sendRequest4Neighbours=function(a){var b={location:{lat:null,lon:null}};a?(b.location.lat=a.lat.toString(),b.location.lon=a.lng.toString()):""!=app.myPosition.coords.latitude&&(b.location.lat=app.myPosition.coords.latitude.toString(),b.location.lon=app.myPosition.coords.longitude.toString()),null!=b.location.lat&&(gui.showLoadingSpinner(),postman.send("RequestOfListOfPeopleAround",b))},Application.prototype.establishTLS=function(a){log.debug("starting establishment of TLS "),null!=app.authSocket&&app.authSocket.disconnect(),null!=app.authSocket&&"undefined"!=typeof app.authSocket.TLS&&app.authSocket.TLS.close();var b={forceNew:!0,path:"/tls/socket.io"},c="https://"+config.ipServerSockets+":"+config.portServerSockets;app.authSocket=io.connect(c,b),app.authSocket.on("connect",function(){log.debug("authSocket.on.connect ::: emitting RequestTLSConnection");var a={clientPEMcertificate:app.keys.certificate};app.authSocket.emit("RequestTLSConnection",a)}),app.authSocket.on("reconnect",function(){log.debug("authSocket.on.reconnect"),a.onReconnect()}),app.authSocket.on("ResponseTLSConnection",function(b){var c={serversPEMcertificate:b.serversPEM,onConnected:a.onConnected,onClosed:a.onClosed,onTLSmsg:app.onTLSmsg,onDisconnected:a.onDisconnected,onError:a.onError};app.authSocket.TLS=postman.createTLSConnection(c),app.authSocket.TLS.handshake()}),app.authSocket.on("data2Client",function(a){app.authSocket.TLS.process(forge.util.decode64(a))}),app.authSocket.on("disconnect",function(){log.debug("authSocket.on.disconnect"),a.onDisconnected()}),app.authSocket.on("connect_error",function(){log.debug("authSocket.on.connect_error"),a.onError()})},Application.prototype.setLanguage=function(a){switch(a.value="",!0){case/en(?:\-[A-Z]{2}$)|EN$|en$|English$|english$/.test(a.detected):a.value="en";break;case/es(?:\-[A-Z]{2}$)|ES$|es$|espa\u00f1ol$|Espa\u00f1ol$/.test(a.detected):a.value="es";break;case/de(?:\-[A-Z]{2}$)|DE$|de$|deutsch$|Deutsch$/.test(a.detected):a.value="de";break;case/it(?:\-[A-Z]{2}$)|IT$|it$|italiano$|Italiano$/.test(a.detected):a.value="it";break;case/fr(?:\-[A-Z]{2}$)|FR$|fr$|fran\u00e7ais$|Fran\u00e7ais$/.test(a.detected):a.value="fr";break;case/pt(?:\-[A-Z]{2}$)|PT$|pt$|portugu\u00EAs$|Portugu\u00EAs$/.test(a.detected):a.value="pt";break;default:a.value="en"}dictionary.AvailableLiterals.hasOwnProperty(a.value)||(log.debug("app.setLanguage - NOT FOUND",a),a.value="en"),dictionary.Literals=dictionary.AvailableLiterals[a.value].value,gui.setLocalLabels(),Globalize.load(dictionary.Literals.CLDR),gui.formatter=Globalize(a.value)},Application.prototype.setMultimediaAsOpen=function(){app.multimediaWasOpened=!0},AbstractHandler.prototype.getObjById=function(a){var b=contactsHandler.getContactById(a);return b||(b=groupsHandler.getGroupById(a)),b},AbstractHandler.prototype.setOnDB=function(a){a instanceof ContactOnKnet?contactsHandler.setContactOnDB(a):groupsHandler.setGroupOnDB(a)},AbstractHandler.prototype.setOnList=function(a){a instanceof ContactOnKnet?contactsHandler.setContactOnList(a):groupsHandler.setGroupOnList(a)},ContactOnKnet.prototype.set=function(a){this.publicClientID=a.publicClientID?a.publicClientID:this.publicClientID,this.imgsrc="undefined"==typeof a.imgsrc||""==a.imgsrc||null==a.imgsrc?this.imgsrc:a.imgsrc,this.nickName=a.nickName?a.nickName:this.nickName,this.location=a.location?a.location:this.location,this.commentary="undefined"==typeof a.commentary||""==a.commentary?this.commentary:a.commentary,this.lastProfileUpdate=a.lastProfileUpdate?parseInt(a.lastProfileUpdate):this.lastProfileUpdate,this.counterOfUnreadSMS=a.counterOfUnreadSMS?a.counterOfUnreadSMS:this.counterOfUnreadSMS,this.timeLastSMS=a.timeLastSMS?parseInt(a.timeLastSMS):this.timeLastSMS,this.telephone=a.telephone?a.telephone:this.telephone,this.email=a.email?a.email:this.email,this.pubKeyPEM=a.pubKeyPEM?a.pubKeyPEM:this.pubKeyPEM,this.encryptionKeys=a.encryptionKeys?a.encryptionKeys:this.encryptionKeys,this.decryptionKeys=a.decryptionKeys?a.decryptionKeys:this.decryptionKeys,this.lastMsgTruncated="undefined"==typeof a.lastMsgTruncated||null==a.lastMsgTruncated?this.lastMsgTruncated:a.lastMsgTruncated},ContactsHandler.prototype.addNewContactOnDB=function(a){$("#linkAddNewContact"+a.publicClientID).attr({class:"icon-list ui-btn ui-btn-icon-notext ui-icon-carat-r"}).unbind("click").on("click",function(){gui.showConversation(a)});var b=' <a class="backButton ui-btn-right" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext"></a> <img class="darkink" src="./res/new_contact_added_195x195.png"> <p class="darkink">'+dictionary.Literals.label_15+"</p> ";gui.showDialog(b),contactsHandler.setContactOnDB(a)},ContactsHandler.prototype.generateKeys=function(a){a.encryptionKeys=[forge.random.getBytesSync(32).replace(/['"]/g,"A"),forge.random.getBytesSync(32).replace(/['"]/g,"B"),forge.random.getBytesSync(32).replace(/['"]/g,"C"),forge.random.getBytesSync(32).replace(/['"]/g,"D"),forge.random.getBytesSync(32).replace(/['"]/g,"E"),forge.random.getBytesSync(32).replace(/['"]/g,"F"),forge.random.getBytesSync(32).replace(/['"]/g,"G"),forge.random.getBytesSync(32).replace(/['"]/g,"H"),forge.random.getBytesSync(32).replace(/['"]/g,"I")]},ContactsHandler.prototype.getContactById=function(a){return this.listOfContacts.filter(function(b){return b.publicClientID==a})[0]},ContactsHandler.prototype.processNewContacts=function(a){gui.hideLoadingSpinner();var b=postman.getProcessNewContacts(a);if(null!=b){var c=$.mobile.activePage.attr("id");b.map(function(a){if(a.publicClientID!=user.publicClientID){var b=contactsHandler.getContactById(a.publicClientID);b?contactsHandler.setContactOnList(a):(b=new ContactOnKnet(a),contactsHandler.setContactOnList(b),gui.showEntryOnMainPage(b,!0)),/searchResultsPage/.test(c)&&gui.showEntryOnResultsPage(b,!0),contactsHandler.updateContactOnDB(b),contactsHandler.sendProfileRequest(b)}})}},ContactsHandler.prototype.sendKeys=function(a){var b={setOfSymKeys:a.encryptionKeys},c=forge.random.getBytesSync(32).replace(/['"]/g,"J"),d=forge.random.getBytesSync(32).replace(/['"]/g,"K"),e=forge.pki.publicKeyFromPem(a.pubKeyPEM),f=e.encrypt(c,"RSA-OAEP"),g=forge.cipher.createCipher("AES-CBC",c);g.start({iv:d}),g.update(forge.util.createBuffer(JSON.stringify(b))),g.finish();var h={from:user.publicClientID,to:a.publicClientID,setOfKeys:{masterKeyEncrypted:f,symKeysEncrypted:{iv2use:d,keysEncrypted:g.output.data}}};postman.send("KeysDelivery",h)},ContactsHandler.prototype.setContactOnList=function(a){var b=!1;this.listOfContacts.map(function(c){if(c.publicClientID==a.publicClientID)return c.set(a),void(b=!0)}),0==b&&this.listOfContacts.push(a)},ContactsHandler.prototype.setContactOnDB=function(a){try{var b=IDBKeyRange.only(a.publicClientID),c=db.transaction(["contacts"],"readwrite"),d=c.objectStore("contacts");d.openCursor(b).onsuccess=function(b){var c=b.target.result;c?c.update(a):d.add(a)}}catch(a){log.debug("ContactsHandler.prototype.setContactOnDB",a)}},ContactsHandler.prototype.setEncryptionKeys=function(a){contactsHandler.generateKeys(a),contactsHandler.setContactOnDB(a),contactsHandler.sendKeys(a)},ContactsHandler.prototype.sendProfileRequest=function(a){var b={publicClientIDofRequester:user.publicClientID,publicClientID2getImg:a.publicClientID,lastProfileUpdate:parseInt(a.lastProfileUpdate)};postman.send("ProfileRetrieval",b)},ContactsHandler.prototype.updateContactOnDB=function(a){try{var b=IDBKeyRange.only(a.publicClientID),c=db.transaction(["contacts"],"readwrite"),d=c.objectStore("contacts");d.openCursor(b).onsuccess=function(b){var c=b.target.result;c&&c.update(a)}}catch(a){log.debug("ContactsHandler.prototype.updateContactOnDB",a)}},easyrtc._init=function(){easyrtc.setStreamAcceptor(function(a,b){log.info("easyRTC setStreamAcceptor trigered"),$("body").pagecontainer("change","#conference-page",{transition:"none"});var c=document.getElementById("conferenceTag");clearTimeout(gui.timeoutPickupRTC),easyrtc.setVideoObjectSrc(c,b),$("#callRejectButton").show().unbind("click").on("click",easyrtc._releaseResources),$("#imgConferenceCaller").hide(),$("#conferenceTag").show(),gui.hideLoadingSpinner()}),easyrtc.setOnStreamClosed(function(a){log.info("easyRTC setOnStreamClosed trigered"),easyrtc._releaseResources()}),easyrtc.setAcceptChecker(function(a,b){log.info("easyRTC setAcceptChecker trigered"),clearTimeout(gui.timeoutPickupRTC),easyrtc.getConnectionCount()>0?(log.info("Dropping current call and accept new from "+a),easyrtc.hangupAll()):log.info("Acceptting incoming call from "+a),b(!0)}),easyrtc.useThisSocketConnection(socket),easyrtc.enableVideoReceive(!0),easyrtc.enableAudio(!0),easyrtc.enableVideo(!0),easyrtc.enableDataChannels(!0)},easyrtc._performCall=function(a){app.easyrtcid=a,log.debug("easyrtc._performCall, I'm: "+a),easyrtc.hangupAll();var b=function(a,b){a||(easyrtc.showError("CALL-REJECTED","Sorry, your call to was rejected"),$.mobile.back()),gui.hideLoadingSpinner()},c=function(){$("#callRejectButton").show(),$("#conferenceTag").show(),gui.hideLoadingSpinner()},d=function(){$.mobile.back(),gui.hideLoadingSpinner()};easyrtc.call(app.otherEasyrtcid,c,d,b)},easyrtc._req4call=function(a){app.easyrtcid=a,log.debug("easyrtc._req4call, I'm: "+a);var b=new Message({to:app.currentChatWith,from:user.publicClientID,messageBody:{messageType:"req4call",easyRTCid:a}});postman.sendMsg(b)},easyrtc._initMediaResource=function(a){log.debug("easyrtc._initMediaResource "+app.easyrtcid),null==app.easyrtcid||"undefined"==typeof app.easyrtcid?easyrtc.initMediaSource(function(){easyrtc.connect("easyrtc.audioOnly",a,easyrtc._connectFailure)},function(a,b){easyrtc.showError(a,b)}):a(app.easyrtcid)},easyrtc._isAmissedCall=function(a){var b=new Date(a.timestamp).getTime(),c=(new Date).getTime();return c-b>config.TIME_WAIT_PICKUP},easyrtc._peerRequest4aCall=function(){easyrtc._initMediaResource(easyrtc._req4call),gui.showConferencePage(function(){},easyrtc._releaseResources),$("#callAcceptButton").hide(),gui.timeoutPickupRTC=setTimeout(easyrtc._releaseResources,config.TIME_WAIT_PICKUP)},easyrtc._connectFailure=function(a,b){easyrtc.showError(a,b)},easyrtc._releaseResources=function(a,b){clearTimeout(gui.timeoutPickupRTC),easyrtc.clearMediaStream(document.getElementById("conferenceTag")),easyrtc.setVideoObjectSrc(document.getElementById("conferenceTag"),""),easyrtc.closeLocalMediaStream(),easyrtc.setRoomOccupantListener(function(){}),$.mobile.back(),gui.hideLoadingSpinner()},easyrtc._sendRejection2peer=function(a){easyrtc._releaseResources();var b=new Message({to:a.from,from:user.publicClientID,messageBody:{messageType:"res4call",easyRTCid:null}});postman.sendMsg(b)},easyrtc._proccessCall=function(a){$("#callAcceptButton").hide(),app.otherEasyrtcid=a.messageBody.easyRTCid,easyrtc._initMediaResource(easyrtc._performCall)},Group.prototype.addMember=function(a){var b=!1;this.listOfMembers.map(function(c){if(c==a.publicClientID)return void(b=!0)}),0==b&&this.listOfMembers.push(a.publicClientID)},Group.prototype.assignId=function(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")},Group.prototype.removeMember=function(a){this.listOfMembers=this.listOfMembers.filter(function(b){return b!==a.publicClientID})},Group.prototype.set=function(a){this.publicClientID=a.publicClientID?a.publicClientID:this.publicClientID,this.imgsrc="undefined"==typeof a.imgsrc||""==a.imgsrc||null==a.imgsrc?this.imgsrc:a.imgsrc,this.nickName=a.nickName?a.nickName:this.nickName,this.commentary="undefined"==typeof a.commentary||""==a.commentary?this.commentary:a.commentary,this.location=a.location?a.location:this.location,this.lastProfileUpdate=a.lastProfileUpdate?parseInt(a.lastProfileUpdate):this.lastProfileUpdate,this.counterOfUnreadSMS=a.counterOfUnreadSMS?a.counterOfUnreadSMS:this.counterOfUnreadSMS,this.timeLastSMS=a.timeLastSMS?parseInt(a.timeLastSMS):this.timeLastSMS,this.telephone=a.telephone?a.telephone:this.telephone,this.email=a.email?a.email:this.email,this.listOfMembers=a.listOfMembers instanceof Array?a.listOfMembers:this.listOfMembers,this.isAccepted="boolean"==typeof a.isAccepted?a.isAccepted:this.isAccepted,this.isBlocked="boolean"==typeof a.isBlocked?a.isBlocked:this.isBlocked,this.lastMsgTruncated="undefined"==typeof a.lastMsgTruncated||null==a.lastMsgTruncated?this.lastMsgTruncated:a.lastMsgTruncated},GroupsHandler.prototype.getGroupById=function(a){return this.list.filter(function(b){return b.publicClientID==a})[0]},GroupsHandler.prototype.getMembersOfGroup=function(a){var b=[];return this.list.map(function(c){if(c.publicClientID==a)return void(b=c.listOfMembers)}),b},GroupsHandler.prototype.sendGroupUpdate=function(a){var b=new Message({chatWith:a.publicClientID,to:a.publicClientID,from:user.publicClientID,messageBody:{messageType:"groupUpdate",group:a}});postman.sendMsg(b)},GroupsHandler.prototype.setGroupOnDB=function(a){try{var b=IDBKeyRange.only(a.publicClientID),c=db.transaction(["groups"],"readwrite"),d=c.objectStore("groups");d.openCursor(b).onsuccess=function(b){var c=b.target.result;c?c.update(a):d.add(a)}}catch(a){log.debug("ContactsHandler.prototype.setGroupOnDB",a)}},GroupsHandler.prototype.setGroupOnList=function(a){var b=!1;this.list.map(function(c){if(c.publicClientID==a.publicClientID)return c.set(a),void(b=!0)}),0==b&&this.list.push(a)},log4javascript.setEnabled(!0);var indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,db,socket,push,user,config=new Config,gui=new GUI,postman=new Postman,mailBox=new MailBox,abstractHandler=new AbstractHandler,contactsHandler=new ContactsHandler,groupsHandler=new GroupsHandler,dictionary=new Dictionary,log=log4javascript.getDefaultLogger(),app=new Application;$.when(app.events.documentReady,app.events.contactsLoaded,app.events.userSettingsLoaded,app.events.deviceReady).done(function(){app.initialized=!0,gui.bindButtonsOnMainPage(),app.sendLogin()}),$(document).ready(function(){FastClick.attach(document.body),app.init(),app.initializeDevice()});
//# sourceMappingURL=sourcemap.map